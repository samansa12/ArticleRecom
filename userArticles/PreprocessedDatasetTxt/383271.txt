signalprocessing framework inverse rendering realism computergenerated images requires accurate input models lighting textures brdfs one best ways obtaining highquality data measurements scene attributes real photographs inverse rendering however inverse rendering methods largely limited settings highly controlled lighting one reasons lack coherent mathematical framework inverse rendering general illumination conditions main contribution introduction signalprocessing framework describes reflected light field convolution lighting brdf expresses mathematically product spherical harmonic coefficients brdf lighting inverse rendering viewed deconvolution apply theory variety problems inverse rendering explaining number previous empirical results show certain problems illposed numerically illconditioned problems amenable solution theory developed also leads new practical representations algorithms instance present method factor lighting brdf small number views ie estimate simultaneously neither known b introduction create realistic computergenerated image need accurate physicallybased rendering algorithm detailed model scene including light sources objects specified geometry material propertiestexture reflectance brdf substantial progress development rendering algorithms nowadays realism often limited quality input models result imagebased rendering becoming widespread simplest form imagebased rendering uses view interpolation construct new images acquired images without constructing conventional scene model quality view interpolation may significantly improved coupled inverse rendering inverse rendering measures rendering attributeslighting textures brdffrom photographs whether traditional imagebased rendering algorithms used rendered images use measurements real ob jects therefore appear similar real scenes measuring scene attributes also introduces structure raw imagery making easier manipulate scene example artist change independently material properties lighting inverse rendering methods debevec et al 6 marschner et al 21 sato et al 32 produced high real photograph rendered image figure 1 left real photograph right rendered image brdf used rendered image estimated complex unknown illumination 3 photographs cat sculpture known geometry algorithm also recovered lighting distribution consisted two directional sources area source images show new view used brdf recovery lighting also new composed single directional source known direction used brdf estimation images show recovered brdf accurately predicts appearance even novel viewing lighting conditions quality measurements however previous work conducted highly controlled lighting conditions usually careful active positioning single point source even methods work outdoor conditions yu malik 39 sato ikeuchi 31 love 17 designed specifically natural illumination assume simple parametric model skylight previous methods also usually tried recover one unknownstexture brdf lighting usefulness inverse rendering would greatly enhanced could applied general uncontrolled lighting could simultaneously estimate one unknown instance could recover lighting brdf could determine brdfs unknown illumination one reason relatively little work areas lack common theoretical framework determining conditions inverse problems cannot solved making principled approximations main contribution theoretical framework analyzing reflected light field curved convex homogeneous surface distant illumination believe framework provides solid mathematical foundation many areas graphics respect inverse rendering obtain following results reflection convolution observed qualitatively miller hoffman 23 cabral et al 3 bastos et al 2 others reflection operator behaves like convolution angular domain formalize notions mathematically reflected light field therefore thought precise quantitative way obtained convolving lighting brdf ie filtering illumination using brdf believe useful way analyzing many computer graphics problems par ticular inverse rendering viewed deconvolution wellposedness conditioning inverse problems inverse problems illposedthere may solutions several solutions also often numerically illconditioned ie extremely sensitive noisy input data theory able analyze wellposedness conditioning number inverse problems explaining many previous empirical observa tions analysis serve guideline future research new practical representations algorithms insights theory lead derivation simple practical representation used estimate brdfs complex lighting theory also leads novel frequency space hybrid angular frequency space methods inverse problems including two new algorithms estimating lighting algorithm simultaneously determining lighting brdf therefore recover brdfs general unknown lighting conditions previous work describe previous work introduce taxonomy based many three quantitieslighting brdf texture unknown motivate taxonomy first write simplified version reflection equation omitting visibility z b reflected light field expressed function surface position x outgoing direction normal vector n simplicity assume single texture modulates brdf practice would use separate textures diffuse specular components brdf integrand product termsthe texture x lighting lx inverse rendering assuming known geometry involves inverting integral recover one l two quantities unknown inverse rendering involves factoring reflected light field one unknown 1 unknown texture previous methods recovered diffuse texture surface using single point light source dividing irradiance order estimate albedo point details given marschner 34 levoy et al 16 2 unknown brdf brdf 24 fundamental intrinsic surface property active measurement methods known goniore flectometry involving single point source single observation time developed improvements suggested ward 37 karner et al 12 recently imagebased brdf measurement methods proposed lu et al 18 marschner et al 21 entire brdf measured may represented tabulating values alternative representation lowparameter models ward 37 torrance sparrow 36 parametric brdf generally accurate full measured brdf however parametric models often preferred practice since compact simpler estimate love 17 estimates parametric brdfs natural assuming lowparameter model skylight sunlight dror et al 7 classify surface reflectance one small number predetermined brdfs making use assumed statistical characteristics natural lighting however inverse brdf problem solved general illumination 3 unknown lighting common solution use mirrored ball done miller hoffman 23 marschner greenberg 20 find lighting lambertian surface dzmura 8 proposes demonstrate estimating spherical harmonic coefficients lambertian objects 29 shown recover first 9 spherical harmonics previous work estimated lighting curved surfaces general brdfs two unknowns 4 factorizationunknown lighting brdf brdf estimation methods proposed ikeuchi sato 10 tominaga tanaka 35 special case lighting consists single source unknown direction however methods cannot simultaneously recover complex lighting distribution object brdf one main practical contributions paper solution problem curved sur allowing us estimate brdfs general unknown illu mination also determining lighting closest previous work sato et al 30 use shadows estimate illumination distribution surface reflectance properties extend work requiring shadow information presenting improved methods estimating illumination 5 factorizationunknown texture brdf corresponds recovering textured spatiallyvarying brdfs sato et al 32 rotate object turntable using single point source recover brdf parameters texture yu et al 38 recover texture diffuse brdf component account interreflections using large number images obtained moving point source around sphere surrounding subject debevec et al 6 acquire reflectance field human face recover parameters microfacet brdf model surface location sato ikeuchi 31 yu malik 39 recover brdfs diffuse textures natural illumination assuming simple parametric model skylight using sequence images acquired different illumination conditions methods recover diffuse textures constant values relatively lowresolution textures used specular param eters notable exception work dana et al 5 generalize brdfs 6d bidirectional texture function btf 6 factorizationunknown lighting texture shown 29 distant illumination field cause low frequency variation radiosity convex lambertian sur implies diffuse object highfrequency texture recovered independently lighting observations agreement perception literature lands retinex theory 15 wherein highfrequency variation usually attributed texture lowfrequency variation associated tion however note fundamental ambiguity lowfrequency texture lighting effects therefore lighting texture cannot factored without using active methods making assumptions regarding expected characteristics general case three unknowns 7 factorizationunknown lighting texture brdf ultimately wish recover textured brdfs unknown lighting cannot solve problem without assump tions must first resolve lightingtexture ambiguity approach differs previous work derived mathematical theory inverse rendering similarities inverse methods used areas radiative transfer transport theory hydrologic optics 26 neutron scattering see mccormick 22 review previous theoretical work dzmura 8 analyzed reflection linear operator terms spherical harmonics discussed resulting perceptual ambiguities reflectance illumination computer graphics cabral et al 3 first demonstrated use spherical harmonics represent brdfs extend methods explicitly deriving frequencyspace reflection equation ie convolution formula providing quantitative results various special cases earlier reported theoretical results planar flatland light fields 27 determining lighting lambertian surface 29 lambertian case similar results derived independently basri jacobs 1 simultaneous work face recognition paper extends previous results general 3d case arbitrary isotropic brdfs applies theory developing new practical inverserendering algorithms assumptions input algorithms consists object geometry photographs number different locations known extrinsic intrinsic camera parameters assume static scenes ie object remains stationary lighting remains views method passivevision approach actively disturb environment assumptions reflected radiance coefficients basisfunction expansion b incoming radiance lm coefficients sphericalharmonic expansion l surface brdf brdf multiplied cosine incident angle lpq coefficients sphericalharmonic expansion incident elevation angle local global coordinates incident azimuthal angle local global coordinates outgoing elevation angle local global coordinates outgoing azimuthal angle local global coordinates hemisphere integration localglobal coordinates x surface position surface normal parameterizationelevation angle surface normal parameterizationazimuthal angle r rotation operator surface normal l matrix related rotation group so3 lm spherical harmonic basis function lm complex conjugate spherical harmonic l normalization constant 1 figure 2 notation known geometry use laser range scanner volumetric merging algorithm 4 obtain object geometry assuming known geometry focus lighting material properties curved objects theoretical analysis requires curved sur faces assumes knowledge entire 4d reflected light field corresponding hemisphere outgoing directions surface orientations however practical algorithms require small number photographs distant illumination illumination field assumed homogeneous ie generated distant sources allowing us use lighting function regardless surface location treat lighting general function incident angle isotropic brdfs consider surfaces isotropic brdfs brdf therefore function 3 variables instead 4 ie 3d instead 4d interreflection ignored also shadowing considered theoretical anal ysis limited convex surfaces however account shadowing practical algorithms necessary 4 theory reflection convolution section presents signalprocessing framework wherein reflection viewed convolution inverse rendering de convolution first introduce preliminaries defining notation deriving version reflection equation expand lighting brdf reflected light field spherical harmonics derive simple equation terms spherical harmonic coefficients next section explores implications result incoming light l outgoing light b figure 3 schematic reflection top show situation respect local surface brdf maps incoming light distribution l outgoing light distribution b bottom figure shows rotation affects situation different orientations surface correspond rotations upper hemisphere brdf global directions corresponding local directions 41 preliminaries purposes theoretical analysis assume curved convex isotropic surfaces also assume homogeneous objects ie untextured surfaces brdf everywhere parameterize surface spherical coordinates normal vector using standard convention corresponds north pole z axis notation used section listed figure 2 diagram figure 3 use two types coordinates unprimed global coordinates denote angles respect global reference frame hand primed local coordinates denote angles respect local reference frame defined local surface normal two coordinate systems related simply rotation defined shortly reflection equation modify equation 1 based sumptions dropping texturing term using surface normal instead position x parameterize b since assumed independent x write finally written simply cos cosine incident angle local coordinates z mixed local primed global unprimed coordinates lighting global function naturally expressed global coordinate frame function global angles hand brdf naturally expressed function local incident reflected angles expressed local coordinate frame brdf everywhere homogeneous similarly expressed global coordinate frame lighting everywhere assumption distant illumination reflected radiance b expressed conveniently either local global coordinates used local coordinates match brdf similarly integration conveniently done either local global coordinates upper hemisphere easier express local coordinates define transfer 1 function order absorb cosine term modification equation 2 becomes z rotationsconverting local global coordinates local global coordinates related rotation corresponding surface normal north pole local coor dinates 0 surface normal corresponding global coordinates clearly define r rotation operator 2 column vectors rotates given rz rotation z axis ry rotation axis write dependence incident angle equation 3 entirely global coordinates entirely local coordinates r r 1 want transfer function reciprocal ie symmetric respect incident outgoing angles may multiply transfer function reflected light field cos 2 anisotropic surfaces need initial rotation z set local tangent frame would rotations z zthe familiar euler angle parameterization since dealing isotropic surfaces ignored initial z rotation physical significance difficult derive theory general anisotropic case interpretation convolution spatial domain convolution result generated filter translated input signal however generalize notion convolution transformations ta ta function write z ta translation obtain standard expression spatial convolution ta rotation angle formula defines convolution angular domain therefore equations 4 5 represent rotational convolutions equation 4 global coordinates states reflected light field given surface orientation corresponds rotating brdf orientation integrating upper hemisphere brdf thought filter lighting input signal symmetrically equation 5 local coordinates states reflected light field given surface orientation may computed rotating lighting local coordinate system brdf hemispherical integration 42 spherical harmonic representation translational case wellknown frequencyspace convolution formula given terms fourier transforms general operator analogous formula obtained terms group representations associated basis functions translations basis functions sines cosinesthe familiar fourier basis rotations corresponding basis functions spherical harmonics proceed derive frequencyspace rotational convolution formula terms spherical harmonics inui et al 11 good reference background spherical harmonics relationship rotations use spherical harmonics represent lighting similar respects previous methods 25 use steerable linear basis functions spherical harmonics well closely related zernike polyno mials used represent brdfs 3 14 33 spherical harmonics analog sphere fourier basis line circle spherical harmonic ylm given l l l cos e im nlm normalization factor equation azimuthal dependence expanded terms fourier basis func tions dependence expanded terms associated legendre functions p l indices obey l 0 l l rotation formula spherical harmonics l l mm e im important thing note indices mixeda spherical harmonic rotation must expressed combination spherical harmonics different indices ever l indices mixed rotations spherical harmonics order l composed entirely spherical harmonics order l given order l l matrix tells us spherical harmonic transforms rotation yaxis ie rewrite rotated spherical harmonic linear combination spherical harmonics order begin expanding lighting global coordinates l ml coefficients llm computed standard way integrating complex conjugate lm z 2 represent transfer function spherical harmonics note nonzero upper hemisphere ie cos interested isotropic brdfs depend implies brdf invariant respect adding constant angle incident outgoing azimuthal angles shown form spherical harmonics condition forces terms vanish unless use complex conjugate lm expansion make write furthermore invariance brdf respect negating incident outgoing azimuthal angles requires finally use three indices brdf represent reflected light field define new set orthonormal basis functions normalization form functions derived appendix particular matrix comes rotation formula spherical harmonics equation 6 convenient first define normalization constant r r new basis functions written expansion reflected light field translational convolution theorem expresses convolution frequencyspace product fourier coefficients rotational case analogous result derived appendix using spherical harmonics instead complex exponentials frequencyspace reflection equation rotational convolution mula similar product basisfunction coefficients implications section explores implications results problems inverse rendering works special cases detail theory indicates inverse problems tractable opposed illposed illconditioned finally use insights gained develop new practical representation 51 general observations inverse manipulated yield llm may use index inverse brdf computation therefore brdf recovery wellposed unless denominator vanishes ie terms order l spherical harmonic expansion lighting vanish signal processing terms input signal lighting amplitude along certain modes filter brdf modes cannot estimated brdf recovery well conditioned lighting contains high frequencies like directional sources illconditioned soft lighting inverse lighting equation 10 also manipulated yield similarly brdf recovery p q used inverse lighting problem wellposed unless denominator vanishes p q l signal processing terms brdf filter truncates certain frequencies input lighting signal instance lowpass filter cannot determine frequencies output signal inverse lighting wellconditioned brdf highfrequency components like sharp specularities illconditioned diffuse surfaces light field factorizationlighting brdf consider problem factorizing light field ie simultaneously recovering lighting brdf unknown reflected light field defined fourdimensional domain lighting function two dimensions isotropic brdf defined threedimensional domain seems indicate knowns terms coefficients reflected light field unknowns lighting brdf coefficients fixed order l use known lighting coefficients llm find unknown brdf coefficients lpq viceversa fact need one known nonzero lighting brdf coefficient bootstrap process would appear equation 10 however unrecoverable scale factor order l corresponding known coefficient require also use reciprocity brdf make transfer function symmetric multiply well reflected light field b cos new transfer function symmetric respect incident outgoing directions corresponding indices plq global scale factor cannot recover since b affected multiply lighting divide brdf amount therefore scale lighting dc term 1 4 using equations 11 12 13 llm last line use value gives explicit formula lighting brdf terms coefficients output light field therefore global scale reflected light field factored lighting brdf provided appropriate coefficients reflected light field vanish 52 special cases mirror brdf mirror brdf corresponds gazing sphere inverse lighting problem easily solved angular space case show wellposed easily solved frequency space brdf involves delta function note brdf nonzero 2 coefficients brdf reflected light field lighting 04 clamped l coefficient figure 4 left successive approximations clamped cosine function adding spherical harmonic terms get good approximation right solid line plot spherical harmonic coefficients l l l l 1 odd terms vanish even terms decay rapidly factor 1 q azimuthal angle changes upon reflection see lighting coefficients correspond direct way coefficients reflected light field signal processing terminology inverse lighting problem well conditioned frequency spectrum delta function remains constant increasing order l decay single directional source convenience position coordinate axes source located z ie 0 0 directional source described delta function spherical harmonic expansion coefficients given simply lm 0 vanishes 0 thus angular space single observation corresponds single brdf measurement property used imagebased brdf measurement 18 21 see frequency space similar straightforward relation brdf coefficients reflected light field coefficients brdf recovery wellconditioned since estimating brdf filter impulse response lambertian brdf lambertian object transfer function scaled clamped cosine function since proportional cosine incident angle upper hemisphere equal 0 lower hemisphere plots sphericalharmonic fits clamped cosine function magnitude coefficients shown figure 4 dependence outgoing angle drop indices p q reflected light field effectively surface radiosity function expanded 3 spherical harmonics l ml blmylm 29 shown definitions theta one derive blm l define l analytic formula l may derived 29 shown l vanishes odd values l 1 3 basis functions clmpq equation 9 become m0 e im ignore output dependence set brdf azimuthally symmetric shown simply ylm equation 15 follows naturally equation 10 upon dropping indices p q previous derivation 29 specialized lambertian case ignored output dependence onset even terms fall rapidly l 52 99 energy brdf filter captured l 2 numerically thus lambertian brdf acts like lowpass filter truncating severely attenuating frequencies l 2 therefore observations lambertian surface estimation illumination formally illposed wellconditioned lighting coefficients l 2 corresponding 9 parameters1 5 order 2 l explains illconditioning observed marschner greenberg 20 trying solve inverse lighting problem lambertian surface furthermore practical applications including forward rendering 28 reflected light field lambertian surface characterized using first 9 spherical harmonic coef ficients lighting effects cannot produce highfrequency variation intensity respect surface curvature phong brdf normalized phong transfer function r reflection outgoing viewing direction surface normal l direction light source shininess phong exponent normalization ensures phong lobe unit energy technically must also zero brdf light upper hemisphere however phong brdf physically based others often ignored boundary effect reparameterize reflection vector r transforming integral upper hemisphere centered surface normal integral centered r reflection vector takes place normal analysis referring r phong brdf reparameterization mathematically analogous lambertian brdf discussed fact properties convolution used show phong brdf blurring lighting using mirror brdf equivalent using real lighting real brdf formalizes transformation often made rendering environment maps 23 specifically equation 15 written l llm l lm blurred illumination l mirror brdf 4 brdf coefficients depend given z 2theta cos integral may solved analytically formulae ap pendix numerical plots figure 5 0202061l coefficient figure 5 numerical plots phong coefficients l l defined equation 18 solid lines approximations equation 19 4 formula l identical equation 14 since reparameterized reflection vector accounts slightly different normalization large l good approximation l 2 2s coefficients fall gaussian width order phong brdf behaves frequency domain like gaussian fil ter filter width controlled shininess therefore inverse lighting calculations wellconditioned order approaches infinity l frequency spectrum becomes constant corresponding perfect mirror microfacet brdf consider simplified 4parameter torrancesparrow 36 model parameters kd ks microfacet model widely used computer graphics fs f exp subscript h stands halfway vector f fresnel term refractive index normalize 1 normal exitance actually f depends angle respect halfway vector practice angle usually close simplicity analysis omitted geometric attenuation factor g practice omission significant except observations made grazing angles usually assigned low confidence anyway practical applications focus specular component reparameterizing reflection vector phong brdf also simplify matters fix exitant direction focus frequencyspace representation incidentangle dependence precise analytic difficult derive make good approxi mation shown appendix normal exitance theta normal exitance specular part brdf gaussian equation 20 simply states even sphericalharmonic basis frequency spectrum gaussian also gaussian frequency width related reciprocal angular width nonnormal exitance microfacet brdfs symmetric reflection vector unlike phong brdf preferred direction determined exitant angle however brdf filter essentially symmetric reflected direction small viewing angles well low frequencies l hence shown taylorseries expansions verified numerically corrections equation 20 small conditions finally approximate effects fresnel factor nonnormal exitance multiplying expressions f respect conditioning inverse problems equation 20 indicates inverse lighting microfacet brdf wellconditioned frequencies order l 1 equation also indicates brdf estimation illconditioned lowfrequency lighting lowfrequency lighting may apply properties convolution phong brdfs filtering lighting using equations 17 20 using mirror brdf note frequencies l 1 effects filtering insignificant brdf passes virtually lowfrequency energy therefore lighting contains low frequencies reflected light field microfacet brdf essentially independent brdf filter width 1 makes estimation surface roughness illconditioned 53 practical representation thus far presented theoretical foundation implications frequencyspace view reflection signal processing approach used areas computer graphics notably theory aliasing frequencyspace analysis aliasing gives many insights difficult obtain means last two sections lead new ways analyzing inverse rendering problems however fourierspace theory aliasing generally used directly antialiasing ideal fourierspace bandpass filter spatial domain sinc function usually modified practical purposes infinite extent leads ringing similarly representing brdfs purely linear combination spherical harmonics leads ring ing moreover difficult compute fourier spectra sparse irregularly sampled data similarly difficult compute reflected light field coefficients blmpq photographs would require large number input images densely sampling entire sphere possible directions reasons frequencyspace ideas must put practice carefully first discuss two useful practical techniquesdual angular frequencyspace representations separation lighting slow fastvarying com ponents finally use ideas insights gained previous subsection derive simple practical model reflected light field microfacet brdf representation used extensively practical algorithms section 6 dual angular frequencyspace representations quantities local angular space broad frequency spectra viceversa developing frequencyspace view reflection ensure use either angularspace frequencyspace representation even combination two diffuse brdf component slowly varying angularspace local frequencyspace specular brdf component local angular domain representing lighting frequencyspace view appropriate diffuse brdf component angularspace view appropriate specular component separation slow fastvarying lighting angularspace description lighting used computing reflected light field specular brdf component separate lighting slow varying component corresponding low frequencies area sourcesfor filter lighting use mirror brdfand fast varying component corresponding high frequencies directional sources frequencyspace lighting description used diffuse brdf component distinction need made since formulae lambertian brdf slow fast varying components model reflected light field model reflected light field microfacet brdf includes three components sfast bd diffuse component brdf b sslow represents specularities slowlyvarying lighting b sfast specular highlights fast varying lighting component write bd corresponding lambertian brdf compo nent use 9 parameter frequencyspace representation lighting explicitly noting l 2 e irradiance e x l ml llmylm numerical values l l given equation 16 b sslow filter lighting using equations 17 20 treat brdf mirror r denoting reflected direction lslow filtered version lighting obtain fast varying portion lightingcorresponding sources angular width treat total energy source given integral small solid angle subtended located center lighting sfast given standard equation specular highlight directional source extra factor 4 cos denominator compared equation 22 comes relation differential microfacet global solid angles jfast subscript j denotes particular directional source could several note l jfast total energy source brdf estimation convenient expand equa tions making dependence brdf parameters explicit 6 algorithms results section shows theory particular model derived section 53 applied broad range practical inverse rendering problems present two types methods algorithms recover coefficients purely frequencyspace description lighting brdf representing quantities sum spherical harmonic terms algorithms estimate parameters corresponding model section 53 section 61 brdf estimation demonstrates direct recovery spherical harmonic brdf coefficients well estimation parametric microfacet brdfs using equation 24 similarly section 62 demonstrates direct recovery spherical harmonic lighting coefficients well estimation dual angular frequencyspace lighting description per model section 53 section 63 shows combine brdf lighting estimation techniques simultaneously recover lighting brdf parameters unknown case show direct recovery spherical harmonic coefficients thus far found imprac tical finally section 64 demonstrates algorithms geometrically complex objects showing straightforward extend model handle textures shadowing test methods first used homogeneous spheres 5 different materials spheres naturally parameterized spherical coordinates therefore correspond directly theory later also used complex objectsa white cat sculpture textured wooden dollto show generality algorithms data acquisition used mechanical gantry position inwardlooking toshiba iktu40a ccdx3 camera arc radius 60cm calibration intrinsics done method zhang 40 since camera position computercontrolled extrinsics known mapping pixel radiance values also calibrated acquired 60 images target sphere taken 3 degree intervals map image pixels angular coordinates used image silhouettes find geometric location center sphere radius gantry also positioned 150w white point source along arc since arc radius 90 cm much larger sphere 125 2cm treated point source directional light large area source 99 energy lowfrequency modes order l 6 obtained projecting white light projection screen lighting distribution determined using gazing sphere information used directly experiments assuming known illumination reference solution experiments assuming unknown illumination also used experimental setup point source measure brdf white teflon sphere using imagebased method marschner et al 21 independent measurement used verify accuracy brdf estimation algorithms complex illumination 5 ordered mcmastercarr catalog httpwwwmcmastercom 61 inverse brdf known lighting estimation spherical harmonic brdf coefficients spherical harmonics zernike polynomials fit 14 measured brdf data previous work tried estimate coefficients directly since brdf linear coefficients lpq simply solve linear system determine lpq figure 6 compares parametric brdfs estimated complex lighting brdfs measured using single point source method marschner et al 21 expected 14 recovered brdfs exhibit ringing one way reduce ringing attenuate highfrequency coefficients according theory equivalent using low frequency lighting therefore seen figure 6 images rendered lowfrequency lighting exhibit ringing closely match real photographs since lowfrequency components brdf important however images rendered using directional sources show significant ringing real marschner order 12 order 6 images f slices real rendered lowfrequency lighting rendered directional source figure top slices brdf transfer function teflon sphere fixed exitant angle 63 varies linearly 0 90 top bottom linearly 0 360 left right central bright feature specular highlight left brdf slice independently measured using approach marschner et al 21 middle recovered value using maximum order 6 right recovered version order 12 ringing apparent recovered brdfs right version sharper exhibits pronounced ringing bottom left actual photograph lighting lowfrequency large area source middle rendering using recovered brdf order 6 lighting since lighting lowfrequency lowfrequency components brdf important rendering appears similar photograph even though recovered brdf include frequencies higher order 6 right rendering directional source viewpoint exhibits ringing practical applications usually convenient recover lowparameter brdf models since compact estimated fewer observations exhibit ringing rest section derive improved inverse rendering algorithms assuming parametric brdf model estimation parametric brdf model estimate brdf parameters general known lighting distributions using equation 24 inputs images sample reflected light field b perform estimation using nested procedures outer procedure simplex algorithm adjusts nonlinear parameters minimize error respect image pixels inner procedure linear problem solved kd ks numerical work use simplex method e04ccc linear solvers f01qcc f01qdc nag 9 c libraries main difference previous work equation 24 provides principled way accounting components lighting brdf allowing use general illumination conditions tested algorithm spheres since lighting includes high lowfrequency components directional source area source theory predicts parameter estimation wellconditioned validate algorithm compared parameters recovered complex lighting one sam ples white teflon sphere obtained fitting full brdf separately measured us using method marschner et al 21 unlike previous work brdf estimation consider fresnel term noted accurate estimates refractive index require correct noisefree measurements grazing angles since measurements tend errorprone small errors estimated values materials nevertheless find fresnel term important reproducing accurate specular highlights oblique angles parameter method fit data reflectance 086 087 kdkd ks 089 091 kskd ks 011 009 rms 93 85 figure 7 comparison brdf parameters recovered algorithm complex lighting fit measurements made method marschner et al 21 results figure 7 show estimates brdf parameters method quite accurate small increase erroroffit using parameters recovered algorithm fit measured brdf also determined percentage rms errors images rendered using recovered brdfs real photographs 5 10 visual comparison shown first third rows figure 12 results indicate expected theoretically accurately estimate brdfs even complex lighting 62 inverse lighting known brdf previous methods estimating lighting developed special cases mirror brdfs gazing sphere lambertian brdfs marschner greenberg 20 shadows present sato et al 30 previous methods 20 30 also required regularization using penalty terms userspecified weights limited computational complexity formulations coarse discretization sphere present two new algorithms curved surfaces general brdfs first method directly recovers spherical harmonic lighting coefficients llm second algorithm estimates parameters dual angular frequencyspace lighting model section 53 method requires explicit regularization yields highresolution results sharper first algorithm difficult extend concave surfaces theory tells us inverse lighting illconditioned highfrequencies therefore recover lowfrequency continuous lighting distributions explicitly account directional sources ie assume b sfast 0 reflected light field essentially independent surface roughness conditions algorithms explicitly use theory predicts recovered illumination filtered version real lighting directional sources appear continuous distributions angular width approximately estimation spherical harmonic lighting coefficients represent lighting coefficients llm l l solve linear leastsquares system llm first term parentheses corresponds bd second b sslow cutoff l used regularization order l 1 l l ml estimation parametric dual lighting model another approach estimate dual angular frequencyspace lighting model section 53 algorithm based subtracting diffuse component bd reflected light field treat object mirror sphere recovering highresolution angularspace version illumination specular component alone determine bd need 9 lowest frequencyspace coefficients llm l 2 algorithm uses following methods convert angular frequencyspace phase 2 phase 1 input f sslow db d1 lm lm figure 8 estimation dual lighting representation phase 1 use frequencyspace parameters lm compute diffuse component b 1 subtracted input image leaving specular component angularspace lighting found phase 2 compute coefficients l 2 lm used determine consistency condition b 1 l 1 lm subsequent figures lighting visualized unwrapping sphere ranges equal increments 0 top bottom ranges equal increments 0 2 left right image wraps around horizontal direction 1 9 parameters highresolution lighting inputs phase 1 coefficients l 1 lm suffice find b 1 equation 21 since assumed b sfast 0 lslow assume brdf parameters known b input algorithm righthand side evaluated 2 highresolution lighting 9 parameters using angular space values l found first phase easily find 9 frequencyspace parameters lighting l 2 lm assume run phase 1 inputs l 1 lm phase 2 outputs l 2 sequentially consistency condition lm converting frequency angular frequency space must change result equivalently computed diffuse components must match ie b 1 lm illustrated figure 8 since everything linear terms lighting coefficients consistency condition reduces system 9 simultaneous equations solving llm run phase 1 determine highresolution lighting angular space figure 9 compares methods reference solution gazing sphere algorithms give reasonably accurate results predicted theory highfrequency components filtered roughness first method involving direct recovery llm still residual energy l l since regularize considering higher frequencieswe could increase l makes result noisierthe recovered lighting somewhat blurred compared dual angular frequencyspace algorithm second method real gazing sphere algorithm 1 f figure 9 comparison inverse lighting methods left right real lighting gazing sphere recovered illumination direct estimation spherical harmonic coefficients l estimation dual angular frequencyspace lighting model make artifacts apparent set 0 gray results dual algorithm sharper still somewhat blurred filtering small amount ringing occurs direct coefficient covery seen l using l makes solution noisy 63 factorizationunknown lighting brdf combine inversebrdf inverselighting methods factor reflected light field simultaneously recovering lighting brdf unknown therefore able recover brdfs curved surfaces unknown complex illumination something previously demon strated unrecoverable global scale factor set cannot find absolute reflectance also theory predicts lowfrequency lighting estimation surface roughness illconditionedblurring lighting sharpening brdf significantly change reflected light field however highfrequency lighting ambiguity removed use single manually specified directional source recovered lighting distribution estimate algorithm algorithm consists nested procedures outer loop effectively solve inversebrdf problema nonlinear simplex algorithm adjusts brdf parameters minimize error respect image pixels since kd solved till lighting brdf parameters recovered ks inner procedure linear problem solved estimate lighting given set brdf parameters using methods previous subsection pseudocode given global binput input images global kd ks brdf parameters global l lighting procedure factor minimizeks objfun simplex method figure 10 equation 26 function objfunks lighting field return rmsbinput bpred rms error finding using directional source directional source presentand manually specified us recovered lightingwe estimate equating specular components predicted equations 22 23 center ie brightest point light source normal exitance illustration figure 10 total f tot figure 10 manually specify red box region corresponding directional source visualization lighting algorithm determines lcen intensity center brightest point l tot total energy integrated region specified red box computes using equation 26 method depend size red boxprovided encloses entire filtered source precise shape source filtered recovered lighting results used method subsectionwith dual angular frequencyspace algorithm inverse lightingto factor light field spheres simultaneously estimating brdf lighting setup lighting used spheres could compare recovered illumination see figure 11 brdf estimates unknown lighting accurate absolute errors small compared parameters recovered known lighting significant anomalies slightly low values refractive index caused cannot know highfrequency lighting com ponents necessary accurately estimating fresnel term also able estimate filtered version lighting shown figure 12 recovered lighting distributions samples largely consistent predicted theory directional source spread different extents depending rough surface ie value finally figure 12 shows rendered images using estimated lighting brdf almost indistinguishable real photographs material k ks known unknown known unknown known unknown known unknown teflon delrin 087 088 013 012 144 135 010 011 neoprene rubber 092 093 008 007 149 134 010 010 sandblasted steel 020 014 080 086 020 019 bronze painted 627162 677564 029 025 138 115 015 015 figure 11 brdfs various spheres recovered known section 61 unknown section 63 lighting reported values normalized k values reported colored objects see ks much higher specular metallic spheres especially high rough sandblasted sphere fresnel effect close 1 metals consider fresnel term spheres lighting known lighting unknown lighting images images images bronze sandblasted painted delrin f teflon real lighting filtered version real rendered rendered recovered real lighting figure 12 spheres rendered using brdfs estimated known section 61 unknown section 63 lighting algorithm section 63 also recovers lighting since unknown global scale scale recovered lighting distributions order compare recovered illumination largely consistent samples similar filtered version real lighting predicted theory different roughnesses cause directional source spread different extents filtered source slightly elongated asymmetric microfacet brdf completely symmetric reflection vector 64 complex objectstexture shadowing demonstrate algorithms objects complex ge ometry discuss extensions handle concave surfaces textured objects although theory developed homogeneous surfaces algorithms extended textured objects simply letting brdf parameters functions surface position would appear concave regions one part surface may shadow another serious problem since theory developed convex objects assumes selfshadowing however using new practical model section 53 see extensions necessary mainly involve checking shadowing reflected ray directional sources routine operations raytracer shadowingconcave surfaces practical model reflected light field consists 3 partsbd b sslow b sfast sslow depends lslow r slowlyvarying component lighting evaluated reflection vector model allows us approximate effects shadowing simply checking reflected ray shadowed components handled standard manner consider shadowing computing b sfast corresponding specularities directional sources check sources shadowed bd depends irradiance e computed conventional angular space way integrating scene lighting considering vis ibility instead using 9parameter lighting approximation equation 21 emphasized cases corrections visibility depend object geometry precomputed point object using ray tracer parametric brdf estimation modify component equation 24 consider visibility discussed first inverse lighting method directly recovers coefficients llm modified similarly equation 25 check reflected ray shadowed consider shadowing computing irradiance due ylm note b still linear combination lighting coefficients still solve linear system llm however difficult extend dual angular frequencyspace method inverse lighting handle concave surfaces bd longer depends 9 lighting coefficients llm l 2 light field factorization simply extend inverselighting methods discussed white cat sculpture used test algorithms complex geometric objects include concavities geometry acquired using cyberware range scanner aligned images manually specifying correspondences lighting slightly complex spheres experiment used second directional source addition area source show recover brdfs using small number images used 3 input photographs recovered brdfs known lighting using method section 61 unknown lightingusing factorization method section 63 inverse lighting component direct recovery spherical harmonic coefficients using l comparisons photographs renderings figures 1 13 brdf lighting parameters tabulated figure 14 experiment indicates methods brdf recovery known unknown lighting consistent accurate even complex lighting geometry rendered images close original photographs even viewing lighting conditions used brdf recovery prominent artifacts imprecise geometric alignment insufficient geometric resolu tion instance since geometric model include eyelids cat feature missing rendered images textured brdfs since theory shows factorization lighting texture ambiguous consider recovery textured brdfs known lighting fairly straightforward allow kd x ks x described textures depend surface position x inner procedure parametric brdf estimation algorithm section 61 simply solve separate linear problem point x estimate kd x ksx experimental test used wooden doll compared real input photographs images rendered using recovered textured brdf also took photograph object single directional source compared rendering using textured brdf recovered complex illumination results figure 15 show renderings closely resemble real photographs main artifact blurring texture geometryimage misregistration 7 conclusions future work paper developed signalprocessing framework inverse rendering qualitative observation reflected light field convolution lighting brdf formalized mathematically shown frequencyspace gazing sphere wellsuited recovering lightingthe frequency spectrum mirror brdf delta function constantand input view view rendered known lighting real photograph rendered unknown lighting figure 13 comparison real photographs middle column images rendered using brdfs recovered known lighting left column using brdfs lighting estimated unknown lighting right column top row one 3 input views bottom row new view used brdf estimation note top row composited left right renderings background middle photograph order make meaningful comparison parameter known lighting unknown lighting brdf parameters k 088 090 ks 012 010 lighting coefficients lm figure 14 brdf lighting parameters cat sculpture see good agreement brdf parameter values recovered known unknown lighting showing methods consistent note normalize kd may also check accuracy recovered lighting since unknown global scale recovered values report normalized lighting coefficient values first 9 spherical harmonic coefficients real form important significantly affect diffuse component brdf directional source wellsuited recovering brdf estimating brdf filter considering impulse sponse conditioning properties wellposedness brdf lighting estimation various conditions de rived well explicit formula factoring reflected light field lighting brdf illconditioning observed marschner greenberg 20 estimating lighting lambertian surface explained shown factorization lighting effects lowfrequency texture biguous results indicate theory provides useful analytical tool studying properties inverse problems insights gained theory also lead new practical representation numerically represent quantities angular frequency space depending lo cal leads new algorithms often expressed combination angular frequencyspace determine brdf lighting parameters important handle various components appropriately brdf estimation parametric recovery algorithms yu malik 39 sato ikeuchi 31 love 17which designed specifically natural lightingcan seen special cases general rendered real rendered 1 view original input sequence view novel lighting real figure 15 recovering textured brdfs complex lighting rendered images closely resemble real photographs even novel lighting treat sunlight highfrequency skylight low separately provide general framework arbitrary illumination also determine conditions parameter recovery robust instance theory predicts estimation illconditioned cloudy day lowfrequency lighting framework also applied developing new frequencyspace algorithms estimate lighting objects general brdfs use frequencyspace naturally handles continuous lighting distributions dual angular frequencyspace algorithm effectively reduces problem general brdfs gazing sphere requires explicit reg ularization allows much higher resolutions obtained previous purely angularspace methods 20 30 finally demonstrate method factoring light field simultaneously estimate lighting brdf allows us estimate brdfs geometrically complex objects unknown general lighting previously demonstrated scratched surface possible applications future likely many algorithms derived using basic approaches outlined possible algorithmic improvements include extending consistency condition inverse lighting use colorspace methods 13 help separate diffuse specular components colored objects finally discussed inverse rendering applications believe convolutionbased approach theoretical practical importance many areas computer graphics already shown 28 use 9 term irradiance approximation efficient forward rendering diffuse objects environment maps believe many applications acknowledgements grateful marc levoy many helpful initial discussions regarding interpretation reflection convolution practical issues inverse rendering well reading draft paper thank szymon rusinkiewicz many suggestions regarding research reading early versions paper ever willing assist us debugging problems gantry steve marschner also deserves thanks detailed comments many early drafts jean gleason baltec assisted supplying us mirror sphere finally thank john parissenti polytec products much useful advice obtaining uniform spheres getting one steel spheres sandblasted cat range scan sculpture serenity sue dawes work described paper supported part hodgsonreed stanford graduate fellowship nsf itr grant 0085864 interacting visual world r lambertian reflectance linear subspaces increased photorealism interactive architectural walkthroughs bidirectional reflection functions surface bump maps volumetric method building complex models range images reflectance texture realworld surfaces acquiring reflectance field human face estimating surface reflectance properties images unknown illumination computational models visual processing numerical algorithms group determining reflectance properties object using range brightness images group theory applications physics image based measurement system anisotropic reflection measurement highlights color images phenomenological description bidirectional surface reflection lightness retinex theory surface reflection model estimation naturally illuminated image sequences optical properties bidirectional reflection distribution functions velvet spherical harmonics inverse lighting photography inverse radiative transfer problems review simulated objects simulated real environments geometric considerations nomenclature reflectance efficient rerendering naturally illuminated environments hydrologic optics analysis planar light fields homogeneous convex curved surfaces distant illumination efficient representation irradiance environment maps relationship radiance irradiance determining illumination images convex lambertian object illumination distribution brightness shadows adaptive estimation illumination distribution unknown reflectance properties shadow regions reflectance analysis solar illumination object shape reflectance modeling observation global illumination solution general reflectance distributions inverse rendering computer graphics estimating reflection parameters single color image theory offspecular reflection roughened surfaces siggraph 92 inverse global illumination recovering reflectance models real scenes photographs recovering photometric properties architectural scenes photographs flexible new technique camera calibration tr bidirectional reflection functions surface bump maps global illumination solution general reflectance distributions determining reflectance properties object using range brightness images measuring modeling anisotropic reflection volumetric method building complex models range images object shape reflectance modeling observation recovering photometric properties architectural scenes photographs increased photorealism interactive architectural walkthroughs reflectance texture realworld surfaces inverse global illumination digital michelangelo project acquiring reflectance field human face flexible new technique camera calibration efficient representation irradiance environment maps estimating reflection parameters single color image reflectance analysis solar illumination inverse rendering computer graphics ctr makoto okabe yasuyuki matsushita takeo igarashi heungyeung shum illumination interactive design imagebased lighting acm siggraph 2006 research posters july 30august 03 2006 boston massachusetts g h hu k ong p chen c nee technical section reflectance modeling textured object uncontrolled illumination high dynamic range maps computers graphics v31 n2 p262270 april 2007 martin fuchs volker blanz hendrik lensch hanspeter seidel reflectance images modelbased approach human faces ieee transactions visualization computer graphics v11 n3 p296305 may 2005 gustavo patow xavier pueyo alvar vinacua technical section userguided inverse reflector design computers graphics v31 n3 p501515 june 2007 kuangchih lee jeffrey ho david j kriegman acquiring linear subspaces face recognition variable lighting ieee transactions pattern analysis machine intelligence v27 n5 p684698 may 2005 ravi ramamoorthi melissa koudelka peter belhumeur fourier theory cast shadows ieee transactions pattern analysis machine intelligence v27 n2 p288295 february 2005 enhua wu qimin sun xuehui liu recovery material complex illumination conditions proceedings 2nd international conference computer graphics interactive techniques australasia south east asia june 1518 2004 singapore ning xu narendra ahuja shape view independent reflectance map multiple views international journal computer vision v73 n2 p123138 june 2007 bei xiao david h brainard color perception 3d objects constancy respect variation surface gloss proceedings 3rd symposium applied perception graphics visualization july 2829 2006 boston massachusetts ravi ramamoorthi analytic pca construction theoretical analysis lighting variability images lambertian object ieee transactions pattern analysis machine intelligence v24 n10 p13221333 october 2002 jan kautz peterpike sloan john snyder fast arbitrary brdf shading lowfrequency lighting using spherical harmonics proceedings 13th eurographics workshop rendering june 2628 2002 pisa italy raanan fattal dani lischinski michael werman gradient domain high dynamic range compression acm transactions graphics tog v21 n3 july 2002 sara keren ilan shimshoni ayellet tal placing threedimensional models uncalibrated single image architectural scene proceedings acm symposium virtual reality software technology november 1113 2002 hong kong china yang wang dimitris samaras estimation multiple directional light sources synthesis augmented reality images graphical models v65 n4 p185205 july jefferson han ken perlin measuring bidirectional texture reflectance kaleidoscope acm transactions graphics tog v22 n3 july imari sato takahiro okabe yoichi sato appearance sampling real objects variable illumination international journal computer vision v75 n1 p2948 october 2007 paul debevec andreas wenger chris tchou andrew gardner jamie waese tim hawkins lighting reproduction approach liveaction compositing acm transactions graphics tog v21 n3 july 2002 chang ha lee xuejun hao amitabh varshney light collages lighting design effective visualization proceedings conference visualization 04 p281288 october 1015 2004 jan kautz peterpike sloan jaakko lehtinen precomputed radiance transfer theory practice acm siggraph 2005 courses july 31august jaakko lehtinen jan kautz matrix radiance transfer proceedings symposium interactive 3d graphics april 2730 2003 monterey california kenji hara ko nishino katsushi ikeuchi light source position reflectance estimation single view without distant illumination assumption ieee transactions pattern analysis machine intelligence v27 n4 p493505 april 2005 ravi ramamoorthi dhruv mahajan peter belhumeur firstorder analysis lighting shading shadows acm transactions graphics tog v26 n1 p2es january 2007 martin fuchs volker blanz hendrik pa lensch hanspeter seidel adaptive sampling reflectance fields acm transactions graphics tog v26 n2 p10es june 07 srinivasa g narasimhan mohit gupta craig donner ravi ramamoorthi shree k nayar henrik wann jensen acquiring scattering properties participating media dilution acm transactions graphics tog v25 n3 july 2006 xuejun hao thomas baby amitabh varshney interactive subsurface scattering translucent meshes proceedings symposium interactive 3d graphics april 2730 2003 monterey california ravi ramamoorthi pat hanrahan frequency space environment map rendering acm transactions graphics tog v21 n3 july 2002 sara keren ilan shimshoni ayellet tal placing threedimensional models uncalibrated single image architectural scene presence teleoperators virtual environments v13 n6 p692707 december 2004 imagebased skin color texture analysissynthesis extracting hemoglobin melanin information skin acm transactions graphics tog v22 n3 july david akers frank losasso jeff klingner maneesh agrawala john rick pat hanrahan conveying shape features imagebased relighting proceedings 14th ieee visualization 2003 vis03 p46 october 2224 imari sato yoichi sato katsushi ikeuchi illumination shadows ieee transactions pattern analysis machine intelligence v25 n3 p290300 march g narasimhan shree k nayar practical analytic single scattering model real time rendering acm transactions graphics tog v24 n3 july 2005 andrew gardner chris tchou tim hawkins paul debevec linear light source reflectometry acm transactions graphics tog v22 n3 july michael grossberg shree k nayar modeling space camera response functions ieee transactions pattern analysis machine intelligence v26 n10 p12721282 october 2004 frdo durand nicolas holzschuch cyril soler eric chan franois x sillion frequency analysis light transport acm transactions graphics tog v24 n3 july 2005 wojciech matusik hanspeter pfister addy ngan paul beardsley remo ziegler leonard mcmillan imagebased 3d photography using opacity hulls acm transactions graphics tog v21 n3 july 2002 weichao chen jeanyves bouguet michael h chu radek grzeszczuk light field mapping efficient representation hardware rendering surface light fields acm transactions graphics tog v21 n3 july 2002 ronen basri david w jacobs lambertian reflectance linear subspaces ieee transactions pattern analysis machine intelligence v25 n2 p218233 february ko nishino shree k nayar eyes relighting acm transactions graphics tog v23 n3 august 2004 xuejun hao amitabh varshney realtime rendering translucent meshes acm transactions graphics tog v23 n2 p120142 april 2004 steven seitz kiriakos n kutulakos plenoptic image editing international journal computer vision v48 n2 p115129 july 2002 shree k nayar peter n belhumeur terry e boult lighting sensitive display acm transactions graphics tog v23 n4 p963979 october 2004 hendrik p lensch jan kautz michael goesele wolfgang heidrich hanspeter seidel imagebased reconstruction spatial appearance geometric detail acm transactions graphics tog v22 n2 p234257 april ravi ramamoorthi pat hanrahan signalprocessing framework reflection acm transactions graphics tog v23 n4 p10041042 october 2004 rodrigo l carceroni kiriakos n kutulakos multiview scene capture surfel sampling video streams nonrigid 3d motion shape reflectance international journal computer vision v49 n23 p175214 septemberoctober 2002 hendrik p lensch michael goesele yungyu chuang tim hawkins steve marschner wojciech matusik gero mueller realistic materials computer graphics acm siggraph 2005 courses july 31august hendrik p lensch michael goesele yungyu chuang tim hawkins steve marschner wojciech matusik gero mueller realistic materials computer graphics acm siggraph 2005 courses july 31august