firstorder topological queries one important class spatial database queries class topological queries queries invariant homeomorphisms study topological queries expressible standard query language spatial databases firstorder logic various amounts arithmetic main technical result combinatorial characterization expressive power topological firstorder logic regular spatial databases b introduction expressive power firstorder logic finite relational databases well understood ahv95 ef95 much less known spatial databases also called constraint databases relations longer finite finitely represented klp99 notion genericity invariance queries isomorphisms fundamental relational database model generalized spatial databases various ways pvv94 given group g transformations trans lations affinities isometries similarities homeomorphism etc query q ggeneric database instances transformation fog denote set ggeneric firstorder queries genericity firstorder query undecidable pvv94 expressive power fo g understood via sound complete decidable languages language said sound g contains fo g queries complete g expresses fo g queries choice group g depends information one interested gvv97 gives sound complete languages several natural groups transformations translations affinities isometries similarities case group homeomorphisms left open appear proceedings 15th ieee symposium logic computer science c ieee 2000 queries invariant homeomorphisms also called topological queries fundamental importance various applications spatial databases ex ample geographical databases queries like region adjacent region b road b island come naturally therefore topological queries received lot attention literature eg kpv97 psv99 sv98 kv99 basic result known topological queries connectivity region expressible firstorder logic gs99 gs97 bdlw96 thinking geographical databases planar 2 dimensional database instances relations embedded plane r 2 particular importance psv99 proven topological properties planar spatial database represented finite structure called topological invariant instance sv98 shown topological invariant used answer topological queries particular sv98 proven firstorder topological queries spatial database automatically translated fixpoint queries topological invariant translation firstorder topological queries spatial database firstorder queries topological invariant proven possible special case single relation representing closed region left open sv98 whether translation could extended case several gions answer question negatively idea representing topological information spatial database instance topological invariant two important drawbacks sense topological invariant contains much information ideally would want store information actually accessible query language usually fo furthermore topological invariant straightforward generalization higher dimensions issue finding invariant suitable fo computable dimension raised kpv97 special case one single relation representing closed planar region cone structure given kpv97 capturing precisely firstorder topological information intuitively cone structure finite set containing possible small neighborhoods point results kpv97 show context firstorder topological queries could express local properties situation known true finite case kpv97 asked whether results generalize database instances region necessarily closed give negative answer question instances one closed region satisfy additional technical condition fully two dimensional kv99 introduced cone logic cl proved sound complete topological fo asked results generalize instances necessarily closed regions several regions give negative answer kpv97 introduced two local operations spatial database instances preserve equivalence firstorder topological queries called topological elementary e quivalence call two instances equivalent transformed instances homeomorphic applying operations kpv97 finitely often main technical result rest easily follows especially simple instances call regular equivalence topological firstorder equivalence coincide paper organized follows recalling basic definitions spatial databases section 2 section 3 discuss topology planar spatial databases topological invariant detail section 4 introduce topological firstorder queries review results kpv97 section 5 prove equivalence decidable pspace main result regular instances proved section 6 section 7 derive firstorder topological queries translated firstorder queries topological invariant section 8 briefly discuss problem finding language sound complete topological fo 2 preliminaries spatial databases fix underlying structure r reals either let r 0 1 r r poly vocabulary r ie either point jja bjj rg open ball radius r around 1 matter fact could let r ominimal structure reals main results would remain true poly may also let 2 n assume done figures looks better since interested topological queries makes difference subset r n n 1 rdefinable firstorder formula x vocabulary r schema finite collection region names let n 1 ndimensional spatial database instance associates rdefinable set r r n every r 2 sets r called regions formally may interpret region names nary relation symbols view instance firstorder structure vocabulary r obtained expanding underlying structure r relations r 2 paper consider 2dimensional pla spatial database instances convenience also assume regions bounded ie every instance schema every r 2 exists r jjajj b 2 r boundedness assumption inessential easily removed occasionally simplifies matters queries nary query n 0 schema mapping q associates rdefinable subset qi r n every instance consider r 0 one point space let r query usually called boolean query basic query language take firstorder logic fo vocabulary r defines nary query 7 fa g schema 3 topology planar instances r 2 equipped usual topology interior set r 2 denoted ints closure cls boundary bds say set r 2 touches point 2 r 2 2 cls two sets touch 2 touches point 2 1 vice versa stratifications stratification fundamental fact makes topology instances easy handle stratification instance finite partition r 2 1 2 either one point set homeomorphic open interval 0 1 homeomorphic open disk 2 cls cls 0 union elements 3 r 2 2 either r following lemma follows fact regions instance rdefinable proof found vdd98 lemma 31 every instance exists stratification colors cones let instance pre color point 2 r 2 mapping fint bdi bde extg defined int 2 intr bde 2 bdr n r ext 2 r 2 n clr precell maximal connected set points precolor cone point 2 r 2 denoted conea circular list precolors precells touching lemma 31 implies cones welldefined finite point 2 r 2 regular every neighborhood u point 0 2 u otherwise singular follows lemma 31 instance finitely many singular points call instance regular singular points cones figure 1 two singular two regular cones regular singular points also called regular singular resp cf figure 1 conetype denoted cti list cones appearing furthermore every singular cone list also records often occurs color point 2 r 2 pair cells cell color maximal connected set points color color cell c denoted c lemma 31 implies finitely many cells assumption regions bounded implies precisely one unbounded cell call exterior lemma 31 implies every cell well defined dimension either 0 1 2 0 dimensional cells precisely sets fag singular point let c set cells instance define binary adjacency relation e c letting two cells adjacent touch call graph cell graph partition c three subsets c 1 c 2 consisting 0 1 2 dimensional cells respectively observe graph g tripartite partition c planar lemma 32 let instance c 2 c 1 c 2 c either c homeomorphic open disk 0 exists 1 c homeomorphic open disk dm holes definite let dm n cl c homeomorphic sphere open interval 0 1 proof follows easily lemma 31 2 skeleton instance set 0 dimensional cells 1dimensional cells homeomorphic 0 1 note skeleton regular instance empty lemma 33 let instance every connected component graph g n tree particular regular g tree proof follows jordan curve theorem lemma 32 2 figure 2 illustrates typical connected component instance removing skeleton note every con figure 2 nected component graph g n unique ex terior cell may consider root tree tree directed fixing root may speak parent children node following observation useful later lemma 34 let 0 instances c 2 c 0such 2 adjacent c exists 2 adjacent c 0 topological invariant two instances j schema homeomorphic homeomorphism 2 r 2 r 2 2 r ha 2 r j topological invariant instance expansion cell graph carries enough information characterize instance homeomorphism vocabulary r 8ary r r 2 unary restriction feg cell graph g dim consists idimensional cells 2 x contains exterior unique unbounded cell every r 2 unary relation r consists cells subsets r gives orientation equivalence relation quadruples c adjacent c two quadruples equivalent either clockwise order cells adjacent c 2 f1 2g b 0 appears anticlockwise order cells adjacent c 2 f1 2g 3 note empty regular instances proven psv99 j homeomorphic iff j isomorphic computable time polynomial size since g planar graph canonization planar graphs p time actually assume canonical sense homeomorphic instances j sv98 proven foqueries translated linear time fixpointcounting queries furthermore foqueries translated foqueries instances one closed region precisely means recursive mapping associates every 2 fo vocabulary f rg 0 2 fo vocabulary frg instances frg r closed set question left open whether result extends instances one arbitrary region several regions section 6 give negative answer question 3 various ways define orientation equivalent sv98 4 precisely ptime algorithm given instance computes onetoone mapping c canonical numbering homoemorphic instances j mapping isomorphism j 4 topological queries topological elementary equivalence topological queries query topological every homeomorphism h r 2 instances denotes set firstoder formulas defining topological query wellknown easy see set fo top decidable following lemma collects basic foqueries proof easy exercise lemma 41 1 every color firstorder x every instance every 2 r 2 2 every 2 fo formula bd fo every instance bd 3 formula 1 x 2 fo every instance note every color formula fo top moreover 2 fo top formula bd fo top particular case r 2 hand formula 1 fo top topological elementary equivalence two instances j topologically elementary equivalent denoted j satisfy topological firstorder sentences proven kpv97 frg instances j r r j closed sets j see next section equivalence cannot extended instances one arbitrary region several regions prove result kpv97 introduced two simple local operations transforming instance elementary equivalent one straightforward extension several regions depicted figure 3 read fol lows suppose instance contains open subset r 2 homeomorphic one left hand sides figure 3 different shades grey display different colors replaced corresponding subset right hand side cf kpv97 details note operations symmetric go right left applying operation first 2 second two operations figure 3 instances j write j transformed instance homeomorphic j application 2 f1 2g figure 3 operations preserving j j transformed finite sequence operations 1 2 proof kpv97 easily yields lemma 42 instances j j open question whether converse lemma 42 holds particular interesting known whether decidable whereas decidable pspace proposition 55 next sec tion kpv97 shown coincide instances one closed region extend result several regions instances regular cones 5 minimal instances definition 51 instance minimal satisfies following two conditions 1 homeomorphic 1 iare adjacent c homeomorphic dm adjacent b homeomorphic 1 lemma 52 ptime algorithm associates every instance minimal instance mi mi done way homeomorphic instances j proof suppose first satisfy m1 show transformed instance j fewer cells violating m1 two applications 1 let c 1dimensional cell homeomorphic 1 neighbors c color neither homeomorphic instance locally looks like figure 41 apply 1 twice dashed boxes obtain instance locally looks like figure 43 obviously reduced number cells violating m1 1 2 3 figure 4 suppose satisfy m2 transformed instance j fewer cells violating m2 application 1 without violating m1 see let b 2dimensional cell adjacent cells c homeomorphic 1 color cell homeomorphic 1 adjacent two 2 dimensional cells let neighbors color distinguish two cases case 1 c 1 c 2 children b reduce number cells violating m2 application figure 5 1 2 figure 5 case 2 c 1 parent b c 2 child figure 6 shows proceed 1 2 figure 6 ptime algorithm transforming given instance minimal instance mi may proceed follows given algorithm first computes invariant possible ptime psv99 operations 1 2 translate simple local operations algorithm first applies pairs 1 m1 holds figure 4 holds done simple greedy strategy result structure toplogical invariant minimal instance mi shown psv99 given invariant instance j computed polynomial time canonical cf page 4 algorithm also guarantees homeomorphic instances j language instance fundamental curve instance rdefinable continuous mapping lim a1 jjf ajj 1 f fundamental curve every 2dimensional cell set f 1 c finite union open intervals one form one form b 1 every 0 1dimensional cell c set f 1 c finite union closed intervals may single points follows fact f rdefinable interested finite sequence colors appearing fundamental curve ie finite word w f alphabet consisting colors appearing say word w 2 realized fundamental curve f w f language li set words realized example 53 let instance r fa 2 r 2 j 12 jjajj 1g five cells c 1 fa colors c respectively note c 5 color c 1 figure 7 b figure 8 example words realized cf figure 7 hard see li described finite automaton displayed figure 8 example easy see every language li regular accepted automaton essentially cell graph formally let instance define finite automaton 1 new symbol denote cell fc denotes exterior note graph underlying cell graph g extended one additional vertex 1 adjacent exterior proof following lemma straightforward lemma 54 every instance automaton accepts li thus li regular language walk graph e sequence 1 n mapping almost immediate every instance wn walk g usual ext denotes exterior proposition 55 decidable pspace proof given two instances j want check pspace whether possible go j using homeomorphisms operations given instance possible compute invariant ptime psv99 thus problem reduces checking pspace whether j derived using operations polynomially many different ways apply operators one consider tuples 5 cells check applied tuple let set invariants obtained applying one operation previous remarks show contains polynomially many elements computed ptime therefore possible enumerate topological invariants derived applying operations check step whether corresponds j latter done ptime deciding whether two planar graphs isomorphic give strategy ensures process stop mi mj computable ptime lemma 52 assume j minimal easy see operations change cones instances involved therefore j implies j conetype cf page 3 orientation relation checked ptime cones determine number 1dimensional cells homeomorphic 0 1 implies instances j j respective skeletons verify js may view skeletons j embedded planar graphs 0dimensional cells vertices 1dimensional cells homeomorphic 0 1 edges let f f j resepectively denote faces embedded graphs note faces correspond precisely connected components g n g j n j spectively number connected components j bounded c ji j number cones therefore number faces j given euler formula jf j number connected components j e v number edges vertices bounded ji j jf j j gives linear ji j bound number connected components g j n j would also like bound size connected component g j n j equivalently number 1dimensional cells homeomorphic 1 un fortunately repeated application operations 1 may produce arbitrary large components nevertheless possible decide pspace whether k instance k isomorphism k j preserves coloring orientation furthermore k computed pspace complexity pspace need produce extra 1dimensional cells homeomorphic 1 process would restrict number possible connections connected components skeleton without loss generality assume j minimal isomorphic skeletons recall every face f 2 f f 2 f j corresponds connected component f g n g j n j respectively lemma 33 f tree canonical root exterior cell find whether j isomorphism preserves coloring orientation check whether instances 0 j 0 0 every face f 2 f 0 f denotes face corresponding f isomorphism suffices prove following every f 2 f claim 1 either 6 j j transformed instances 0 j 0 respectively 0 0 component f isomorphic ffg component g 0 remained h 2 f j n fifg component h j 0 remained j decided pspace two alternatives holds latter 0 j 0 also computed pspace go isomorphism pspace fix one also fix face f 2 f going need following definitions branch tree minimal walk going root one leaves walk g said regular never goes singular cell let set colors j word w 2 define mw word computed using rules spirit lemma 52 precisely means rewriting word w using rules colors fact 1 let x regular walk g starts possible transform way f contains branch x x proved single loop length starting end without loss generality assume xn 2dimensional cell start constructing xn 2 new ball vn 1 vn colo easily done applying 1 2 assume next constructed subinstance whose cell graph path attached x apply 1 2 order get v surrounding v i1 vn kind induction starting beginning word time shows converse also holds fact 2 possible construct using operations new branch f exists walk x g starting e f say walk x realizes word w checked pspace whether given word realized walk g starting e f one way see reduce problem question whether two regular languages nonempty intersection prove claim 1 first transform 0 branch x starting e let w x check whether walk x 0 realizes w x case fact 2 shows 6 j case use fact 1 construct corresponding branch construct j 0 reversing role j clear algorithm find j way minimizing resulting instances satisfy claimin next section convenient work slight simplification cell graph call 2 dimensional cell b 6 ext instance inessential b homeomorphic disk thus precisely one neighbor g neighbor c b g another neighbor b let h graph obtained g deleting vertices inessential cells call h reduced cell graph 51 actually holds h instead g wn walk h 6 regular instances recall instance regular points 2 r 2 regular main result section coincide regular instances corollary see equivalence 41 extend beyond instances one closed region illustrate problems let us start simple example example 61 let consider two instances j r fa 3 jjajj 1g r j j r cf figure 9 obviously j conetype figure 9 let us try find sentence 2 fo top j 6j first glance looks easy take sentence saying every horizontal line intersects region r intersects region every instance homeomorphic satisfies every instance homeomorphic j satisfy unfortunately 62 fo top figure 10 shows three instances displayed homeomorphic last one satisfies see later sentence 2 fo top distinguishes j quite complicated let us note 6 j figure 10 recall lemma 33 cell graph thus reduced cell graph regular instance tree think tree directed exterior root leaves 2dimensional cells homeomorphic disk instances j write h h j embedding h h h j preserves define accordingly lemma 62 regular instances j h h j j homeomorphic proof backward direction trivial forward direction let j regular instances h h j follows lemma 34 g g j since regular instances orientation empty implies thus j homeomorphic psv992 recall definition minimal instance mi associated instance inspection proof lemma 52 shows regular instance minimal regular instance reduced cell graph h following nice property c vertex h neighbors c h different colors 62 lemma 63 let mn minimal regular instances proof easy consequence 52 62 2 recall regular language l aperiodic exists n 2 n u v w 2 uv n w 2 l also uv n1 w 2 l wellknown theorem mcnaughton papert mp71 schutzenberger sch65 aperiodic languages precisely languages definable firstorder logic 5 following lemmas useful later based 62 fact reduced cell graphs regular instances trees 5 furthermore precisely starfree regular languages lemma 64 let minimal regular instance lm aperiodic proof let minimal regular instance crucial step prove following claim let walk h suppose contradiction 63 wrong choose l minimal v 2 l n 2 walk since adjacent vertices cell graph thus reduced cell graph different colors l1 l 2 notational convenience let 0 nl choose nlg j subtree parent let 0 k n 62 implies klj1 l 2 implies tion l 3 define walk 0 deleting klj klj1 0 k n 1 63 holds contradiction minimality l proves 63 let n jh j u v w 2 shall prove uv n1 w 2 lm let k l length u v w respectively x walk h exist x applying 63 walk walk minimal regular instance instances j proof recall definitions operations 1 2 figure 3 suffices prove statement instances lm note word obtained w replacing letters subwords j 1 j 0 suppose contradiction w 0 2 lm walk x 0 h 62 whenever hence n walk h similarly x contradiction shows w 0 lemma 66 let minimal regular instance j regular instance lj 6 lm r curve f b x 7 x b proof assume j instances schema denoting ext ext 0 exterior j respectively every walk define sequence n follows let x 0 62 unique neighbor x 0 1 color x x 0 neighbor exists x 0 h j tree h satisfies 62 x j x 0 follows walk 0 note actually sequence x 0 depends word x x 0 suppose x 0 xm1 must child xm tree h j choose b 2 r curve f b intersects cell xm1 let l walk h j corresponds curve f b let j l minimal xm1 xm1 child xm either 0 case theorem 67 let regular instance schema sentence 2 fo top vocabulary fg instance j schema satisfies j proof let set colors appearing every aperiodic language l formula l 2 fo vocabulary fg regular instance satisfies l b b 2 r w f b 2 l easy consequence theorem mcnaughton papert schutzenberger aperiodic languages precisely firstorder definable languages let mi l lm lemma 64 l aperiodic let clearly satisfies claim instances j prove claim note first every instance satisfying realizes cones thus regular let j regular instance assume first j lemma 66 lj lm j mj lemma 65 lmj lm thus conversely mj thus j proves 64 follows easily 2 fo top indeed assume every j 0 homeomorphic j let n minimal regular instance h n shall prove instance j schema suppose j mj 64 lemma 66 implies lmj lm minimal regular n h n h lemma 63 implies mj lemma 62 follows mj homeomorphic thus j conversely suppose j lemma 42 thus j 2 fo top later follows easily previous paragraph corollary 68 regular instances j finally ready prove equivalence 41 extend beyond instances one closed region corollary 69 two instances example 61 elementary equivalent neither instances j frg defined r fa 7 translating sentences topological variant recall proven sv98 recursive mapping associates every 2 fo vocabulary f rg 0 2 fo vocabulary frg instances frg r closed set purpose section prove extend arbitrary instances proposition 71 sentence 2 fo top vocabulary f rg every sentence 0 2 fo vocabulary frg instance g 6j 0 proof let 0 j 0 instances defined n 1 let n jn defined r r i0 r r i0 cf figure 11 figure 11 instances 3 j 3 note n 1 n jn jm n 6 jn corollary 68 implies sentence 2 fo top n 1 n jn 6j let n 1 graph g path 5 tices say c denoting colors colors path form following sequence z times z times g jn except relations topological invariant identical jn dim 0 empty dim 1 consists c even dim 2 consists c odd orientation empty finally g standard ehrenfeuchtfrasse techniques show every sentence 0 2 fo n 1 jn statement proposition follows 2 8 completeness languages open problem considered far find recursive language expresses precisely firstorder topological queries although certainly interesting question doubt even theoretically language exists would natural language may serve practical query language results show firstorder topological queries local hand known firstorder logic fails express natural nonlocal topological queries connectivity region kv99 introduced topological query language conelogic cl expressing local properties language two tier language allows build firstorder expressions whose atoms firstorder expressions talking cones colors points kv99 proven cl captures precisely firstorder topological properties instances one closed region fully 2dimensional underlying structure r follows sv98 condition full 2dimensional needed corollary 69 shows result extend instances several closed regions one arbitrary region propose extend cl path operator introduced bgls99 let us call resulting topological query language pcl results bgls99 show language basic properties expected reasonable spatial database query language addi tion admits efficient query evaluation cost evaluating pclquery substantially higher cost evaluating firstorder query example pclquery expressible fo connectivity regions conjecture conversely every fo top query expressible pcl idea behind conjecture local properties expressible cl together language instance described pathoperator seem capture firstorder topological properties instance first step towards proving conjecture let us remark corollary 68 implies regular instances every fo top sentence equivalent set pclsentences 9 conclusions results paper give good understanding firstorder topological queries regular instances course one may argue regular instances completely irrelevant look map find singular points however could use results answer several open questions concerning topological queries arbitrary instances matter fact shown previous understanding firstorder topological queries viewing local sense speak colors points insufficient may main contribution problem characterization topological elementary equivalence arbitrary planar instances remains open conjecture corollary 68 generalizes ie arbitrary instances true proposition 55 topological elementary equivalence would decidable pspace let us remark believe pspacebound proposition 55 optimal see reason decidable np even ptime r foundations databases relational expressive power constraint query lan guages reachability connectivity queries constraint databases languages relational databases interpreted structures safe constraint queries finite model theory queries arithmetical constraints finitely representable databases constraint databases bart kuijpers jan van den bussche topological queries spatial databases finite monoids trivial subgroups querying spatial databases via topological invariants tr towards theory spatial database queries extended abstract queries arithmetical constraints finitely representable databases relational expressive power constraint query languages topological queries spatial databases complete geometric query languages reachability connectivity queries constraint databases querying spatial databases via topological invariants foundations databases constraint databases capturing firstorder topological properties planar spatial databases fixedpoint logics planar graphs ctr michael benedikt jan van den bussche christof lding thomas wilke characterization firstorder topological properties planar spatial data proceedings twentythird acm sigmodsigactsigart symposium principles database systems june 1416 2004 paris france michael benedikt bart kuijpers christof lding jan van den bussche thomas wilke characterization firstorder topological properties planar spatial data journal acm jacm v53 n2 p273305 march 2006