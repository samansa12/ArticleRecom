sequential regularization methods simulating mechanical systems many closed loops numerical simulation problem large multibody systems often treated two separate stages forward dynamics problem computing system accelerations given force functions constraints ii numerical integration problem advancing state time forward dynamics problem algorithms given optimal linear complexity number bodies case system topology contain many closed loopsbut interaction two stages important using explicit time integration schemes propose sequential regularization method srm linear complexity number bodies per time step even presence many closed loops method also handles certain types constraint singularity b introduction growing interest development efficient algorithms multibody dynamics simulations increase size complexity spacecraft robotic systems one motivation development another physicallybased modeling computer graphics numerical simulation process institute applied mathematics department computer science university british aschercsubcca work author partially supported nserc canada grant ogp0004306 institute applied mathematics university british columbia vancouver bc canada v6t 1z2 new address program scientific computing computational math stanford university durand 262 stanford ca 943054040 usa plinsccmstanfordedu typically treated two separate stages first stage consists forward dynamics problem computing system accelerations given various constraints torque force functions treestructured multibody systems algorithms proposed optimal complexity n total number rigid bodies system see eg 10 13 18 6 21 also extended cope systems small number closed loops compared total number n links 10 18 system closed loops n typical complexity obtained using cutloop technique appears hard find algorithm chains large number eg closed loops second stage simulation algorithm design addresses numerical integration problem advancing state time obtaining generalized body positions velocities computed accelerations explicit implicit time discretization schemes generally used two stages usually treated separately situations specific treatment one affects global unified view beneficial eg 6 1 paper use global view simulation process devise method requires operations per time step even presence many closed loops specifically propose using sequential regularization method srm 4 5 purpose combined explicit time integration scheme method produces iterates get arbitrarily close solution discretized differential system also handles certain types constraint singularity mathematical modeling constrained multibody systems yields differentialalgebraic equations daes index 2 3 9 11 treestructured systems ie closed loops one formulate model terms minimal set relative solution coordinates obtaining system ordinary differential equations odes see eg 14 10 existing commercial software packages eg sdfast 1 utilize approach forward dynamics algorithms complexity interpreted imbedding ode dae given time eliminating unknowns locally larger sparser system 6 work however consider equations motion descriptor form see eg 9 14 formulations nonminimal redundant sets coordinates yield often simpler albeit larger dae even treestructured case dae typically treated differentiating constraints acceleration level using one wellknown stabilization techniques see eg 2 3 forward dynamics algorithm formulation recalled x2 following 18 system closed loops may considered composed treestructured system plus set loopclosing constraints latter treated using srm technique method described x3 prove number operations needed per time step using explicit time discretization scheme 1 sdfast trademark symbolic dynamics inc 561 bush street mountain view ca usa remains n method also handles certain types constraint singularities finally x4 demonstrate algorithm two closedloop chain examples algorithms optimal computational complexity treestructured problems 21 general multibody systems consider idealized multibody system consisting rigid bodies point masses kinematic treestructure use redundant world coordinates p positions system ie describing position orientation individual body set feasible positions correspond physically possible geometric configurations given holonomic constraints differentiations constraints respect time yield corresponding constraints velocities accelerations gp constraint jacobian matrix g 0 p eulerlagrange equations combination constraint equations acceleration level 23 eulerlagrange equations form dae index 1 differential variables p v algebraic variables constraints position level 21 velocity level define invariant manifold 25 wellknown simply simulating 25 numerically may cause severe drift constraints manifold manifesting mild instability formulation figure 21 example treestructured chains phenomenon prevented using stabilization techniques eg invariant stabi lization baumgartes stabilization projection methods 2 3 7 regularization techniques eg penalty sequential regularization methods 17 19 12 15 16 4 5 20 numerical integration paper assume stabilization technique already applied included 25 concentrate aspects solving system 22 algorithms treestructured problems consider case multibody system kinematic tree structure 18 consider graph whose nodes correspond joints whose edges represent bodies system see eg figure 21 closed loops graph consists trees tree one joint singled root every joint unique father tree neighboring body path root introduce node 0 father roots fixed joint usually number 0 gives one tree label nodes follows joints numbered 1 n label joint always greater father bodies links numbered body connecting father joint son joint number son example figure 21 joint father joint 7 two joints connected body 7 kind treestructured systems mass matrix symmetric positive definite blockdiagnal blocks symmetric positive definite constraint equations 23 body connecting two joints k father k form see 18 assumed full row rank k analyzed many articles see eg 10 13 18 21 recursive algorithm derived obtain algorithm invert lefthand matrix 25b explain algorithm start terminal joint ie one setting obtain next consider equations joint j terminal sons k ksons j father j son 29 holds substitution 210 yields ksons j ksons j system 211 form 28 recursive algorithm results algorithm step 1 climb tree towards root recursively repeatedly forming f j 212 step 2 starting root tree solve local system 211 u j climbing tree recursively note step 1 replace original problem n local problems 211 algorithm complexity operations local one body climb tree work different subtrees done parallel well result forward dynamics algorithm described expression v terms p ode system must integrated time note dimension u v p 3d 6n contrasted treatment using minimal coordinates u v p may dimension small n however saving latter formulation chiefly time advancement faster forward dynamics algorithms small n forward dynamics algorithm see 6 3 algorithms systems many closed loops consider multibody systems loops problem seen treestructured system plus extra loopclosing constraints form x k x j represent generalized positions joints k j respectively components p represents number loops write 31 mthetan constant matrix full row rank closedloop case need invert matrix instead matrix 25b 0 block gaussian elimination gives schur complement obtained using algorithm described last section using usual techniques inverting results satisfactory small cf 18 problems large number loops appears difficult extend algorithm cf 10 particular om algorithm inverting schur complement available also found discussion literature performance method constraint jacobian matrix rank deficient situation often happens closedloop chains example slidercrank problem 4 5 first example x4 sequential regularization method proposed 4 5 provides possibility address two challenges 31 algorithm write eulerlagrange equations multibody system loops constraints corresponding tree structure 33c number rows may large assume g full rank assumption generally true chain problems see examples x4 already algorithm treestructured problem ie system 33a 33b without 33c develop algorithm treestructured part problem keep structure 33a 33b 33c loopclosing constraints one possibility penalty method penalty parameter however well known use implicit integration schemes system like 34 since ffl small 34 stiff system therefore invert matrix like discretization stepsize h block diagonal previous algorithm difficult apply 4 5 proposed new sequential regularization method srm modification usual penalty method allows us use explicit schemes solve regularized problem hence srm combined explicit time discretization makes possible obtain algorithm problems many loops applying srm problem 33 treat loopclosing constraints obtain new algorithm given 0 apply stabilization method eg baumgartes stabilization 7 first stage invariant stabilization 2 3 projection methods 2 first constraints 33c following system must considered 36c becomes even simpler algorithm suggested 5 general multibody systems without singularities 33 form form computational complexity simpler form 36 since need invert block diagonal matrix however problems singularities illconditioning often appear closedloop chains form 310 recommended indicated already 5 x4 numerical example shows performance worse form 36 also indicated 5 form 310 best choice ffl generally ch reason stability explicit difference schemes h step size chosen difference scheme c constant dependent eigenvalues matrix g g hence best choice ffl form changes time g general dependent time see example x4 ffl chosen quite large hence srm iterations needed make explicit discretization stable whole time interval compute therefore still recommend form 36 since performs better shown x4 since best choice ffl form depends eigenvalues matrix dm constant constant matrix case many chain problems including examples x4 best choice ffl often independent form 36 comparison usual stabilization methods additional advantage 36 never invert singular matrix even singular since g full rank assumed summarize algorithm consists applying explicit time discretization scheme forward dynamics algorithm underlying treestructured system solve next discuss convergence srm prove iteration number method independent body count n hence per time step method algorithm even chains many closed loops 32 convergence stabilizationsrm form want analyze convergence iterative procedure 312 method analysis based 5 differences apply srm part constraints ie loopclosing constraints 31 problem consider may large number unknowns linear n indicated 4 5 system 312 clearly singularly perturbed ffl 1 starting arbitrary 0 may therefore expect initial layer simplicity convergence analysis assume 4 5 assumption 31 initial value problems possible obtain exact j 0 advance 4 5 general semiexplicit dae assumption initial layers solutions 312 lth derivatives let us make assumptions boundedness solution nbody chain reasonable assume solution derivatives bounded linearly n cases solution may bounded independently n make corresponding assumptions p v since regularization nearby problem original system initial layers involved solution condition 313 letting l 0 assumption 32 solutions p v 312 satisfy may depend n 312b 312c solve terms ie write assume jacobian matrix respect p v satisfies also satisfies 314 314 316 imply represents maximum norm k generic positive constant independent n remark 31 give convergence bounds case assume noted mass matrix positive definite blockdiagonal closingloop constraint matrix blocksparse examples x4 see jacobian matrix g constraints 21 blocksparse thus assume assumption 33 matrices g finite multiplications ie number multiplications independent n blocksparse precisely multiply matrix vector norm k product norm still k k positive number fact closingloop constraints matrix blocksparse also block roworthogonal concretely one nonzero element column see eg 46 x4 combining properties thus obtain dm positive definite blockdiagonal hence eigenvalues matrix dm union eigenvalues diagonal blocks matrix thus eigenvalues positive independent n since size elements diagonal blocks dm independent n write lemma lemma 31 mass matrix closingloop constraint matrix properties eigenvalues matrix dm gamma1 positive independent n finally assume following perturbation bound cf perturbation index 11 corresponding discussion 5 assumption 34 let exists constant k independent n z solution 38 z satisfies perturbed 38 although inverting needs operations see algorithm x2 operations involve perturbations ffit believe bound k 318 independent n consider convergence stabilizationsrm form 312 choose 0 0 0 let u drift equations initial conditions u applying 321 using assumptions lemma 31 obtain u 321a yields comparing 319 stabilizationsrm form need bound derivatives appearing 318 already 321a obtain using condition 0 dm obtained 312b 312d 321b differentiating 321b use obtained 312d w obtained 317 hence differentiating 321a next implies thus use 318 obtain desired conclusion subtracting 312a 312b 38a 38b respectively using 322 316 also differentiating 312d conclude 1 first hence also estimate 323 also holds 2 yields right hand side 321b offl 2 want get better estimate differentiating 321b obtained want show offl purpose must estimate using condition 0 fact also exact 0 obtain hence differentiating 324 obtain precisely estimating need use obtained differentiation 312 applications 314 316 317 well estimates obtained noting thus previous estimates allow conclusion hence conclude repeating procedure finally obtain theorem 31 let assumptions described beginning section hold solution stabilizationsrm form 312 0 following error estimates solution multibody problem 33 remark 31 bounds 314 assumed p v may generally obtain jth derivatives would j1 finally yields following error estimates result obviously weaker 327 corresponding weaker boundedness assumptions 33 computational complexity stabilizationsrm form consider algorithm 312 regularization iteration use algorithm described x2 consider computational complexity algorithm need study number iterations required simple show independent n given worst error estimate 328 must choose ffl small enough srm iteration reduces error viz difference solution 312 solution 33 least factor ff fixed number iterations independent n needed reduce error given tolerance note though may grow n depending problem simulated hence range choices ffl ffl ff restricted depending n since time discretization scheme explicit step size h must restricted absolute stability requirements satisfy appropriate constant fl moderate size number time steps required may therefore depend n cf 21 2 still number iterations required obtain given accuracy obviously remains independent n hence operation count per time step remains worst error estimate 328 suppose fi given positive constant simplicity let us apply rth order explicit difference scheme stabilizationsrm form sth iteration worst combined error algorithm ffl see remark 31 trying roughly equate two sources error set hence using 329 obtain rough upper bound number iterations requirement likely arise also accuracy stability considerations remark 32 error estimate 327 condition 329 weakened significantly read 0 arbitrary integer independent n case 330 replaced 4 numerical experiments present couple examples demonstrate algorithm proposed analyzed previous sections first build system special kind nbody chains see figure 21 include two examples use method described 21 consider chain consisting n bodies body modeled line segment length l j mass j uniform mass distribution choose cartesian coordinates joints x j vectors connecting joints along links order describe position p chain n 3d chains p j six components 2d chains four components labeling chain joints shown figure 21 explained x2 hence holonomic constraints include length conditions connection conditions father j therefore due uniform mass distribution center mass body coincides geometric center x moment inertia center mass total kinetic energy given 3 figure 41 square chain labeling let joint 0 fixed potential energy due gravity given ge e v unit vector along vertical axis 2d case e 3d case e note e height center mass body j zero level gravity constant gives force vector f b hence know mass matrix force term f constraints g write system 25 kind treestructured chain problems chains loops need impose additional geometric constraints onto corresponding treestructured formulation see discussion beginning x3 next consider two specific examples example 41 consider 2d square chain unit length mass link ie 1 labeling corresponding tree structure shown figure 41 labeling hence write jacobian matrix gp treestructure constraints gp example gammai 2 theta 2 unit matrix extra loopclosing constraints dp equal number squares thus form jacobian matrix example jacobian matrix gp constraints rank deficiency four links square line let chain fall freely position shown figure 41 joint 0 fixed mentioned srm iteration algorithm 312 solves treestructured problem using algorithm x2 demonstrate number srm iterations independent n means computational complexity algorithm per time step choose step size regularization parameter apply explicit secondorder rungekutta method regularized problem iteration computations clearly see relation number iterations n want avoid singularity happens around whose error situation complicated count number srm iterations errors constraints exhibit obvious improvement table 41 lists iteration counts constraint errors various n iterations iterations 3 3 3 3 3 3 3 table 41 relation number iterations n square chain theoretically expect two srm iterations sufficient since difference scheme second order oh table see second third successive iterations maximum drifts almost especially n 1h additional experiments need two iterations algorithm 312 achieve second order discrete accuracy next compare performance algorithms 312 algi 310 al gii set computational results show first singularity occurs use simple forward euler scheme take algorithms still take algorithm 312 algorithm 310 cannot take 5h algorithm unstable immediately first time step take 005 algorithm blows around take becomes stable take agrees expectation algorithm x31 sake stability difference scheme smallest ffl choose depends often larger needed algorithm 312 hence iterations needed simpler algorithm 310 algorithm iterations ffl t4 t5 t6 t10 algi 1 005 7763e3 1289e2 1744e2 2959e2 algi 2 05 7763e3 1289e2 1744e2 3107e2 algii 2 05 1008e1 1640e1 2270e1 4794e1 algii 4 05 5869e2 8514e2 1129e1 1155e1 table 42 maximum drifts two algorithms list table 42 maximum drifts produced two algorithms various times table see overall performance algi better algii also seems example error improvement algii iteration much slower motion square chain 22 described figure 42 example 42 example consider motion square net veil started breeze corresponding tree structure net labeling shown figure 43 fixed joints labeling determine father given joint jacobian matrix gp constraints extra loopclosing constraints ae x square net number bodies l set step size regularization parameter 05h apply algorithm time step secondorder rungekutta method regularized problem srm iteration 312 breeze assume net moves right largest angle verticle axis consider motion net whose initial position located angle respect vertical line list number iterations various n table 43 table see drift error improvement second iteration two iterations needed algorithm 312 independent n motion square chain described figure 44 figure 42 motion square chain time increases increments deltat 2 left right top bottom 2l 4l 2l 3 2l 4 2l l3 2l l2 2l l 2l l l w1l l w2l figure 43 tree structure labeling square net iterations iterations 3 3 3 3 3 3 3 table 43 relation number iterations n square net r recent advances numerical integration multibody systems stabilization invariants discretized differential systems stabilization daes invariant manifolds sequential regularization methods higher index daes constraint singularities linear index2 case sequential regularization methods nonlinear higher index daes formulation stiffness robot simulation stabilization constraints integrals motion dynamical systems numerical solution initialvalue problems differentialalgebraic equations robot dynamics algorithms solving ordinary differential equations ii regularization differential unified formulaion dynamics serial rigid multibody systems penalty function method simulation mechanical systems subject constraints stabilization computational procedures constrained dynamical systems numerical solution differentialalgebraic equations illconditioned constraints fast recursive sqp methods largescale optimal control problems tr