fast finite volume simulation 3d electromagnetic problems highly discontinuous coefficients consider solving threedimensional electromagnetic problems parameter regimes quasistatic approximation applies permeability permittivity conductivity may vary significantly difficulties encountered include handling solution discontinuities across interfaces accelerating convergence traditional iterative methods solution linear systems algebraic equations arise discretizing maxwells equations frequency domainthe present article extends methods proposed earlier constant permeability e haber u ascher aruliah oldenburg j comput phys 163 2000 pp 150171 aruliah u ascher e haber oldenburg math models methods appl sci appear handle also problems permeability variable may contain significant jump discontinuities order address problem slow convergence reformulate maxwells equations terms potentials applying helmholtz decomposition either electric field magnetic field null space curl operators annihilated adding stabilizing term using gauge condition thus obtaining strongly elliptic differential operator staggered grid finite volume discretization subsequently applied reformulated pde system scheme works well sources various types even presence strong material discontinuities conductivity permeability resulting discrete system amenable fast convergence ilupreconditioned krylov methodswe test method using several numerical examples demonstrate robust efficiency also compare classical yee method using similar iterative techniques resulting algebraic system show method significantly faster especially electric sources b introduction need calculating fast accurate solutions threedimensional electromagnetic equations arises many important application areas including among others geophysical surveys medical imaging 29 32 2 conse quently lot effort recently invested finding appropriate numerical algorithms however widely agreed electromagnetic phenomena generally governed maxwells equations choice numerical techniques solve equations depends parameter ranges various restrictive assumptions significant degree applicationdependent 20 32 2 present article motivated remote sensing inverse problems eg geophysics one seeks recover material properties especially conductivity isotropic heterogeneous body based measurements electric magnetic fields near earths surface forward model concentrate consists maxwells equations frequency domain frequency range excludes high frequencies assuming timedependence e gammat equations written r r theta h gamma b r r magnetic permeability oe conductivity ffl electrical permittivity j known source current density ae unknown volume density free charges work assume physical properties 0 vary position ffl 2 l 2 1 l typical length scale electric field e magnetic field h unknowns charge density defined 1c note long redundant viewed invariant system obtained taking rdelta 1a system 1 defined threedimensional spatial domainomegagamma principle domainomega unbounded ie practice bounded subdomain ir 3 used numerical approximations paper used boundary conditions h theta n although boundary conditions possible number difficulties arise attempting find numerical solutions threedimensional pde system difficulties include handling regions almost vanishing conductivity handling different resolutions different parts spatial domain handling multiple scale lengths physical properties vary handling regions highly varying conductivity magnetic permeability electrical permittivity jumps solution properties across interfaces may occur hand nature data eg measurements electric andor magnetic fields surface earth one cannot hope recover fine detail structure conductivity oe permeability therefore envision accordance inverse problem interest possibly nonuniform tensor product grid covering domainomegagamma b oe assumed smooth even constant inside grid cell may significant jump discontinuities occur anywhere inomega across cell interfaces source j also assumed jumps across interfaces relative geometric simplicity resulting modeling assumption key obtaining highly efficient solvers forward problem denoting quantities different sides interface subscripts 1 2 easily shown 33 across interface n theta conditions imply neither e h continuous normal direction b oe resp jump discontinuity across cell face likewise b oee h necessarily continuous tangential di rections care must therefore exercised numerical methods employed utilize variables defined doublevalued far popular discretization maxwells equations yees method 37 see discussions extensions 32 26 19 method employs staggered grid necessitating short centered first differences discretize 1a 1b usual application method electric field components envisioned cells edges magnetic field components cells faces see fig 1 possible h z x z figure 1 staggered discretization e h three dimensions e components edges hcomponents faces eliminate components magnetic field discrete equations obtaining staggered discretization second order pde e r theta gamma1 r theta e gamma related methods include finite integration technique certain mixed finite element methods 35 5 25 although methods often presented context timedomain maxwells equations issues arising applying implicit timediscretization suitable technique model assumptions often similar ones faced popularity yees method due part conservation properties ways discrete system mimics continuous system 19 15 5 4 however iterative methods solve discrete system may converge slowly low frequencies due presence rich nontrivial null space curl operator additional difficulties arise highly discontinuous coefficients present 29 24 16 two major reasons difficulties first conductivity essentially vanish example air forms part omegagamma analytic perspective specific subset maxwells equations used typically forms almostsingular system regions almostvanishing b oe even regions conductivity close vanishing resulting differential operator strongly coupled strongly elliptic 6 1 second cases large jump discontinuities care must taken handle h b carefully since located fig 1 potentially discontinuous 1 addressed often slow convergence iterative methods used equations resulting discretization 5 applying helmholtz decomposition first obtaining potential formulation coulomb gauge condition change variables used also 3 12 22 28 among many others splits electric field components active null spaces curl operator reformulation reminiscent pressurepoisson equation incompressible navierstokes equations 14 31 yields system strongly elliptic weakly coupled pdes standard preconditioned krylov space methods directly applicable 15 addressed possible significant jumps conductivity assumed constant employing finite volume discretization staggered grid akin yees method locations e h components exchanged fig 2 normal components e doublevalued taken care elegant way helmholtz decomposition e introducing generalized current x z figure 2 staggered discretization e h three dimensions e components faces hcomponents edges equations curl operators 5 replaced vector laplacian according vector identity r theta rtheta sufficiently smooth vector functions e paper generalize approach 1 15 case magnetic permeability may highly discontinuous well realistic case interest geophysical applications although usually jump conductivity dominates jump permeability roles e h essentially dual possible apply helmholtz decomposition either e h keeping unknown vector function intact choose decompose electric field e referring fig 2 locations hunknowns ensuing discretization major departure previous work fact identity 7 directly extend operator r theta gamma1 rtheta appearing 5 however stabilize operator subtracting r forms basis proposed method cases constant magnetic permeability electric conductivity formulation reduced previous formulation 15 variant thereof approach dealing possible discontinuities viewed using fluxes continuous cell faces vorticities continuous cell edges introduction unknowns strongly connected mixed finite elements used highly discontinuous problems 7 8 16 paper laid follows section 2 reformulate maxwells equations way enables us extend methods resulting system amenable discretization using finitevolume technique described section 3 extension generalization approach 1 15 present article without price price added complication sparsity structure resulting discrete system corresponding added cost iterative solution systems briefly describe application krylov space methods solve system algebraic equations section 4 use bicgstab see eg 30 together one two preconditioners incomplete block ludecomposition powerful preconditioner case diagonally dominant linear systems ssor systems diagonal dominance direct consequence analytic formulation present results numerical experiments section 5 compare results obtained using method obtained using traditional yee discretization source divergencefree case electric magnetic sources method better two orders magnitude method works well also case problem coefficients vary rapidly conclude short summary remarks 2 reformulation maxwells equations maxwells equations 1a 1b viewed flux balance equations ie term describes flux arises different physical con sideration equations driven conservation fluxes fact originally developed 23 therefore 1a 1b flux term balanced 1b generalized current density b j defined 6 balanced source flux arise magnetic fields 1a magnetic flux balanced flux arises electric fields context fluxes welldefined cell faces may multivalued cell edges 1 furthermore leading differential operator 5 say nontrivial null space rather devising iterative methods directly take account eg 2 16 transform equations discretization decompose e components active space null space curl operator r could decompose h instead similar way would decompose chosen concentrate decomposition e substituting equations obtain r theta gamma r theta h gamma b r furthermore 5 becomes r theta gamma1 r theta r note across interface distinct conducting media addition 4 n theta ae 12c electric surface charge density conditions differential equations 1 imply b hcurlomegagamma4 see eg 13 moreover roe inherits discontinuity e delta n continuous r delta r theta bounded cf 13 15 relation r theta r theta gammar 2 holding however varies identity 7 extend directly must deal null space r theta different way let us define sobolev spaces equipped usual norm see eg 13 kvk omegagamma4 l used right hand side 13b greens formula yields u 2 r theta usual notation inner product l 2omegagamma l 2omegagamma2 3 used thus u 2 w r theta gamma1 r theta u u may therefore stabilize 11a subtracting vanishing term r theta gamma1 r theta obtaining strongly elliptic operator provided 2 w 0omegagamma4 latter condition guaranteed choice 17b similar stabilization penalty approach studied mixed success 10 20 however experience thus recommendation positive discretization utilize elaborate upon point next section using 10c write 10b r theta h gamma may advantageous case discontinuous similarly mixed formulation used simple divgrad system r 7 27 8 11 elsewhere final step reformulation replace 15 gauge condition 10c indirect one obtained upon taking rdelta 15a simplifying using 15b 10c achieves weak coupling resulting pde system note replacing gauge condition 10c similar pressure poison equation cfd 31 14 complete system discretized next section written r theta h gamma order complete specification system must add appropriate boundary conditions bcs first note original bc 3 written r theta theta n additional bc normal components required helmholtz decomposition 9 unique choose corresponding 13c together 9 determines given e moreover since 16d obtained taking rdelta 16a additional required either oen oe note original together pde 1b imply also latter relation 17c together 17b implies oe n 0 bound ary 23 conditions determine oe constant pin constant arbitrarily eg requiring z finally note 17c together 16a 3 imply turn n 0 boundary since 16a 16d imply obtain j 0 thus retrieve 10c pinning 0 one additional point system 16 subject boundary conditions 17 pinned one point wellposed 3 deriving discretization 15 employ finite volume technique staggered grid b located cells faces h cells edges oe located cells center correspondingly discretization 16d 16c centered cell centers 16e 16a centered cell faces 16b centered cell edges variables distribution grid cell summarized table 1 approximate r delta u integrate first cell using gauss divergence theoremje ijk j z e ijk r delta u z e ijk cases original bc different 3 still use boundary condition asymptotic value infinite domain alternatively note possibility applying helmholtz decomposition h although generally good practical reasons prefer decomposition 9 e 3 geophysical applications j delta n vanishes boundary x z j z j z h z table 1 summary discrete grid functions scalar field approximated grid functions points slightly staggered cell e ijk grid use midpoint quadrature face evaluate component surface integrals appearing righthand side thus define express discretization 16d 16c grid cell note assuming uniform grid cell may different widths direction boundary conditions used end points 19 next consider discretization cell faces following 15 define harmonic average boe neighboring cells xdirection h x 2 b oe assumed constant cell integral evaluates 2boe ijk 2boe i1jk resulting approximation xcomponent 16e 15 x next discretize 16a 37 writing xcomponent equations denote j discretization centered center cells xface results h z similar expressions 20c 21 derived yand zdirections boundary conditions 3 used close 21 using 20c eliminate b j 19a obtain discrete equation dominant terms involve oe resulting stencil oe 7 points also apply obvious quadrature single condition 17d finally discretize edgecentered 16b consider say xcomponent 16b written integrating equation surface rectangle corners expression left hand side integrated using gauss curl theo rem right hand side averaged directions obtain value edge divide integration wish integrate magnetic flux potentially less smooth around edge magnetic field yields z z k1 z k assumed constant cell integral evaluates h h z h z h z h z resulting approximation xcomponent 16b ia h z z 22c using 19b well 22c similar expressions derived zdirections substitute h 21 obtain discrete system equations resulting stencil 19 points structure discretization operator r theta gamma1 rtheta difference discretization direct discretization latter interface naturally defined arithmetic average harmonic average discretization described viewed careful extension yees method suitable discontinuous coefficients amenable fast iterative solution methods centered conservative second order accu rate note throughout used consistent compact discretization operators rdelta rtheta r denote corresponding discrete operators r h r h immediately obtain following identities cf 18 17 course analogues vector calculus identities hold sufficiently differentiable vector functions boundary conditions 17 discretized using discrete operators well next note upon applying r h delta 21 using 23b 19a obtain moreover 21 17c discrete normal derivative vanishes boundaries well setting 0 arbitrarily one point determines j 0 throughout domain grid function obtain another conservation property scheme namely discrete divergencefree recall stabilizing term added 14 exact solution term obviously vanishes 24 assures us corresponding discretized term vanishes well justifying use term stabilization rather penalty case nodal finite element method considered 20 10 approximate solution satisfy 24 stabilization term may grow size varies orders magnitude else r h delta grows undesirably attempt keep approximately constant across interface 20 particular way averaging across discontinuities namely arithmetic averaging cell edges harmonic averaging b oe cell faces important averaging viewed careful approximation constitutive relationship discontinuous coefficients show look first relation across face whose normal direction x flux flows series therefore approximate b oe represents bulk property flow volume given harmonic average corresponding arithmetic average resistivities next look relation edge variable b x flux four cells share edge flow parallel implies need approximate edge arithmetic average note also use common implementation yees method ie h cells faces e cells edges roles b oe interchange need average harmonically b oe arithmetically 4 solution discrete system elimination h b j discrete equations obtain large sparse system grid functions corresponding oe oe b result discretization operator r theta corresponds discretization operator rtheta likewise corresponds discretization operator diagonal matrix results discretization operator b oedelta c similarly arise cell edges cell centers respectively h represents discretization r delta boerdelta regions constant simplifies discretization vector laplacian blocks weakly coupled interfaces typical sparsity structure h 1 variable contrasted constant displayed fig 3 structure obtained system similar 15 although main block diagonal somewhat less pleasant note long frequency low enough diffusion number satisfies h maximum grid spacing matrix dominated diagonal blocks allows us develop block preconditioner good low frequencies based truncated ilu ilut decomposition major blocks 30 thus approximate k block diagonal matrix use ilut obtain sparse approximate decomposition k decomposition used preconditioner krylov solver note although k complex approximation k real therefore need apply ilu decomposition two real matrices saves memory note block approximation 26 makes sense discretization direct staggeredgrid discretization 1 thus sparsity structure constant sparsity structure variable figure 3 sparsity structure matrix h 1 corresponding variable right constant left reformulation subsequent discretization maxwells equations allow us easily obtain good block preconditioner modular manner discretization 1 5 numerical examples goal section demonstrate efficacy proposed method compare common discretization system 1 utilized eg 24 29 using standard krylovtype methods preconditioners solving resulting discrete systems vary type source used size jumps coefficients oe preconditioner grid size tables iterations denotes number bicgstab iterations needed achieving relative accuracy number gigaflops required ssor parameter used equals ilu threshold used equals 10 gamma2 latter threshold current matlab implementation iterations involving two preconditioners cost roughly 51 example set 1 derive following set experiments let airs permeability permittivity ffl assume cube constant conductivity oe c permeability c embedded otherwise homogeneous earth conductivity oe permeability fig 4 typical geophysical application conductivity may range four orders magnitude whereas permeability rarely changes one order magnitude therefore experiment conductivity oe c ranging 10 gamma2 sm 10 3 sm permeability c ranging 0 1000 0 04 figure 4 setting first numerical experiment cube conductivity oe c permeability c embedded inside homogeneous earth conductivity oe e permeability e also air experiment two different sources magnetic source plane wave ii electric dipole source x direction centered 0 0 0 fact first source magnetic implies divergencefree source lies entirely active space curl operator contrast electric source divergencefree sources assumed oscillate different frequencies ranging 1 10 6 hz solution obtained unless otherwise noted nonuniform tensor grid see fig 4 consisting cells 95232 unknowns corresponding grid 128000 complex unknowns solve system using method described previous section 511 example 1a order able compare resulting linear algebra solver corresponding yees method discretize system r theta gamma1 r theta b using staggered grid depicted fig 2 ie b j cells faces similar discretization 24 yields discrete system unknowns vector e corresponding grid values b jboe matrices c defined section 4 b depends source order solve system well use bicgstab preconditioner comparison methods case different frequencies summarized table 2 electric source magnetic source iterations operations iterations operations 63 728 99 113 64 73 table 2 iteration counts computational effort method oe traditional implementation yees method applied e b j example set 1 using electric source magnetic source table 2 shows method converges moderate number iterations sources despite presence significant jumps oe hand traditional discretization performs poorly electric source reasonably well magnetic source slow convergence direct staggered discretization maxwells equations case electric source also reported 29 e defined grids edges results clearly show advantage formulation original yee formulation even simple preconditioning especially electric sources low frequencies circumstances discretized first term left hand side 27 strongly dominates term residual course bicgstab iteration nontrivial component null space operator hence reduction slow magnetic source hand yields special situation long discrete divergence roundoff error relatively small residual component null space leading term operator also small hence number iterations using traditional method much larger using method 512 example 1b next test effect discontinuities method use electric source record number bicgstab iterations needed method converge various values using blockilut preconditioning described previous section results summarized table 3 note large jump discontinuities oe significantly affect rate convergence iterative linear system solver method large jump discontinuities decisive effect results similar spirit reported 16 regarding effect discontinuities specialized multigrid method edgeelement discretization however even large discontinuities number iterations reported table 3 remains relatively small compared similar experiments reported 29 9 attribute increase number iterations jump increases size corresponding degradation condition number k 25 degradation however depend strongly grid size verify next table 3 iteration counts different frequencies conductivities permeabilities example set 1 conductivitypermeability structure cube halfspace 513 example 1c next experiment use cube model electric source evaluate influence grid number iterations fix test method case modest coefficient jump case large jump set uniform grids interval gamma1 1 3 considered grid record resulting number iterations using ssor block ilu preconditioners results experiment gathered table 4 observe number iterations increases number un grid size ilu ssor ilu ssor table 4 iteration counts different grids two sets problem coefficients using two preconditioners knowns increases increase appears roughly proportional number unknowns power 13 growth number iterations function grid size also roughly similar preconditioners although block ilu requires fewer iterations 14 grid however ilu requires memory ssor may prohibit use large problems increase rate also similar expected values thus increase number iterations function essentially depend grid size practically ever increase substantial may hard cope perhaps unrealistically large values using present techniques 52 example 2 next experiment consider complicated earth structure employ random model used practitioners order simulate stochastic earth models 21 two distinct value sets oe probability p assumed conductivities permeabilities cell probability values oe probability values particularly difficult model work conductivity permeability may jump anywhere one cell next necessarily across welldefined manifold crosssection model plotted fig 5 carry experiments frequencies ranging 0 10 6 hz use random model different conductivities permeabilities frequencies electric source domain gamma1 1 3 km employ uniform grid size 44 3 use block ilu ssor preconditioners results experiment terms conductivity slice logsm figure 5 setting example set 2 iteration counts summarized table 5 results show solution method effective even highly varying conductivity method deteriorates large variations present also see table 5 block ilu preconditioner works well low frequencies effective high frequencies easy check cases block ilu preconditioner fails achieve convergence denoted nc meaning failure achieve residual gamma7 800 iterations maximum grid spacing h satisfies oe h ae 1 case discretization leading terms differential operator longer yields dominant blocks matrix equations 25 therefore block ilu preconditioner fails thus high frequency high conductivity require grid points order preconditioner effective also consistent physics skin depth 36 decreases attenuated wave simulated fidelity finer grid 6 summary remarks paper developed fast finite volume algorithm solution maxwells equations discontinuous conductivity permeability major components approach follows ffl reformulation maxwells equations helmholtz decomposition applied e stabilizing term added resulting strongly elliptic system system written first order form allow flexibility ilu ssor ilu ssor ilu ssor table 5 iteration counts different frequencies conductivities permeabilities example set 2 ensuing discretization finally divergencefree coulomb gauge condition eliminated using differentiation substitution yields weakly coupled pde system enabling efficient preconditioner large sparse algebraic system results discretization ffl discretization using staggered grids respecting continuity conditions carefully averaging material properties across discontinuities discretization stabilizing term vanishes exact solution discrete equations important cases large contrasts ffl solution resulting linear system using fast preconditioned krylov methods resulting algorithm tested variety problems shown dramatic improvement standard algorithm source electric good performance obtained even coefficients oe allowed vary rapidly grid scale case prove challenging multigrid methods project motivated us electromagnetic inverse problems geophysical prospecting 34 solving forward problem ie maxwells equations present article major bottleneck data inversion methods indeed may carried dozens hundreds times data inversion thus extremely fast solvers problem discussed paper needed based algorithm described implementation carried solves realistic instances forward problem less two minutes singleprocessor pc enabling derivation realistic algorithms low cost inverse problem acknowledgment wish thank drs doug oldenburg dave moulton fruitful discussions anonymous referee valuable comments first two sections exposition r method forward modelling 3d electromagnetic quasistatic problems adaptive multilevel methods edge element discretizations maxwells equations whitney forms class finite elements threedimensional computations electromagnetism multigrid solution elliptic flow problems mixed hybrid finite element methods finite elements numerical algorithms fditd fdfd simulation slowly varying electromagnetic feilds theoretical numerical difficulties 3d vector potential methods finite element magnetostatic compu tations black box multigrid geomagnetic induction heterogenous sphere azimuthally symmetric test computations response undulating 660km discontinuity finite element methods navierstokes equations pressure boundary conditions incompressible navierstokes equations fast modelling 3d electromagnetic using potentials multigrid method maxwells equations natural discretizations divergence gradient curl logically rectangular grids orthogonal decomposition theorems mimetic finite difference methods mimetic discretizations maxwells equations equations magnetic diffusion finite element method electromagnetics electrical conduction sandstones examples two dimensional three dimensional percolation scalarvector potential solution 3d em finitedifference modeling theoretical concepts physics three dimensional magnetotelluric modeling using difference equations theory comparison integral equation solutions analysis finite volume convergence analysis yees scheme nonuniform grids numerical implementation nodal methods solutions 3d eddy current problems finite elements iterartive methods sparse linear systems multigrid solver steady state navierstokes equations using pressurepoisson formulation computational electrodynamics finitedifference timedomain method diadic green functions electromagnetics electromagnetic theory geophysical applications time domain electromagnetic field computation finite difference methods inversion magnetotelluric data one dimensional conductivity numerical solution initial boundary value problems involving maxwells equations isotropic media tr ctr eldad haber stefan heldmann octree multigrid method quasistatic maxwells equations highly discontinuous coefficients journal computational physics v223 n2 p783796 may 2007