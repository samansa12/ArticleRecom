accuracy enhancement higher derivatives using chebyshev collocation mapping technique new method investigated reduce roundoff error computing derivatives using chebyshev collocation methods using grid mapping derived kosloff talezer proper choice parameter alpha roundoff error kth derivative reduced on2k lgek epsilon machine precision n number collocation points drastic reduction roundoff error makes mapped chebyshev methods competitive algorithm computing second higher derivatives large n several aspects mapped chebyshev differentiation matrix also studied revealing mapped chebyshev methods require much less pi points resolve wave eigenvalues less sensitive perturbation roundoff error larger time steps used solving pdes advantages mapped chebyshev methods achieved maintaining spectral accuracy b introduction 5 addressed issue roundoff error computing derivative using chebyshev collocation methods details methods see canuto et al 1 gottlieb orszag 2 showed construct chebyshev collocation derivative offln 2 roundoff error ffl machine precision n number collocation points carefully constructing entries derivative matrix pdes involve higher derivatives first example viscosity term navierstokes equation fourth derivative term kuramotosivashinsky equation problems roundoff error kth derivative offln 2k ruin computed solution even k n large limits applicability chebyshev collocation methods certain types pdes values n paper investigate way modifying chebyshev collocation derivative reduces roundoff error also improves accuracy stated 5 roundoff error cannot reduced basis functions based polynomials since roundoff error chebyshev collocation method already achieves theoretical minimum therefore hope reducing roundoff error polynomial basis functions must replaced something else one way apply coordinate transformation specifically chebyshev collocation points mapped new set points parameter ff transformation function g ff onetoone onto mapping also applied polynomial basis functions changed well paper concentrate mapping form 4 kosloff talezer showed mapping increases minimum spacing deltax collocation points gamma2 gamma1 argued reduces spectral radius differentiation matrix 2 show similar effect roundoff error moreover mapping reduces roundoff error also requires less points per wave number standard chebyshev methods section 2 introduce chebyshev collocation method derivative matrix section 3 illustrates problem large roundoff error computing higher derivatives using standard chebyshev collocation methods discuss transformation chebyshev collocation points properties section 4 minimum roundoff error estimated standard mapped differentiation matrix section 5 section 6 numerical results standard vs mapped chebyshev collocation methods demonstrated study effect mapping eigenvalue spectrum matrix dirichlet boundary conditions section 7 section 8 gives heuristic estimate resolution power mapped chebyshev methods discuss section 9 pitfalls proper procedures computing mapped chebyshev derivatives section present chebyshev collocation method consider chebyshevgauss lobatto collocation points extrema nth order chebyshev polynomial let vx smooth function domain x 2 gamma1 1 vx interpolated constructing n order interpolation polynomial g j x g j ux polynomial degree n u shown differentiation derivative ux collocation points x j computed many different ways obvious way compute derivative matrixvector multiplication entries chebyshev derivative matrix computed taking analytical derivative g j x evaluating collocation points x k entries matrix sin sin derivative ux becomes 0 denotes derivative unless specified otherwise also log 2 n algorithms computing derivative involve fast discrete fourier andor cosine transforms roundoff error properties mostly matrixvector multiplication concentrate matrixvector multiplication algorithm mention occasionally table 1 absolute maximum error kth derivative 3 accuracy computing higher derivatives section show numerical experiments illustrate large roundoff error standard chebyshev collocation method computed first four derivatives test function mapping kth derivative computed multiplying vector gamma derivative matrix k times table 1 shows absolute maximum error first four derivatives different numbers chebyshev collocation points clearly illustrates problem one wishes obtain higher derivatives using chebyshev collocation methods absolute maximum error fine first derivative acceptable second derivative n 128 third fourth derivatives error becomes unacceptable n 64 n 32 respectively rate growth roundoff error shown table 1 approximately 2k see section 5 details similar conclusions reached functions since situation quite generic chebyshev differentiation matrix since matrix already achieved minimum roundoff error possible manipulation elements matrix useless situation seems hopeless unless basis functions found example know fourier collocation methods roundoff error growth like kth derivative modify chebyshev basis functions resemble fourier methods way maybe reduce roundoff error however done way preserve spectral accuracy standard chebyshev method one way achieve map chebyshev collocation points set interpolation points discuss next section 4 grid transformation 4 kosloff talezer derived grid transformation mapped chebyshev collocation points new set interpolation points grid transformation defined sin chebyshev collocation points x j new set interpolation points parameter ff 2 0 1 given function ux derivative ux evaluated du dx 7 dx sin computing grid points x 7 rewritten gamma u md gamma u 10 diagonal matrix elements define new differentiation matrix give important properties mapping g ff ffl mapping derivative g 0 ff singular ffl deltax one show ffl positive number c 4 n coordinate transform results approximation error due fact transformation function g entirely smooth g singularities 4 section 48 kosloff talezer showed ff chosen approximation error roughly ffl choosing ffl machine precision error coordinate transformation essentially guaranteed harmless choice ff limit n 1 substitute 12 assume jln fflj ae gives minimum grid point spacing deltax min 0 table 2 ff deltax min deltax min ff deltax min 0 ratio function n table 2 ff shown function n fixed accuracy machine precision cray c90 also lists several values equation 15 minimum spacing without mapping relative size ffn equation 15 implies deltat odeltax min inversely proportional jln fflj hence larger deltat achieved reducing accuracy ffl interpolation situation might acceptable problems demanding high accuracy solution however table 2 also clearly shows one still get slightly larger time step without degradation accuracy approximation paper interested issue stability accuracy allows us fix accuracy requirement ffl machine precision choose ff function n alone 5 estimates roundoff error section discuss two estimates roundoff error 5 section 4 constructed following estimate roundoff error ignored rounding errors except occurred function vector u stored single precision assumed errors occurred randomly specifically assumed uncorrelated zeromean variance ie rms average value machine precision assumptions average roundoff error ith component derivative ik average l 2 norm error reasonable estimate maximum error see e cheb average roundoff error chebyshev collocation derivative corresponding error derivative using mapping since ii small near edges grid e cheb large expect mapping reduce roundoff error usually error larger rounding errors happen computation occasionally smaller lucky cancelation errors estimate useful lower bound algorithm computing du able come close use trying improve algorithm many algorithms computing derivative able approach bound estimate roundoff error heuristic estimate based minimum grid point spacing finite difference methods equally spaced points formula kth derivative p jk numbers pascals triangle o2 k size see size coefficients rounding errors multiplied roughly 2deltax k claim situation spectral approximations derivative therefore rough estimate norm error taking value deltax min equation 15 gives corresponding error unmapped chebyshev derivative 6 numerical results mapped chebyshev methods section compute higher derivatives using chebyshev collocation without mapping technique use test function sinmx purpose also tested functions eg results relative absolute error exact numerical results computed l1 pointwise norm note two ways computing kth derivative using chebyshev collocation methods mapping one way multiply matrix vector gamma u times ie gamma u k gamma u gamma u k way form expression involving l u g l differentiating ugx k times example gamma u gamma g gamma numerical experiments techniques gave exactly results paper used first method simplicity programming mapping mapping mv fft cft mv fft cft first derivative n second derivative third derivative n fourth derivative table 3 absolute maximum error first four derivative table 3 computed maximum absolute error 1st 2nd 3rd 4th derivative function sin2x computations used cray c90 whose machine precision 65 theta gamma15 single precision used three different algorithms namely matrixvector multiplication fftrecursion cftrecursion without mapping g ff cosine transform recursion algorithm computed using forward inverse cosine transform subroutines fcr fcrinv larclib library local nasa langley research center source code available cft fft algorithm based rfftmlt subroutine cray scientific library routine matrixvector multiplication algorithm mv used mxm subroutine library package based table 3 see solutions using mapped chebyshev methods uniformly better standard one four differentiations another observation cft algorithm uniformly worse mv fft algorithm either standard mapped category especially third fourth derivative large n moreover matrixvector multiply mv algorithm fft recursion algorithm fft similar order error concentrate discussion data obtained mv algorithm alone figure 1 compare roundoff error mapped chebyshev derivative error estimates equations 18 22 test function sin4x vertical axis graph max errorffl see actual error comes fairly close lower bound also see heuristic error estimate fairly close real error lower bound although dependence k exactly right10001000001e071e091e11100 1000 errorepsilon lower bound error error estimate figure 1 maximum error vs number grid points kth derivative lower bound equation 18 error estimate equation 22 error scaled machine precision ie vertical axis max errffl mapping mapping table 4 absolute maximum error kth derivative 61 accuracy functions boundary layers well known chebyshev method good resolution power functions boundary layers well mapped chebyshev method functions tested functions type gradient boundary layer adjusted varying parameter ffi 0 smaller ffi becomes steeper gradient near boundary parameters k set 2 computed derivatives two different table 4 showed absolute maximum error case 09 gradient case large data showed algorithms performed equally well small n however large n 32 higher derivatives mapped chebyshev method outperforms unmapped one table 5 shows absolute relative maximum error case seen table 5 unmapped chebyshev method performs better small n 32 speculate mapped chebyshev method need points resolve high gradient near boundary quite selfevident function well resolved n 64 mapped chebyshev methods perform better higher derivatives since error masked large functional value examined error relative sense third fourth derivatives relative accuracy using mapping rather good fourth derivative 15 error mapping rather 430 error standard chebyshev methods absolute mapping mapping table 5 absolute relative maximum error kth derivative 7 eigenvalue spectrum differentiation matrix section analyze eigenvalue spectrum standard mapped chebyshev matrices respectively subject dirichlet boundary conditions equivalent deleting first row column matrix eigenvalues computed imsl subroutine evlrg important issue time stability condition deltat fixed 1 explicit time marching scheme example rungekutta adamsbashford scheme controlled largest eigenvalues eigenvalues separated two groups large imaginary parts ie larger call outliers others outliers stable perturbations matrix 3 trefethen trummer found nonoutlying eigenvalues extremely sensitive perturbations matrix elements simply storing elements matrix single double precision would completely change spectrum matrix changed eigenvalues would large negative real parts order 2 n 1 however showed given precision ffl nonoutlying eigenvalues negative real part eigenvalues lost 3 simulated perturbation lowering precision arithmetic perturbation comes representing matrix elements finite precision figures 2a 2b show eigenvalue spectrum standard chebyshev differentiation matrix 32 64 bits precision arithmetic respectively cases exhibited spurious eigenvalues large negative real part form arc left 1 largest negative real part computed bits precision much larger computed 64 bits precision fixed n way eliminate spurious eigenvalues use much higher precision arithmetic undesirable impractical numerical solution pdes however eigenvalues mapped chebyshev differentiation matrix dirichlet boundary conditions behave differently figures 2c 2d showed eigenvalue spectrum standard chebyshev differentiation matrix 32 64 bits precision arithmetic respectively 32bit precision matrix eigenvalues left line ffl form small arc 64bits precision none less 10 eigenvalues negative real part less 1ln ffl hence conclude stability numerical scheme based mapped chebyshev collocation methods much less sensitive precision arithmetic unmapped method important observation even 64 largest eigenvalues considerably smaller mapped case unmapped case also largest eigenvalue single precisionmapped matrix smaller largest eigenvalue doubleprecisionmapped matrix largest eigenvalue gamma919 sigma351977 absolute value e largest eigenvalue gamma521 sigma207987 absolute value e 214426 ratio close value 1732 table 2 100200a bits precision b 64 bits precision mapping c bits precision mapping 64 bits precision figure 2 eigenvalues spectrum standard mapped chebyshev differentiation matrix ab cd respectively 32 ac 64 bd bits precision arithmetic ff mapping computed using different values ffl 32bit 64bit precision matrices seen table 6 negative eigenvalue lying real axis grows like 125 least values n table substantially smaller 2 growth seen using standard differentiation matrix result 125 actually quite surprising following reason recall trace detail spectrum single precision mapped derivative matrix figure 3 trajectories eigenvalues mapped chebyshev derivative matrix size perturbations matrix increases ffl double precision ffl single precision ff computed according 32bit precision ffl computations ieee double precision r 127 133 120 118 table negative eigenvalue lying real axis 0 local exponent growth ie r matrix defined eigenvalues anticentrosymmetric acs matrices ie satisfy equation 4 trace acs matrix easily shown zero suppose modify matrices throwing away first row column call matrices ff since 00 supposed small mapping forces eigenvalues closer imaginary axis letting taking limit n 1 trace real also eigenvalues experimentally always found left halfplane would make useless solving parabolic pdes rest section assume use knowledge tr say things spectrum let us consider two extreme arrangements eigenvalues satisfy equations 30 31 first suppose eigenvalues one lay imaginary axis real part remaining one would tr maximizes suppose eigenvalues real part dn 8i minimizes reality falls extremes jln fflj 33 125 growth rate eigenvalues lying real axis shown table 6 holds n large enough n exceed limit given equation 32 therefore 125 growth rate cannot asymptotic rate n 1 asymptotic growth rate real part eigenvalue table 6 see r decreasing presumably n1 r approaches 1 case legendre derivative matrix trefethen trummer found sensitivity eigenvalues matrix effectively raised spectral radius 2 infinite precision spectrum legendre matrix similar chebyshev matrix except doesnt 2 outliers heuristically expect mapping reduces spectral radius jln fflj reasonable thing fear eigenvalue sensitivity might create eigenvalues large negative real parts increasing spectral radius jln fflj cannot happen least generating eigenvalues large negative real parts equation prevents eigenvalue real part bigger jln fflj equation 33 least eigenvalues left line 1jln fflj clear means eigenvalues changed roundoff error since eigenvalues farthest left appear outliers stable anyway figure 3 show eigenvalues mapped derivative matrix change matrix perturbations increase size computed eigenvalues matrix entries matrix e random numbers uniformly distributed interval curves shown figure 3 paths taken eigenvalues complex plane went 10 gamma15 5 theta 10 gamma8 mapping used value ff consistent computations done ieee double precision using lapack subroutine dgeevx ends curves diamond smallt ends nonoutlying eigenvalues nonnegative imaginary part shown clearly seen least eigenvalues effected roundoff error diamonds dont appear curve attached eigenvalues affected perturbations contradicts statement 4 eigenvalues mapped chebyshev matrix affected roundoff error much less unmapped matrix resolution power mapped chebyshev methods standard chebyshev method requires least points per wave begins resolve oscillatory function like sinmx many points mapped chebyshev method require limit ff 1 grid points become equally spaced chebyshev polynomials become cosine functions resolution requires two pointswave however ff function n never reaches one clear really happens claim without proof grid begins resolve function density points reaches two points per wave center domain density points lowest implies function cosmx resolved limit n 1 means per wave required computed normalized l 2 error function cosmx many n figure 4 x axis represents inverse wave number normalized factor previous section examining data carefully fixed wave number error decays exponentially fast ffl n increases soon nmg 0 0 ff 1 implies minimum g 0 0 ff points needed resolve wave table 7 shows typical values g 0 0 ff various sample n ffl fixed 65 theta 10 gamma15 large n two points per wave needed close performance fourier methods figure 4 normalized l 2 error function cosmx many n table 7 number pointswave vs n 9 compute derivative since computing kth derivative k n large result large roundoff errors worthwhile work extrahard minimize section discuss several nonobvious sources roundoff error show avoid 91 illconditioning computations associated mapping recall grid transformation function ff mapped grid points x unmapped chebyshev grid points derivative g jffj near 1 jg 0 j large problem roundoff errors associated storing single precision result errors x size offlg 0 largest values 1 computation transformation derivative ii also illconditioned avoid excessive errors resulting problems x ii need computed extended precision stored single precision failure result loss 1 digit precision n larger 100 92 illconditioning matrix multiply used form k obvious way obtain kth derivative matrix k constructing first derivative matrix multiplications bad idea matrix multiplication illconditioned sum must evaluated obtain entries 2nd derivative matrix 2 ignoring terms sum terms sum change sign twice j problem means partial sums much larger final sum roundoff error basically proportional size partial sums see 6 partially fixed adding terms sum random order rather order increasing k better idea simply use closedform expressions entries matrix course closedform expressions entries matrix md k strong argument favor using long form mapped derivative matrix ie according equation 24 93 cosine transform algorithms algorithms computing matrixvector product one involves discrete cosine transform u operations transformed data inverse cosine transform one way computing cosine transform symmetrically extend u vector length 2n fft longer vector two faster alternative algorithms described dollimore 8 cooley lewis welch 7 involves preprocessing step fft vector length n postprocessing step unfortunately pre postprocessing steps illconditioned algorithms ffl roundoff error compared offl roundoff error symmetric extension algorithm used compute chebyshev derivative gives 3 ffl roundoff error rather 2 ffl swarztrauber 9 describes cosine transform appears free roundoff error prob lems least fast dollimore algorithm however many publiclyavailable subroutines encode dollimore algorithm able find examples swarztraubers algorithm acknowledgments authors would like thank prof alvin bayliss bringing subject authors attention computing time cray ymp provided us army corps civil engineering waterway experiment station high performance computer center first author would like acknowledge support research afosr grant 9310090 darpa grant n0001491j4016 nsf grant dms9211820 r spectral methods fluid mechanics numerical analysis spectral methods theory applications instability phenomenon spectral methods modified chebyshev pseudospectral methods accuracy speed computing chebyshev collocation derivative accuracy floating point summation fast fourier transform algorithm programming considerations calculation sine cosine laplace transforms algorithms use fast fourier transform symmetric ffts tr ctr j mead b zubikkowal iterated pseudospectral method delay partial differential equations applied numerical mathematics v55 n2 p227250 october 2005 r barrio j pea numerical evaluation pth derivative jacobi series applied numerical mathematics v43 n4 p335357 december 2002 elsayed e elbarbary salah elsayed higher order pseudospectral differentiation matrices applied numerical mathematics v55 n4 p425438 december 2005 w lyons h ceniceros chandrasekaran gu fast algorithms spectral collocation nonperiodic boundary conditions journal computational physics v207 n1 p173191 20 july 2005