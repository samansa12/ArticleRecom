practical construction modified hamiltonians one fruitful ways analyze effects discretization error numerical solution system differential equations examine modified equations equations exactly satisfied approximate discrete solution actually exist general rather defined asymptotic expansion powers discretization parameter nonetheless expansion suitably truncated resulting modified equations solution remarkably close discrete solution case hamiltonian system ordinary differential equations modified equations also hamiltonian integrator symplectic evidence existence hamiltonian particular calculation obtained calculating modified hamiltonians monitoring well conserved also energy drifts caused numerical instability better revealed evaluating modified hamiltonians calculation would normally complicated highly dependent details method even differences used approximate derivatives relatively simple procedure presented nearly independent internal structure integrator obtaining highly accurate estimates modified hamiltonians bonus method construction modified hamiltonians exactly conserved numerical solution case quadratic hamiltonian b introduction one fruitful ways analyze effects discretization error numerical solution differential equations examine modified equations equations exactly satisfied approximate discrete solution actually exist general rather defined asymptotic expansion powers discretization parameter nonetheless expansion suitably truncated resulting modified equations solution remarkably close discrete solution 9 case hamiltonian system work r skeel supported part nsf grants dms9971830 dbi9974555 nih grant p41rr05969 completed visiting mathematics department university california san diego z ordinary differential equations modified equations also hamiltonian integrator symplectic existence modified shadow 4 hamiltonian indicator validity statistical estimates calculated long time integration chaotic hamiltonian systems 18 addition modified hamiltonian sensitive indicator original hamiltonian drift energy caused instability evidence existence hamiltonian particular calculation obtained calculating modified hamiltonians monitoring well conserved calculation would normally complicated highly dependent details method even differences used approximate higher derivatives presented relatively simple procedure nearly independent internal structure integrator obtaining highly accurate estimates modified hamiltonians consider step step numerical integrator x evolves approximate solution x n xnh system ordinary differential equations fx discrete solutions exists modified equations defined asymptotic expansion formally numerical solution x nh modified righthandside function f h defined uniquely postulating asymptotic expansion f powers h substituting equations numerical solution expanding powers h equating coefficients 26 6 22 asymptotic expansion generally converge except reasonable integrators applied linear differential equations hamiltonian system form hamiltonian hx modified equation integrator phi h applied system hamiltonian ie f modified hamiltonian h h x integrator symplectic 23 20 integrator symplectic phi hx xj phi hx x j j theoretical 2 8 18 empirical evidence small error long time x h solution suitably truncated hamiltonian h h follows assume h h hamiltonian neglect small error plot total energy function time numerical integrator leapfrogstormer verlet applied molecular dynamics simulation get graph like fig 3 observe large fluctuations original hamiltonian trajectory moves hypersurface constant modified hamiltonian small drift jump energy would obscured fluctuations plot modified hamiltonian might revealing example plots modified hamiltonians fig 4 show clear rise energy already 400step simulation indicates plots suitable modified hamiltonians make easier test integration algorithms instability programming bugs details numerical tests given section 2 continuing worth emphasizing concern paper stability monitoringnot monitoring enhancement accuracy 4 15 goal construct approximate modified hamiltonian conveniently assembled quantities forces energies already available numerical integration consider special separable hamiltonian hq system form brute force approach would determine asymptotic expansion h h quantities available making approximation form suitable linear combination latter matching asymptotic expansions one could derive following modified hamiltonians leapfrog method superscript n denotes evaluation q n centered difference operator defined ffi w averaging operator defined w defined terms q n p n leapfrog method easier elegant construction presented secs 35 technique developed splitting methods likely similar construction also possible symplectic implicit rungekutta methods idea add new position conjugate momentum variable get extended hamiltonian h h homogeneous order 2 hamiltonian jy h thus problem reduced forming approximation using numerical solution extended hamiltonian system plausible construction might useful theoretically due existence robust approximation techniques eq 1 h 2 contains h 2 term needed achieving 2nd order accuracy present truncations h 2k designed exactly conserve energy numerical solution h quadratic see secs 41 51 useful property typical applications including molecular dynamics dominated harmonic motion existence modified hamiltonian exactly conserved quadratic hamiltonian noted 17 eq 47b search similar methods property central results paper quadratic hamiltonian modified hamiltonian h h actually exists h large h 2k 6 h h simple derivation h h onedimensional case given 22 also noted hamiltonians h 2k detect numerical instability case quadratic hamiltonians h modified hamiltonians h 2k x defined eqs 15 8 14 7 computed plotted functions time numerical solutions generated leapfrog method given energy time fs 8th order 6th order 4th order energy 2nd order figure 1 energy various truncations modified hamiltonians decalanine 9 unmodified hamiltonians classical molecular dynamics testing done molecular dynamics program written second author compatible namd 11 16 limited features facilitate algorithm testing first couple experiments demonstrate quality modified hamiltonians test problem 66atom peptide decalanine vacuum 1 force field parameters charmm 22 proteins 13 14 without cutoffs nonbonded forces figure 1 shows plot hamiltonian 2nd 4th 6th 8th order modified hamiltonian approximations vs time 100000 fs femtoseconds step size energy sampled every 8th step level graph top 8th order truncation one barely beneath 6th order one 4th order greatly fluctuating graph energy undulating one well 2nd order truncation note well asymptotic theory holds higher order truncationsone could obtain flat plots simply smoothing original hamiltonian figure 2 expands vertical scale show fluctuations 8th 6th 4th order truncations modified hamiltonians explanation order concerning initial drop energy symplectic method preserves volume phase space less phase space volume lower energies inferred first part trajectory simply second half unusual fluctuation words initial conditions atypical ie properly equilibrated respect original hamiltonian particularly well revealed plot 2nd order truncation remaining experiments demonstrate ability modified hamiltonians detect instabil ity test problem set 125 water molecules harmonically restrained 10 aradius sphere water based tip3p model 25 without cutoffs flexibility incorporated adding bond stretching angle bending harmonic terms cf ref 12 energy time fs 8th order 6th order 4th order figure 2 closer look higher order truncations decalanine energy time fs energy figure 3 energy flexible water step size 25 fs figure 3 shows plot energy vs time 1 000 fs step size energy sampled every step note large fluctuations make difficult determine whether energy drift figure 4 shows plot 6th 8th order modified hamiltonians step size energy time fs 8th order 6th order figure 4 6th 8th order truncations step size 25 fs fs upward energy drift obvious 2nd 4th order approximations shown neither flat normal mode analysis system 10 shows 250 fastest frequencies periods range 98102 fs use formula 22 p 131 shows 25 fs step size 30 effective period discrete leapfrog dynamics remarkable 8th order approximation flattest even large step size figure 5 shows plot 6th 8th order modified hamiltonians step size apparent upward drift energy theoretically instability due 41 resonance 21 occur leapfrog method h delta angular frequency 2 range 2223 fs flexible water 3 augmenting integrator assume one step size h given method applied system hamiltonian h composition exact hflows hamiltonian systems hamiltonians h 1 h 2 hl h l x assumed sufficiently smooth domain containing infinite time trajectory example 1 leapfrog method separable hamiltonian systems hq 2 rowlands method 19 special separable hamiltonian systems uses h 1 3 double timestepping 7 24 uses 4 u fast q h 2 fast q energy time fs 8th order 6th order figure 5 6th 8th order truncations step size 215 fs 4 molly 5 double timestepping except substitution u slow aq u slow q aq local temporal averaging q vibrational motion defined homogeneous extension hamiltonian h quadratic h homogeneous order 2 extended hamiltonian yields augmented system initial condition system simplifies puq extended hamiltonian simplified augmented system remark association ff q rather fi practical importance want get values p calculated following proposition shows value extended hamiltonian calculated knowing solution hy homogeneous extension given hamiltonian hx let yt solution extended hamiltonian system ff initially 1 j matrix augmented dimension proof differentiating eq 4 respect oe gives h homogeneous extension h solution h includes h course goal calculate original hamiltonian know formula solution rather calculate modified hamiltonian know solution grid points formula therefore must augment integrator solution grid points homogeneous extension modified hamiltonian integrator composition hamiltonian flows accomplished using homogeneous extension constituent hamiltonians specifically define augmented method h composition exact flows systems hamiltonians hl h l q ff lemma 1 commutativity method psi h defined modified hamiltonian h h q p modified hamiltonian original method phi h ie following diagram commutes homogeneous extension discretization discretization homogeneous extension proof modified hamiltonian h h method psi h expressed asymptotic expansion using bakercampbellhausdorf formula 20 formula combines hamiltonians using operations scalar multiplication addition poisson bracket fh x jn x thus sufficient show three commute operation forming homogeneous extension show last homogeneous extension poisson bracket exactly extended poisson bracket ff remark aim discretize extended hamiltonian commutativity property holds extension technique implicit rungekutta methods would require augmentation method commutativity holds following corollary allows value hamiltonian approximated known values h grid points proposition 2 let x h h solutions modified hamiltonians h h tively jy h proof similar prop 1 2 4 using full step values section presents construction h 2k even values k let h solution modified extended hamiltonian system initial condition values h degree k polynomial interpolant values large k may preferable instead use trigonometric interpolation suitably modified 3 prop 2 1 jh z jh2 gammaj h22 interpolant k error brackets denoting 1th divided difference noting jh z jh2 gammaj h22 jetdt gammajh z jh2 gammaj h22 h z jh2 gammaj h22 jetdt oh 2k2 z jh2 gammaj h2 second equation obtained integrating parts flt def jy k1 expressed expansion forming suitable linear combination values h kj expected one get h h first k2 gamma 1 leading error terms eliminated linear combination h note value contains leading term oh k useful eliminating error terms case 4th order accurate formula case gammah z 2h gamma2h hence given formulas h 8 h 4 terms values h grid points let j jth centered difference h centered difference operator defined ffi averaging operator defined 4th degree interpolant divided difference form hence 6 3 ss 6 4 ss have2 powers averaging averaging gamma2 2 yields 90 14 gamma 107 therefore 2nd degree interpolant follows eq 5 implementation formulas might calculate h 2k consecutive values n terms quantities n defined terms centered differences n obtained x n 1st higher differences fi n needed example 1 make concrete calculate h 4 x leapfrog method given eq 2 leapfrog method advances one step suppressing n superscript whence needed7 7 therefore 41 case quadratic hamiltonian following result implies case hx quadratic numerical solution exactly conserves approximate modified hamiltonian linear functional 1 linear combination numerical solution values proposition 3 assume phi h composition flows systems quadratic hamiltonians psi h constructed proposition 1 quantity ij psi sum taken finite set pairs integers exactly conserved method psi h proof mapping psi h composition flows systems homogeneous quadratic hamiltonians ij sy ij psi y5 using intermediate values section presents construction h 2k odd values k numerical integrators one define sensible midstep values used instead full step values get estimate accurate oh 2k assume psi gammah2 psi h2 composition exact flows homogeneously extended hamiltonians remark necessary midstep values approximations yt midpoints psi h time symmetric psi gamma1 need psi psi 1h psi 2h composition exact flows homogeneously extended hamiltonians example leapfrog method separates half steps gammah2 psi h2 psi h2 follows remark leapfrog method estimate interval ngamma 1 2 kh n 1 k odd actually uses values energy forces shorter interval n gamma 1k n midstep values values midpoints function z h used construct hamiltonian proposition 4 let z h z h jz h proof real define psi shflow h symplectic z h hamiltonian system hamiltonian also h composition flows hamiltonians 2nd order homogeneous hence homogeneous order 2 z h degree k polynomial interpolant values z h let jh z jh2 gammaj h22 interpolant k error h z k1 similar get z jh2 gammaj h2 z h jz k1 h expressed expansion expected suitable linear combination different values h kj yields h h first k leading error terms eliminated linear combination h note seems possible combine values obtained full steps half steps increase order accuracy error expansions two kinds averages terms common cancel 2nd order formula z h2 gammah2 z 3h2 gamma3h2 e let b j jth centered difference z h using midstep values 3rd degree interpolant hence powers averaging averaging gamma 3 yields therefore 1st degree interpolant follows eq 13 example 2 calculate h 2 x leapfrog method given eq 1 jy n suppressing n superscript e therefore example 3 calculate h 6 x leapfrog method given eq 3 eqs 16 hffif eq 11b ffi 2 q f given eq 12 therefore 51 case quadratic hamiltonian proposition 5 assume phi h composition flows systems quadratic hamiltoni ans psi h constructed proposition 1 psi h2 assumed beginning section quantity ij sum taken finite set pairs integers exactly conserved method psi h proof compositions flows systems homogeneous quadratic hamiltonians mappings ij acknowledgment authors grateful assistance justin wozniak preliminary tests second order truncation henonheiles hamiltonian decalanine r httpwww hamiltonian interpolation near identity symplectic mappings application symplectic integration algorithms residual acceleration measure accuracy molecular dynamics simulations shadow mass relationship velocity momentum symplectic numerical integration scope method modified equations generalized verlet algorithm efficient molecular dynamics simulations longrange interactions lifespan backward error analysis numerical integrators asymptotic expansions backward analysis numerical inte grators longer time steps molecular dynamics namd2 greater scalability parallel molecular dynamics molecular modelling principles applications common molecular dynamics algorithms revisited accuracy optimal time steps stormerleapfrog analysis accuracy langevin molecular dynamics algorithm backward error analysis numerical integrators numerical algorithm hamiltonian systems numerical hamiltonian problems nonlinear resonance artifacts molecular dynamics simulations integration schemes molecular dynamics related applications geometric numerical methods perturbed integrable systems reversible multiple time scale molecular dynamics modified equation approach stability accuracy analysis finite difference methods tr ctr robert engle robert skeel matthew drees monitoring energy drift shadow hamiltonians journal computational physics v206 n2 p432452 1 july 2005 jess izaguirre scott hampton shadow hybrid monte carlo efficient propagator phase space macromolecules journal computational physics v200 n2 p581604 november 2004