grain filters motivated operators simplifying topographic map function study theoretical properties two kinds grain filters first category discovered l vincent defines grains connected components level sets removes small area category composed two filters maxima filter minima filter however commute second kind filter introduced masnou works shapes based connected components level sets filter additional property acts manner upper lower level sets commutes inversion contrast discuss relations masnous filter classes connected operators introduced literature display experiments show main properties filters discussed compare b introduction filters used simplify image satisfying minimal set invariance properties scarce actually one maximal set invariance properties driven parabolic partial dierential equation 1 26 18 curvux curvature level line u point x restricted regular points u however previous lter optimal terms invariance among regular lters lters driven pde property regularity desirable theory drawback modifying contours particular destroying junctions important clues occlusion 5 4 drop requirement bunch lters satisfying invariance properties available motivated study family lters reconstruction 9 10 21 31 32 serra salembier 30 25 introduced notion httppascalmonassefreefr c 2001 kluwer academic publishers printed netherlands v caselles p monasse connected operators operators simplify topographic map image lters become popular image processing experimental basis claimed simplify image preserving contours property made attractive large number applications noise cancellation segmentation 17 33 recently become basis morphological approach image video compression 23 24 22 6 dierent classes connected operators studied meyer 15 16 serra 29 heijmans 8 see also references therein article study theoretical properties two kinds connected operators extrema lters shape lters simplies topographic map image dierent senses given term topographic map maxima lter removes connected components upper level sets insucient area keeping ones identical 31 32 ensures regional maxima ltered image minimal grain size similarly minima lter removes small connected components lower level sets lters grain corresponds connected component level set small grains considered noise seen pruning tree connected components upper lower level sets previous work 3 introduced notion shapes designed deal symmetrically upper lower level sets shapes also organized tree driven inclusion applied images positive minimal grain size showed structure tree nite shown image resulting application extrema lters property new tree also provides denition another grain lter grain shape 13 19 20 removes small shapes preserving ones sucient area essential improvement extrema lters deals manner upper lower level sets vocabulary mathematical morphology 14 27 28 lter selfdual applied continuous functions present article organized follows section 2 recalls foundations mathematical morphology underlines link morphological lters set operators section 3 introduces main properties extrema lters proves section 4 prove analogous properties grain lter particular selfdual lter continuous functions generalizing result 2 finally section 5 illustrate lters experiment 2 general results mathematical morphology throughout section shall consider real functions dened subset ir n u real function dened ir n denote u set fx 2 ux g 2 ir similarly dene sets u u u 21 level sets u real function x implies particular conversely x family sets satisfying x level set level function u dened namely x weaker hypothesis monotonicity x 2ir guichard morel show 7 x ae almost every 2 ir 22 contrast invariance contrast change restrictive sense strictly increasing continuous ir therefore homeomorphism ir onto open interval ir direct consequence image u contrast change g applied u gu contrast change g indierently considered function dened ir operator acting functions u direct consequence 1 also written 4 v caselles p monasse showing families level sets g u u level changes morphological lter map acting functions u commutes contrast change g g 23 link set operator morphological filter operator acting sets necessary requirement transform level sets function level sets function thus lter associated dened equivalently denote b observe 11 12 indeed let right hand side term equality x 2 u denition b x deduce u hand since uy get immediately tux conversely uy n b n u 1n therefore taking intersection n get x 2 say contrast change g nondecreasing upper semicontinuous general contrast change use convention dened closed sets satises 2 sets f n closed dened upper semicontinuous functions easy check g commute applied upper semicontinuous functions get contrast invariance strong sense since g constant stretches needs continuous 24 spatial invariance properties ir n f map morphological lter whose associated set operator whose structuring elements given family b x x denote f morphological operator dened f dene image g fb x easy see f say invariant respect f instance b translation invariant lters shall discuss satisfy property respective family structuring elements globally invariant respect area preserving map ie special ane map lters thus special ane invariant depend parameter x set structuring elements lter x also satisfy b x 0 particular implies ane map f f 3 extrema lters 31 definition extrema lters constructed manner connected components level sets image minimum area call extrema lters connected component level set contains regional extremum achieved two steps rst connected components upper level sets ltered lower level sets dene set operators ensuring properties let us rst x notation let set homeomorphic closed unit ball ir n n 2 6 v caselles p monasse interior note particular compact connected locally connected moreover unicoherent ie b closed connected sets ab connected set x denote ccx connected components ccx x one containing point x provided x 2 x extension c connected ccx c ccx x x 2 c parameter representing area threshold let x subset dene lters g dene maxima lter minima lter sup show morphological lters whose associated set operators 0 respectively denitions voluntarily symmetric act upper semicontinuous func tions avoid cases suppose j 32 preliminary results lemma 1 c n n2in nonincreasing sequence compact sets n n2in nondecreasing sequence open sets proof clear ccc x ccc n x n conversely intersection continua thus continuum since contains x included c get inclusion n cco hand open locally connected cco x open set hence 2 cco x continuum k cco x containing x since k n compact set extract nite covering k sequence n non decreasing n k n since k connected contains x 2 k cco n x conclude proposition 1 following properties 0 nondecreasing subsets upper semicontinuous compact sets nonincreasing sequence compact sets lower semicontinuous open sets n n0 nondecreasing sequence open sets 0 n proof property direct consequence denitions monotone f applying lemma 1 observe ccf x particular n since 0 monotone let ju j let u lemma 1 proves hence n large enough ju n j conclude x 2 u n 0 n b two families sets say basis b b b 2 b 2 b 2 b basis fx basis xg proof direct consequence denitions corollary 1 applied upper semicontinuous functions morphological lter whose associated set operator 8 v caselles p monasse precisely proof let xg consequence proposition 1 uy use fact b basis c shown lemma 2 deduce u x sup uy inf taking supremum b get sup u similar proof applies link 0 proposition 2 let u v ir ii u v v proofs immediate include details corollary 2 let u ir u n u uniformly uniformly proof given 0 let n 0 u u n using proposition 2 ii iii iv obtain n n 0 hence uniformly similarly prove uniformly 33 properties proposition 3 u upper semicontinuous function also u u continuous also u proof let u upper semicontinuous function u closed set connected components closed since u nite union closed thus u upper semicontinuous manner u open set connected components also open image 0 thus union open sets open proves u upper semicontinuous finally suppose u continuous prove closed 2 ir using corollary 1 write claim c since open contains closed set c deduce n c open empty thus positive measure hence joj jcj proves joj thanks lemma 1 v caselles p monasse n proves remaining inclusion right hand side equality open conclude closed prove result write claim last set coincides g n open c closed jcj jo n j hence n n applying lemma 1 get yielding hence jccu proves thus equality terms right hand side term nite union closed sets also closed proposition 4 restricted upper semicontinuous function idempotent proof let u upper semicontinuous function 2 ir clearly applying equality set u using corollary 1 get thanks proposition 3 closed apply corollary 1 left hand side equality obtain since equality holds 2 ir conclude proof applies proposition 5 let u 2 proof cases similar sucient prove rst part assertion let ux observe v lower semicontinuous assume max 0be contains open set hence letting choosing mwhich contradiction conclude proposition proved ii cases similar shall prove uniformly 0 let us write given 0 let 0 0 small enough v caselles p monasse ie collecting facts 34 interpretation let u upper semicontinuous function jcj thus c connected component c connected component u even meet set since conversely u connected component u since c 6 summing remarks see connected components exactly connected components u measure particular since connected components upper level sets structure tree driven inclusion tree tree u pruned nodes insucient measure observations made concerning connected components u tree tree connected components lower level sets u pruned nodes insucient measure summarizing discussion following result proposition 6 u 6 jxj jccu j resp u j particular result implies connected components thing said connected components upper lower level sets u 35 composition lemma 3 let u upper semicontinuous function 2 ir proof let u consequence false would c u since contradicts denition c c c open c c c x belongs connected component u connected included u jdcj get dc contradicting denition c proves claim x 2 c ux arguing contradicts hypothesis thus may assume c let since c closed open c thus x meaning jccu xj component must therefore jdj finally observe u contradiction theorem 1 operators transform upper semicontinuous functions upper semicontinuous functions continuous functions continuous functions ii idempotent upper semicontinuous functions proof direct consequence equivalent properties proved proposition 3 consequence proposition 2 function u applying u get 14 v caselles p monasse apply rst part lemma 3 nd point x 2 c v let know jdj since connected proves thus equality member using idempotency conclude similar proof using second part lemma 3 prove idempotent 4 grain lter 41 definitions problem extrema lters presented two operators act upper lower level sets general commute moreover none property deal symmetrically upper lower level sets actually work two steps rst upper lower level sets treated opposite order operators selfdual definition 1 morphological lter associated set operator said selfdual continuous functions following equivalent properties hold continuous function u 1 2 8x sup b2b inf y2b describing structuring elements 3 8 u show equivalence rst two properties suces write second one u instead u taking instead see third property equivalent using contrast invariance amounts write means exactly tu recall denition essential properties saturation operator definition 2 let p 1 xed point x call holes x connected components x external hole x x holes internal holes x saturation x satx union x internal holes following results proved 3 proposition 7 1 2 3 x connected satx connected connected 4 x open resp closed satx open resp closed 5 closed 6 satx connected subset x 7 h internal resp external hole x 8 nested disjoint 9 let x open closed x x 2 sato satc u upper semicontinuous function call shapes u elements tree structure u expressed properties 3 nested disjoint v caselles p monasse restrict denition set operator closed sets since later dene lter upper semicontinuous images k compact set dene f internal hole c jc 0 j clearly g compact k thus always suppose j remark dened grain lter compact sets since sucient extension lter upper semicontinuous functions obviously denition sense subset 42 preliminary results lemma 4 g nondecreasing compact sets proof let k l compact sets let family internal holes c observe c hand h 0 internal hole c 0 included hole h c thus jhj observations deduce families internal holes c resp c 0 whose measure conclude g k g l lemma 5 k compact proof let us denote c i2i family connected components k let set indices jsatc j monotone inclusion immediate denition identity also observe g c union c internal holes thus connected let j subset whose cardinal least 2 let prove connected connected open closed subset e 0 0 dierent 0 observe e 0 union c j since sets connected precise let us write prove e open closed hence connected clearly 6 e since e 0 open 0 open set u 0 u 0 union connected components u 0 meet c l l 2 l set u 00 union open sets open set u union u 00 internal holes c l open also open j 2 j nl eg indeed last equality hold would connected component u 0 meeting c l l 2 l denition u 00 c j indeed meets hole h c j jhj h cannot contain c l otherwise since h n satc l open empty thus positive measure would jhj l j thus connected meets two dierent connected components component containing c l hence c j 6 implies u 0 c j 6 contradicting identity conclude hold ie u 00 g therefore u 00 n e proving u shown set e open applying argument prove e also closed lemma 6 let c n n2in nonincreasing sequence continua n c n h hole c exists n 0 2 nondecreasing sequence hole c n proof x 2 h n 0 x 62 c n n n 0 thus n n 0 x hole h n c n obviously h n h therefore h n h u neighborhood v connected neighborhood v u since 2 h n monotonicity h n may write nnn h n also v caselles p monasse connectedness v implies follows v c 6 implies u c 6 true neighborhood u get 2 implies h h n closed h since also open union open sets connectedness h implies theorem 2 operator g upper semicontinuous ie k n nonincreasing sequence compact sets proof inclusion left hand side term right hand side one due monotonicity g show inclusion lemma 5 n n 1 c n inside implying due lemma 5 shows sequence continua c n nonincreasing intersection c continuum thanks zorettis theorem since c contained component remains show x 2 g c taking h proves h thus jsatcj moreover x belongs internal hole h c since x 2 g c n associated sequence h n obtained lemma 6 jh n j thus hence x 43 properties lemma 7 closed set c connected component h internal hole x h g proof right hand side term equality h 0 obviously contained h suppose inclusion strict set h connected h 0 open union open sets h 0 closed h h h 0 6 let 2 h h 0 let u connected neighborhood claim ua 6 otherwise would u u meets n u g 0 connected contradicting g conclude 2 g since g open set contains neighborhood 2 h 0 particular meets g n x 2 g 00 h thus g g 00 nested g 6 h 0 g 00 g thus x 2 g g h implying g h 0 contradicts assumption since 2 g conclude h lemma 8 let b closed sets proof suppose b disjoint taking components b instead b may assume b connected result obvious g g b empty may also assume none empty sata satb either nested disjoint disjoint since g sata g b satb 5a obvious nested without loss generality may assume sata satb sata inside hole h b get jhj jsataj since sata closed h open open nonempty set thus positive measure yields jhj therefore sata 5a suppose let x 62 g particular implies satc c cca set c n satc connected also n satc compact set lindelofs theorem intersection family continua written intersection sequence thus nd sequence c n connected components v caselles p monasse let clearly n nonincreasing sequence continua may write thus continuum observe b indeed connected component c since yn satc obviously 2 satc c prove connected neighborhood u meets point otherwise cu would connected turn implies u c since n b conclude b contradiction choice proves b also observe thus jsatdj one following cases happens iii x 2 satc jsatcj suppose holds x 2 since jsatdj suppose ii holds let set dened x 2 x 2 g g b x 62 x hole h thanks lemma 7 write g thanks lindelofs theorem union open sets written union sequence g n sets n since g 0 obtain jg n j jsatcj conclude sup n2in jg n j thus x 2 h g g b finally suppose iii holds let c claim connected component nite number sets e intersection result due fact nested innite number sets e write intersection intersection sequence e n thanks lindelofs theorem taking n instead e n may also assume sequence nonincreasing set therefore continuum jt connected neighborhood since u 6 n u n e n 6 since u connected meets complement u also meets e n obtain shows hand observe complement connected union increasing sequence connected sets thus written intersection two continua thus connected since unicoherent thus 0 implies jej 0 e 6 therefore satt 0 e follows satt 0 thus equality observe x must hole h 0 must jhj since otherwise x using lemma 7 write g may write union union nondecreasing sequence sets g n thus n write g n x hole h 0 contained connected component k case also x n since g 0 n contained connected component k 0 b get x theorem 3 restricted continuous functions g selfdual proof shall prove condition 3 denition 1 holds according 5a may write 2 ir since g u n taking intersection n get therefore 22 v caselles p monasse let x n 0 x due 5b x 2 proves thus taking complement part get proves actually equality sets theorem 4 semicontinuous functions upper semicontinuous functions continuous functions continuous functions proof show image compact set k compact set let sequence points g k converging x shall prove x 2 g k shown lemma 5 x n belongs g k n k cck family fk n n 2 ing nite extract subsequence belonging g k n 0 closed set since complement union holes k n 0 holes open sets thus x may assume fk n n 2 ing innite maybe extraction subsequence km k 6 n satg k n nite number saturations two two disjoint since measure least thus extraction subsequence necessary may assume intersect form either decreasing increasing sequence sequence satk n n2in decreasing intersection set satk 0 cck shown lemma 8 jsatk 0 otherwise would k suciently large n contained hole k n n thus x n 62 satk 0 n since x 2 satk 0 conclude desired result let us assume satk n n2in increasing since lim inf sequence k n nonempty contains x lim sup continuum c according zorettis theorem since k compact follows c observe x 2 k 0 shall prove jsatk 0 j precisely satk n measure internal hole k 0 result implies k n k 0 6 k since connected components k since assuming sets k n two two disjoint cannot happen twice thus may assume k n k n sequence satk n increasing k n hole k 0 suppose hole external hole h k 0 since h open continuum l joining p 1 arbitrary point 0 k 0 since k 0 internal hole k 1 manner construct sequence n n2n n 2 lk n n l compact subsequence n converges point 2 lc follows k 0 l 6 contrary assumption l hole k 0 proves claim applying preceding result u continuous u upper semi continuous since u also upper semicontinuous u also upper semicontinuous hence u lower semicontinuous thus u continuous proposition 8 0 therefore g idempotent proof conclusion g idempotent derives previous statement taking result amounts show g 0 u distinguish three families among connected components v caselles p monasse observe thanks lemma 5 may write internal hole c internal hole c measure reason conclusion yields following properties easy consequence denition lemma 9 operator satises following properties u v function u 2 ir lemma 10 let u upper semicontinuous function let proof let us x since sucient prove g v almost 2 ir let denote family connected components k hk family internal holes k observe c2ckjsatcj internal hole c jhj g since proposition 6 connected components k measure c 2 ck satises jsatcj similarly since internal hole k contains connected component v also measure hence family sets h 2 hk jhj empty conclude g proposition 9 let u 2 0 proof using lemma 0 proposition 5 given 0 0 0 implies u therefore u choose 0 obtain u 2 proposition follows 44 relations connected operators want compare grain lter described notion grain operators dened 8 x ideas shall work classical connectivity thus denote c family connected sets grain criterion mapping c c f0 1g given two grain criteria f foreground b background associated grain operator fb dened 8 heijmans characterizes grain operators selfdual increasing indeed proves fb selfdual b also proves fb increasing f b increasing following condition holds x x shall say grain criterion c c f0 1g upper semicontinuous compact sets c n k n decreasing sequence continua k n n 2 26 v caselles p monasse proposition 10 let selfdual increasing grain oper ator associated grain criterion c assume c upper semicontinuous proof either point x rst case deduce nonempty subset x therefore 6 x since also x second case using upper semicontinuity c cbx choose observe cccx fxg contradicts 6 proposition says nontrivial translation invariant increasing selfdual grain operators types connected operators called attenings levelings introduced f meyer 1516 studied 29 particular serra proves exist increasing selfdual attenings levelings based markers 29 finally let us prove grain lter introduced corresponds universal criterion dene increasing selfdual lters let us recall denition connected operator 25 30 8 given set x denote p x partition constituted ccx ccx c family subsets x denoted pdefinition 3 operator p p connected partition p x coarser p x every set x given connected operator p p shall say increasing x x ii acts additively connected components x family connected components x iii selfdual ir n n open closed set x iv bounded p 1 dicult see connected operator increasing selfdual induces increasing selfdual lter continuous functions proposition 11 let p p connected operator suppose increasing selfdual bounded acts additively connected components let ker fx open closed connected set satx 62 ker hx denotes family internal holes x proof since selfdual without loss generality may assume p 1 62 x since connected operator z simply connected z must one sets f g since bounded must either particular either satx rst case satx 2 ker second case using additivity connected components observation beginning proof using selfduality x obviously increasing ker ideal sets ie x x 2 ker 2 ker 45 interpretation similar remarks extrema lters made concerning shapes shapes u shapes u sucient measure corresponds pruning tree shapes u 5 experiment theoretically lters g dierent illustrated figure 1 second row shows ltered images 3 u dierent stressing respective notions grains dierent dierence appears presence holes concerning natural im ages dierence would apparent certain images 28 v caselles p monasse11202 figure 1 topleft original image u three constant regions supposed area 2 bottom left g3u middle column 3 u 3 u 3 u figure 2 texture image carpet size 254 173 textures nestedness shapes would important figure 2 shows complex texture figure 3 image ltered according three lters parameter pixels whereas actually dierent visually equivalent distinguishing requires eort explain fact connected components level sets hole greater area scarce words situation illustrated figure 1 frequent figure 3 three grain lters applied image u figure 2 left column g30u acknowledgements acknowledge partial support tmr european project vis cosity solutions applications reference fmrxct980234 cnrs pics project rst author acknowledges partial support pnpgc project reference bfm20000962c02 v caselles p monasse r image iterative smoothing pdes random sets integral geometry mathematical morphology application signal image processing mathematical morphology application signal image processing image analysis mathematical morphology tr introduction mathematical morphology watersheds digital spaces affine invariant scalespace morphological multiscale segmentation image coding selfdual morphological operators filters connected operators levelings levelings fundamenta morphologicae mathematicae compact multiscale image model based level sets ctr renato keshet shapetree semilattice journal mathematical imaging vision v22 n23 p309331 may 2005 renato keshet adjacency lattices shapetree semilattices image vision computing v25 n4 p436446 april 2007