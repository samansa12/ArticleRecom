analysis costate discretizations parameter estimation linear evolution equations widely used approach parameter identification output leastsquares formulation numerical methods solving resulting minimization problem almost invariably require computation gradient output leastsquares functional identification problem involves timedependent distributed parameter systems approximations thereof numerical evaluation gradient extremely time consuming costate method greatly reduce cost computing gradients however questions raised concerning accuracy convergence costate approximations even numerical methods used known converge rapidly forward problem paper shown use timemarching schemes yield highorder accuracy forward problem necessarily lead highorder accurate costate approximations fact cases approximations converge however certain circumstances rapidly converging gradient approximations result rapid weakstartype convergence costate approximations issues treated theoretically numerically b introduction paper analyze temporal discretizations costate method computing gradients output leastsquares approach parameter esti mation analysis applies initial value problems form aq bounded linear operator hilbert space h inner product h denoted hdelta deltai h dot u indicates differentiation respect refer u state variable 11 state equation assume q lies set qad admissible parameters contained normed linear parameter space q throughout paper assume map q 7 aq gateaux differentiable operator norm applications interest 11 finite dimensional ie dimh 1 approximation timedependent pde important example diffusion equation department mathematical sciences montana state university bozeman mt 59717 research supported part nsf grant dms9106609 center interfacial microbial process engineering montana state university nsfsponsored engineering research center centers industrial associates center applied mathematical sciences university southern california los angeles ca 90089 1113 address july 1 1992 department mathematics texas university college station 778433368 research supported part air force office scientific research grants afosr900091 afosr860126 nsf grants dms8818530 dms8704169 situations dimh arbitrarily large general assume solution u lies state space hilbert space inner product banks kunish 3 assume existence observation space z hilbert space inner product hh delta delta ii z observation operator given observation z u one wishes estimate parameter q output leastsquares approach parameter estimation q 2 qad selected minimize functional uq solution 11 scalar ff positive regularization parameter n 2 q regularization functional whose purpose stabilize minimization usually n q norm seminorm q computational methods minimize ff q typically require gradients gradient ap proximations example assuming discretization parameter form one often see example 3 section v6 approximates components gradient using finite differences eg small scalar note limit 0 th component rt ff q directional ie gateaux derivative ff q direction dimh n q large gradient approximations based directly 15 extremely expensive requiring evaluations functional ff hence n q solutions evolution equation 11 attractive alternative costate approach 3 section v5 7 described continuous form section 2 sharp contrast n q 1 state equation solutions needed finite difference method 15 costate method requires solution two evolution equations state equation costate adjoint equation followed n q hinner products unfortunately computational experience adjoint approximations parameter estimation certain evolution equations puzzlingly disappointing example authors 4 concluded approach unsatisfactory extremely difficult obtain accurate search directions gradients computed manner also 2 authors suggest costate method certain class damped elastic systems explain may facilitate efficient use gradientbased methods conjugate gradients bfgs also report used numerical experiments however none specific examples upon report use method subsequent private communication two authors revealed encountered unexpected difficulty costate approach later commenting 1 banks states experienced much difficulty costate based gradient methods abandoned similar difficulties encountered optimal control settings 5 dealt computational methods control systems governed delay differential equations authors observed certain spline approximations solution operator ricatti equations failed converge strongly subsequent work 6 carefully shown underlying difficulty lack strong convergence adjoint approximations paper focus temporal discretizations costate system leastsquares parameter estimation since costate method computing rt ff q requires solution two evolution equations plus n q inner products two important components numerical scheme approximating gradient scheme approximating solution evolution equations assume timemarching scheme b numerical quadrature scheme say th order accurate one would reasonably hope attain th order convergence gradient approximations however observation operator c involves pointwise evaluation time certain subtleties arise one may observe unexpectedly poor convergence gradient approxi mations perhaps striking examples present involve fourthorder rungekutta rk4 timemarching scheme show rk4 used conjunction simpons rule fourthorder numerical quadrature gradient approximations fail altogether converge show fact rk4simpsons approximations converge secondorder accuracy 32 times true gradient positively perhaps equally surprisingly prove rk4 together secondorder accurate trapezoidal quadrature rule yields fourthorder convergence underlying reason strange phenomena c involves pointwise evaluation time costate equation evolution equation diracdelta functions forcing term reason costate approximate solutions converge strongly however cases exhibit highorder convergence weak topology dual space c considerations similar spirit work reported 6 introduction paper authors state feel many distributed parameter control systems might lead numerical difficulties used optimization schemes hope reader motivated think similar problems complex distributed parameter systems paper addresses optimal control problem nonetheless relevant us extent output leastsquares parameter estimation mathematically similar optimal control banks 1 suggested nonconvergence costate approximations also occur parameter estimation lack convergence spatial discretization example systems 12 one must discretize respect component x well respect result needed costate approximations essentially convergence dual semigroups considerations suggest directions future work pursue section 2 discuss costate method continuous problem apart temporal approximations section 3 introduce fairly wide class timemarching schemes 11 corresponding costate approximation scheme analyze approximations detail making certain assumptions properties timemarching scheme observation operator various operator discretizations section contains numerical examples illustrate results analysis section 5 several alternative approaches avoid difficulties mentioned presented conclusions work discussed section 6 2 continuous costate approach stated introduction typical implementations output leastsquares approach parameter estimation require gradients functional ff q given 14 effort obtaining gradient lies computing gradient least squares functional solves state equation since gradient q obtained computing directional derivatives focus throughout computation directional derivative q direction p given residual defined hence solution 22 given terms solution operator sq z te aqs terms sq thus taking adjoints c sq one obtains solution costate equation operator q given e gammaa qs differential equation satisfies since equation final condition instead initial condition useful note equivalent j time reversal operator h defined costate approach computing rt q consists following four steps continuous costate method solve state equation 22 state variable ii compute residual iii solve costate equation 29 costate variable iv compute directional derivatives directions p cf equation 15 note approach requires solution two evolution equations state equation 22 costate equation 29 opposed n q 1 evolution equations 15 moreover linear q case approximations 12 example implementation step iv straightforward finally note complete computation rt ff q necessary compute gradient rn 2 q regularization functional usually trivial 3 analysis discrete approximations 31 discrete approximations usually solving 22 numerically one uses sort finitedifference timemarching scheme tms section pose analyze rather natural algorithm computing costate approximations based given tms continuous costate method described given n let denote specified mesh 0 f define h k k later use discussions asymptotic rates convergence define also let u k approximation state variable u n k obtained using particular tms mesh denote fft n k g f n may express approximation approximation used minimization scheme ff q parameter estimation problem corresponding continuous leastsquares functional 21 define z n z n c n discretizations z z c discussed detail minimization scheme requires directional derivatives ie gradients seemingly natural approach 3 section v5 call discretized costate approximation based obvious discretization continuous costate method suggests discretized costate approximation compute ii compute residual r iii compute n j n approximation j cf 210 given c n approximation adjoint c iv approximate directional derivatives directions p hh delta delta ii h n discretization continuous inner product 13 convergence g depends factors convergence time marching scheme tms forward problem convergence approximations c n observation operator c convergence discrete inner products hh delta delta ii h n continuous inner products hh delta delta ii h hh delta delta ii z respectively carry convergence analysis first carefully state discrete version problem h f k0 k0 h n inner product fw n k0 given sequence weights purpose weights facilitate definition hh delta delta ii h n way wellapproximates hh delta delta ii h accordingly assume essentially without loss generality exists independent n forms basis following lemma lemma 1 sequence ff n g 2 h n property constant 0 0kn kf n kf n kh also denote hh delta delta ii e n inner product loosely speaking uses standard euclidean inner product time component specifically inner product used adjoint computations two inner products related w n diagonal operator h n defined assume time marching scheme tms form n q defined recursion bounded operator b k q expressed terms components see section 4 specific examples make following assumptions tms a1 tms stable 10 ie exists terms product ordered left right decreasing indices a2 constant a2 f 2 c 0 f h ft ds ojhj a4 state equation 22 forcing function f lies c 0 f h following theorem readily established theorem 1 a1a4 hold using a2a4 22 312 one obtains one use a1 induction show 0kn theorem follows lemma 1 32 rate convergence gradients address convergence state directional derivative approximations results obtained subsection later used proving convergence discrete costate approximations assume existence operators also note c make following assumptions relationships inner product approximations a5 consider convergence directional derivatives 25 31 a6 holds rate convergence e 1 directly determined rate convergence solutions forward problem e 3 assured a5 rate convergence e 2 determined fast taking directional derivatives component form recursion 312 hand ft n taking directional derivatives gives comparing 319 320 one show desired convergence provided directional derivative operator preserves convergence rates smoothness precisely assume r h ds ojhj obtain following analogue theorem 1 theorem 2 assumptions a1a4 a2a4 hold proof notational convenience suppress dependence q first show k kh bounded independently k n applying 319 recursively assumption a1 j assumptions a2a3 theorem 1 z h je ft integral term inequality bounded independently j consequence assumption a4 subtracting 320 319 ft n ds boundedness k result theorem 1 assumptions terms right side equation ojhj 1 except first term thus equation form 313 argument used proof theorem 1 apply 315 one obtains following result theorem 3 assumptions a1a6 a2a4 proof referring equation 316 schwartzs inequality definitions r r n z n first term within parentheses ojhj theorem 1 second a6 kffi p u n kh n bounded theorem 2 consequently je similarly equation 317 theorem 2 assumption a6 finally 318 a5 je 3 33 continuoustime versus discretetime observations following subsection analyse convergence costate approximations subsection make preliminary considerations toward end leading specification two distinct classes observation operators c brevity notation set 211 34 one obtains consequence theorem 1 boundedness ffi p fact operators ffi p p n commute sequence fky n kh ng bounded schwartzs inequality 324 imply ng bounded je hence rate convergence costate approximations directional derivatives depends rate 29 see operator representation z te aq similarly 32 operators obtained replaced q formation n r n cf 310311 operator c approximation adjoint c z select adjoint operator different choice might made basis discussion section 5 since costate vector given terms evolution equation c r source term similar statement true approximations find convenient specify c facilitates analysis convergence je 2 j commonly happens applications c inherits type tensorproduct structure state space particular assume existence bounded spatial observation operator z hilbert space related z descibed distinguish two cases practical importance observations continuous time first case observation operator c con tinuous time defined terms space z bounded operator acts case defined addition define q n inner product approximation manner analogous 35 36 note case validity assumption a5 determined quadrature weights w n k also determine accuracy hh delta delta ii h n approximates assumption a6 trivially satisfied case since c n p 328 definition adjoint residuals r r n appearing given observations discrete time second case assume observation operator c consists spatial observations taken discrete points time accordingly assume discrete observation space z form z simplicity assume given set temporal observation points f g timemarching grid n always chosen f g ae n always injective map ng f 2 c0 f case since observation space already discrete define identity z 3 case assumption a5 always true since z also a6 always true since continuoustime observation case c n p c true since assumed f g ae n 329 definition adjoint find c z 7 h given ffidelta denotes dirac delta function discrete analogue 332 ffi k denotes kronecker delta function integer pairs 34 rate convergence costate approximations discussed previous subsection immediately following 323 suffices consider convergence term je 2 j zero address simple case continuous time observations first case th order convergence e 2 results observed data z smooth enough theorem 4 a1a6 a2a4 hold data z lies c 0 f z proof 325 325 note j c c preserve smoothness respect smoothness z smoothness u follows a4 jc r 2 c 1 0 f h applying theorem 1 jc r place forcing function f place noting last term 334 ojhj also a1 a3 ks n k bounded independently n 335 336 suffices show follows theorem 1 boundedness c c result theorem assumption quadrature weights chosen correctly cf 36 obtain costate convergence corollary 1 hypotheses theorem 4 hold g 1 g 2 c 0 f h proof theorem 4 implies sequence fky n kh ng bounded discussion immediately following 323 suffices show first term ojhj theorem 4 since oe sufficiently smooth second term ojhj 337 next address case discrete time observations case c r given linear combination dirac delta functions 332 since forcing term costate equation question fast g rather delicate particular smoothness c r played crucial role proof theorem 4 present case c r smooth exists distribution thus proof theorem 4 hence corollary 1 valid case hand convergence 333 stronger actually needed essentially statement strong pointwise convergence h 323 see sort weak convergence would sufficient rewriting e 2 noting oe 2 c 1 0 f h need establish th order weak convergence n dual space c 1 0 f h seemingly natural situations weak convergence apply number subtleties arise exploration matters discussed shortly however one class problems fully analyze covers variety secondorder methods uniform meshes n theorem 5 assume assumptions a1a4 hold b a2a4 c observation points lie interior 0 f partition n uniform sense h e quadrature weights w k equation 36 given w weights correspond trapezoid rule numerical quadrature f operators b k terms n defined cf 311 k operator b g operator r n may written note 311 last component r role tms purpose defining way become clear h operators b r 0 r 1 rational functions aq proof corollary 1 suffices show leads us study 326 see shall take adjoints inner product right side equation main effort proof lies subsequent simplification particular goal show proceed details first note 39 since p n oe 0 condition e obtain referring 342 344 noting j n j n equals identity obtain j j r n denotes adjoint respect e n inner product defined 39 used fact j n selfadjoint respect hh delta delta ii e n next assert r n 311 339 340 operators n r n following block toeplitz matrix representations r blocks operators h operators n r n identical block toeplitz form except b r 0 r 1 replaced hadjoints consideration block matrix representations action j n e n adjoint one verify 346 347 hold thus 345 simplifies thus question arises much n r n r n n differ since b r 0 r 1 rational functions aq commute computations based directly 311 340 reveal arbitrary r r r results may also obtained directly matrix representations 348 349 thus commutator equation 351 holds g 2 h n case present interest namely 350 role g played p n oe p n oe thus 350 351 observation points less f yet occur mesh points see discussion leading 330 thus c n r n last term equation drops also since n r n p n oe obtain condition e combining 342 yields 343 theorem 1 reasoning similar proof theorem 1 since oe smooth also ks consequently right side 343 may replaced hh z within secondorder using definition e 2 323 fact hh find result follows assumption a6 result similar theorem 5 obtained certain fourthorder methods includ ing rungekutta uniform mesh provided forcing function f zero provided appropriate quadrature weights chosen surprisingly weights correspond second order quadrature rather fourth order theorem 6 assume forcing term f satisfies theorem 5 hypothesis b a2a4 c theorem 5 hypothesis c theorem 5 hypothesis theorem 5 hypothesis e f theorem 5 hypothesis f g operator r n may written theorem 5 hypothesis h proof given g 2 h n r n g defined k 0 r n g 0 unspecified define f r n note f a3 satisfied r n necessarily f r n c therefore may replace r n f r n 326 since block matrix representation f r n toeplitz following reasoning similar leading 350 proof theorem 5 obtain r proof theorem 5 consider extent f r n n fail commute goal show r may invoke reasoning similar following 352 f r 311 354 fact lengthy straightforward computations also definitions n r n f r n a3 find 1 k n z oet n ds substituting 356 yields gammah z oet n ds oh 4 integral term equation approximated within fourthorder accuracy replace oet secondorder taylor polynomial arguments used show fourthorder convergence simpsons ruleh z oet n z n ds oh 4 evaluated n use assumption a3 make substitutionh z oet n hypothesis u 0 means thush z oet n h also oet n oet n replaced n n respectively within thirdorder accuracy 358 yields g fact true a2 thus arrive shown 1 r using 355 reasoning similar 353 obtain also natural ask happens use fourthorder tms fourthorder quadrature scheme simpsons rule show gradient approximations thus computed fail converge although directions space q converges particular rk4simpson costate approximations converge quadratically 32 times true gradient corollary 2 assume hypotheses theorem 6 hold except e assume e quadrature weights arising simpsons rule limit n 1 taken repeated doubling n precisely integer n 0 n equals n 0 2 l positive integer l arguments similar used obtain 355 find r r n 354 define rap weight matrix corresponding trapezoidal rule shall show kv gamma vkh implies r show induction kv gamma vkh note first v assume k 1 v note 311 fw n k g simpson weights diagonal entries w n simp thus definition w n simp smoothness oe fact follows second parenthesized term equal h 2hoet n a2 using observations definition w n dividing 2 thus find inductive hypothesis v may replace v kgamma1 v kgamma1 right side equation resulting expression definition formula thus since also true obtain v holds may use reasoning leading 359 obtain next turn attention c n r n g referring 33 see g depends linearly f1w k g show simpson weights replaced trapezoidal weights result call 32g indeed follows easily hypothesis guaranteed even simpson weights w k satisfy w 23h simply 32 times th trapezoidal weight thus right side 362 equal within oh 2 32 times right side 355 thus result theorem 6 applies obtain desired result 4 numerical examples illustrate results previous section focus splinebased galerkin approximation fixed dimensionality diffusion equation 12 one space dimension directional derivatives corresponding leastsquares functional 21 accordingly 1 fixed n 1 take basis functions fb g n usual piecewise linear hat functions uniform mesh nodal points x 1 given 1 n seek approximations u solution diffusion equation 12 linear combinations basis functions ie fixed denote coefficient vector fu tg simply ut ndimensional linear system form 22 obtained u standard galerkin method requiring ux z 1 z 1 gammaqx x dx dx implementation integrals left side equation encoded exactly ones right side approximated using trapezoid rule report results six numerical experiments 3 thus h subspace l 2 0 1 consisting continuous functions 0 1 equal zero endpoints piecewise linear interior nodes x one experiments example continuous time observations rest based discrete time observations cases spatial observation operator c 327 defined pointwise evaluation functions h points function qx perturbations px represented linear splines described perturbations p elements h specifically zero endpoints vary x 3 thus qdependent linear evolution equation given data z generated carrying approximations outlined approximated linear spline interpolate source term fx chosen solution ux 12 ux directional derivatives 23 approximations 34 investigated based qx j 1 three experiments based nonuniform meshes n explain meshes generated sufficient explain vectors fh k g generated highlight dependence n denote vectors h n individual hvalues h n k generate nonuniform h n begin given n create uniform mesh setting h n n given mesh ratio r satisfying 1 mesh refinement scheme generating h 2n h n n choice refined meshes uniform clearly true choice r examine convergence properties costate approximations using four different timemarching schemes 32 state equation 22 methods cn trapezoidal cranknicholson method rk2e explicit secondorder rungekutta method rk2i implicit secondorder rungekutta method rk4 explicit fourthorder rungekutta method order express rk4 method form compatible hypothesis g theorem 6 first obtain fourthorder accurate approximation f k12 evaluating n k1 2 cubic polynomial interpolates 2 uniform mesh yields carried rather extensive numerical investigation using matlab software package 9 sun sparcstation 2 decstation 5000200 cases compare costate approximation g centereddifference approximations computed evaluation expression limit sign 23 replaced n ffl value ffl called eps matlab machinedependent constant defined smallest integerpower 2 1 sparcstation 2 numbers represented sixteen decimal places choice ffl finite difference computation reflects desire strike balance discretization error roundoff error heuristics 8 pages 3132 expect ffi p n fd thus computed agree correct value roughly half sixteen decimal places result theorem 3 true gradient discrete functional full accuracy ffi p q assumptions a5 a6 course since within eight digits triangle inequality implies rate convergence g correctly indicated rate convergence g long relative difference two quantities larger six experiments tabulate relative error 1im four methods jhj varies results estimate actual rate convergence based assumption e case 1 observations continuous time meshes nonuniform refinement 13 trapezoidal quadrature rule used h n inner product three secondorder methods simpsons rule used rk4 method 667e3 16e6 26e4 20e4 29e6 444e3 52e7 78e5 68e5 21e7 27 27 27 64 case 2 experiment motivated theorem 5 take observations discrete time uniform meshes quadrature weights 36 arising trapezoidal rule results presented following table 10e2 88e10 87e5 69e5 39e6 three rungekutta methods appear converging secondorder rate predicted theorem 5 cranknicholson costate approximations agree forwarddifference approximations within nine decimal places roughly expected accuracy ffi p n fd fact uniform meshes g computed cranknicholson method exactly equals neglecting roundoff error outline proof assertion recursion formula 312 takes form using 319 leads referring 322 42 see last equation recursion reasoning similar led 343 right side equation rewritten 34 322 326 g numerator 41 nonzero extent explains cranknicholson column table case 3 example case 2 nonuniform meshes generated 13 case theoretical basis expect convergence indeed table suggests convergence obtained 67e3 16e3 27e2 19e2 98e3 44e3 16e3 24e2 20e2 42e1 case 4 conjecture cases even though meshes n may nonuniform highorder convergence still achieved provided meshes locally uniform sense given n h k near given observation point constant precisely positive integer oe real h n 330 example repeat experiment reported case 3 took steps ensure refined meshes locally uniform 67e3 58e5 62e3 22e3 98e3 44e3 25e5 21e3 12e3 42e1 table suggests highorder convergence sometimes obtained locally uniform meshes however pursue idea case 5 next present example illustrating theorem 6 forcing term f state equation changed rk4 method used together quadrature weight matrix w rap arising trapezoidal quadrature rule weights appear theorem 6 hypothesis mesh refinement uniform 10e2 65e8 43 case 6 finally illustrate corollary 2 repeat experiment shown case 5 using simpsons rule instead trapezoidal rule compare g 10e2 31e3 22 5 alternate approaches throughout preceding sections discussed use discretized costate approximation attempted illustrate delicacy procedure pointwise time observations involved least three possible approaches also merit consideration pointwise observations involved briefly discuss strategy pursued sections 2 3 take discretization adjoint system first derive costate method continuous problem discretize resulting equations integrals alternative would use adjoint discrete system approach straightforward applied boundary value problems certain complications may arise implementation evolution equations particularly time marching schemes used temporal discretization particular definition 31 discrete leastsquares functional expression components ffi p u n 319 definition 311 n q see fl n q p given thus advantage approach yield exact values directional derivatives n hence numerical attempts minimizet n fixed n would ideal however involves use fl n q p given 51 may require significant amounts additional mathematical effort code complexity computational execution time disadvantages may negated whole part certain special cases expression simplified simplification occurred cranknicholson method uniform time meshes described case 2 section 4 however pursue approach another alternative 3 section v 530532 retain strategy discretizing continuous adjoint system transform costate equation 29 increase smoothness source term done introduction two new variables given z tjc rs ds idea since piecewise constant opposed jc r linear combination dirac delta functions easier obtain accurate numerical solutions first approximating given briefly explored idea numerically repeated relevant numerical examples case 2 case 3 section 4 cases four tmss used approximate instead set runs observed linear convergence directional derivatives eg approximately 1 case obviously uniform time meshes case 2 represents loss accuracy nonuniform meshes case 3 definite improvement one alternative consider modifying step iii discretized costate approximation along following lines instead attempting integrate whole interval 0 f one shot tms one treat subinterval rately using fact j n c zero interior subintervals jump discontinuities correspondingly quadrature 34 must modified although implementation complicated analysis along lines proof corollary 1 applies consequently sufficiently smooth statevariable forcing functions f full accuracy tms quadrature yield full accuracy costate approximations 6 summary conclusions costate method offers potentially dramatic time savings computing gradients parameter estimation problems timedependent systems indicated care must taken using approach shown analytically numerically use convergent timemarching quadrature schemes seemingly reasonable combinations yield surprisingly poor results difficulty lies fact forcing term costate equation may nonsmooth assumptions tms quadrature scheme converge violated description discretized costate approximation beginning section 3 assumed tms used step iii black box without regard smoothness lack thereof j n c costate implementation analyzed involves discretization con tinuous costate equation using standard time marching schemes due simplicity approach desirable resulting gradient approximation order accuracy particular time marching scheme presented conditions guarantee conditions straightforward instance several popular second order time marching schemes yield second order gradient approximations provided uniform time mesh used combination second order accurate trapazoidal quadrature conditions less obvious cf theorem 6 also demonstrate certain reasonable implementations yield gradient approximations fail converge eg fourth order time marching uniform time mesh combined fourth order trapa zoidal quadrature finally several alternative though less simple costate implementations presented r computational issues parameter estimation feedback control problems partial differential equations methods identification material parameters distributed models flexible structures estimation techniques distributed parameter systems numerical schemes estimation functional parameters distributed models mixing mechanisms lake sea sediment cores splinebased technique computing riccati operator feedback controls regulator problems delay equations nonconvergence adjoint semigroups control systems delays de la nonlinearite dune equation parabolique quasi lineare numerical methods unconstrained optimization nonlinear equations difference methods initial value problems tr