accurate conjugate gradient methods families shifted systems consider solution linear system real values family shifted systems arises example tikhonov regularization computations lattice quantum chromodynamics single shift system solved using conjugate gradient method least squares problems cgls literature various implementations socalled multishift cgls methods proposed methods mathematically equivalent applying cgls method shifted system separately solve systems simultaneously require two matrixvector products one one two inner products per iteration step unfortunately numerical experiments show due roundoff errors cases implementations multishift cgls method attain accuracy depends square condition number matrix paper argue multishift cgls method impact attainable accuracy rounding errors lanczos part method independent effect roundoff errors made construction iterates making suitable design choices parts derive new efficient implementation tries remove limitation previous proposals partial roundoff error analysis various numerical experiments show promising results b introduction various scientific computations problem arises compute solutions various values matrix denotes identity matrix krylov subspace methods iterative solution methods solving linear systems methods zero initial guess characterized fact construct approximations step j socalled j dimensional krylov subspace defined k j b spanb ab j1 b important property krylov subspaces shift invariant k exploiting property equation 11 solved various values mathematical institute utrecht university po box 80010 nl3508 utrecht netherlands shift constructing basis krylov subspace observation led many ecient implementations known krylov subspace methods handle multiple shifts simultaneously refer interested reader information applications 4 6 11 9 17 10 22 8 21 multishift variants general require number matrixvector products inner products original method applied single system solution additional shifted system extra vector updates needed paper focus numerical solution system several real values 0 solution family systems plays important role tikhonov regularization 10 computation overlap operator simulations quantum chromodynamics 18 despite fact system sensitive eects using computer arithmetic since ill conditioned overwhelming numerical evidence accurate solutions shifted system obtained applying sucient number iterations cgls method variant cg method designed solving least squares problems unfortunately previously proposed implementations multishifttype solving 12 ie multishift cgls methods cases achieve final precision shifted systems depends square condition number matrix due roundo errors present paper demonstrate numerical example cf section 52 main goal paper derive new implementation tries overcome limitation use computer arithmetic aects standard cgls method two ways alters convergence properties method restricts accuracy method eventually achieved also case multishift versions cgls method paper mainly focus second aspect implementation tries improve previous proposals area ultimate attainable accuracy cgtype methods often investigated eg 14 3 considering residual gap defined dierence recursively computed approximation residual unknown true residual cgls method fairly straightforward multishift variants situation complicated order understand influence finite precision arithmetic attainable accuracy multishift cgls method discriminate rounding errors made construction basis krylov subspace ie lanczos part computation approximate solution vector krylov subspace inversion part subdivision lanczos inversion part immediately visible standard implementations cgls method also reflected analysis attainable accuracy inspection residual gap stress multishift context two parts necessarily independent priori clear even possible develop multishift versions cgls method able obtain approximations similar precisions direct application cgls method system separately paper propose implementation multishift cgls method making suitable design choices implementation lanczos part computation iterates shifted systems confidence success method given partial rounding error analysis important situations partially numerical experiments paper following structure section 2 review cg method variant least squares problems cgls discuss wellknown results attainable accuracy abstract formulation multishift cgls method given section 3 implementation lanczos part subject section 4 review important result paige finite precision behavior method alternative computing orthogonal basis krylov subspace propose use cgls recurrences section 5 deals influence rounding errors made alternative lanczos method attainable accuracy multishift cgls method topic section 6 accurate computation iterates shifted systems finally show several numerical experiments main ingredients chosen properly achieve high accuracy shifted systems conjugate gradient methods section review two variants conjugate gradient method paper hestenes stiefel 16 properties conjugate gradient method iterative solution method solving linear systems matrix symmetric positive definite method iterates x j corresponding residuals r computed using recurrence relations coecients given initially norms paper euclidean approximate solution follows using recurrence practice nonzero starting vectors sometimes used future convenience assume initial guess x 0 zero key characterization cg method iterates x j minimize error energy norm aweighted norm approximations jth krylov subspace k j b see eg 16 consequence residuals r orthogonal basis k j b another useful property fact r follows equation 52 16 positivity shows combination 22 following proposition summarize important result due greenbaum helps provide insight attainable accuracy standard conjugate gradient method proposition 21 greenbaum 14 dierence true residual bax k computed residual r k satisfies x unit roundo double precision computations order 10 16 c constant depends error matrixvector product quantity k dicult bound computer arithmetic however exact arithmetic immediately follows 23 k 1 argument bound quantity used 14 depends fact also exact arithmetic errors cg method euclidean norm monotonically decreasing 16 theorem 63 therefore 2 24 unfortunately argument proving reduction error euclidean norm 16 uses orthogonality residuals general lost finite precision computations however using relation cg method exact cg method applied larger matrix specific righthand side author argues 14 section 31 24 might also hold approximately finite precision context relevance proposition 21 explaining attainable precision conjugate gradient method depends experimental observation practical computations computed vector r k converges zero least stagnates norm many orders magnitude smaller machine precision assumptions therefore follows proposition 21 iterate x k essentially suciently large k implies following bound relative error least squares problems cg method directly applied normal equations nevertheless common practice use alternative mathematically equivalent variation cg known cgls case 16 section 10 method defined following recurrence relations c j1 z computed 22 advantage method compared applying cg directly normal equations least squares residuals z directly available furthermore shown 14 section 33 3 similar arguments used proof proposition 21 cg recurring residuals least squares problem z j improves attainable accuracy method future convenience state result 3 algorithm 1 cgls implementation solving 12 proposition 22 bjorck elfving strakos 3 dierence true least squares residual b ax k computed least squares residual z k satisfies x c constant depends error matrixvector product z bax apply result authors bound k accomplished similar heuristics used cg method assuming furthermore cgls method terminated point z k z dax authors conclude cgls method eventually expected achieve approximate solution good forward stable method solving least squares problem return detail section 52 damped least squares problem 12 equivalent least squares problem hence shifted system solved one shift applying cgls method augmented matrix righthand side however due special structure matrix righthand side computational work saved cgls method see example algorithm 6 10 convenience reader resulting algorithm summarized algorithm 1 3 abstract formulation multishift cgls method previous section reviewed celebrated conjugate gradient least squares method 16 exact arithmetic mathematical equivalent method obtained based lanczos method eg 12 chapter 9 applied matrix starting vector b method constructs orthonormal basis krylov subspace k k k iterations process summarized lanczos relation columns v 0 v k v k1 form orthonormal basis k k1 symmetric kk tridiagonal matrix k collects coecients computed execution lanczos algorithm often convenient include also k1 one tridiagonal matrix k adding additional row e vector e k denotes kth standard basis vector ie vector components one similarly 0 vector components zero dimension vectors apparent context approximation step k corresponding cg process equal vector r initial residual equations 31 32 together give us abstract formulation cgls method follows 31 lanczos relation shifted system reads k 33 shows lanczos relation known one system iterates cgls method damped least squares problem 28 directly computed relation fact equal multishift cgls method constructs orthonormal basis time computes 34 required values course without storing lanczos vectors since many mathematically equivalent ways compute lanczos vectors tridiagonal matrix k many ways compute vectors 34 number possible implementations countless two specific implementations presented 17 10 however discussed introduction obtainable precision computed iterates implementations limited propose new ecient implementation choosing suitable algorithm lanczos part computing iterates 34 discuss relationship previously proposed multishift cgtype methods implementation course paper 4 implementation lanczos part discussed previous section first key ingredient multishift cgls method construction orthonormal orthogonal basis krylov subspaces tridiagonal matrix containing orthogonalization coecients obvious choice apply standard lanczos method eg 12 algorithm 921 matrix starting vector b dicult see optimal choice context solving least squares problems give detailed arguments section 5 discuss impact rounding errors lanczos part attainable accuracy multishift cgls method well known coupled twoterm recurrences cg method used alternative application lanczos method constructing orthonormal basis krylov subspace see 7 1 numerical experiments papers showed alternative recurrences could cases considerably improve robustness methods similar spirit recurrences 26 used build orthonormal basis krylov subspace k j b section consider use cgls recurrences alternative lanczostype method refer cglslanczos method first little remark notational conventions r k denote n k matrix columns r 0 r k1 similarly capitals used group together corresponding vectors relations 26 summarized following matrix formulations k2 j k lower bidiagonal matrix 1 1 respectively diagonal subdiagonal substitution yields residual relation apart dierence scaling precisely lanczos relation given 31 obtain quantities lanczos method standard form using simple diagonal scaling k diagonal elements shows holds since j available cgls method recurrences 26 used alternative applying lanczos method starting vector b virtually cost 1 argued cgls recurrences used alternative standard lanczos method therefore iterates shifted systems computed using 34 quantities given 42 equivalent alternative avoids scaling 42 directly compute k defined upper k k block k given 41 1 notice vectors v j ie columns v k plus minus lanczos vectors standard lanczos method 41 perturbed lanczos relations computer arithmetic finite precision computations computed lanczos vectors v k tridiagonal matrix satisfy lanczos relation exactly standard lanczos method paige 19 proved instead computed quantities satisfy perturbed lanczos relation section give analogous result cglslanczos method need remainder paper assume standard rules floating point arithmetic machine precision see eg 12 section 242 b floating point numbers stands basic operation like addi tion subtraction multiplication division furthermore assume errors matrixvector product vector appropriate length respec tively bounded notation result paige certain implementation lanczos method applied matrix starting vector b summarized following proposition proposition 41 paige 19 lanczos method computer arithmetic results perturbed lanczos relation ignoring higher order terms turn attention cglslanczos alternative lanczos type method discussed previous section let f c j denote perturbation computation c j caused use computer arithmetic assume similar notation perturbations using standard model floating point arithmetic get cf 26 initialization computations assuming quantities step minus one length zero f z f r combining notation previous section find quantities computed cgls recurrences finite precision arithmetic satisfy perturbed relations given k r k finally straightforward sequence substitutions multiplications suitable matrices yields perturbed relation summarized following lemma lemma 41 cgls recurrences given 26 finite precision computations lead perturbed relation form k given 41 perturbation form upper bounds norms columns perturbations right given 4548 lemma explicitly provide bound norm perturbation proposition 41 standard lanczos method note norm perturbation much larger norm perturbation term standard lanczos method taking account dierence scaling explained fact p j r j become large typically occurs matrix small isolated eigenvalue however perturbation term lemma 41 interesting structure next section exploit special structure investigate attainable accuracy multishift cgls method based cglslanczos finally conclude section giving future use explicit expression iterate step k cgls method assuming roundo errors made 22 approximation given x cgls r k u first expression follows 22 fact j 1 5 impact errors lanczos part multishift cgls discuss eects rounding errors lanczos part attainable accuracy multishift cgls method first choice mentioned lanczos part application standard lanczos method applied matrix starting vector b good choice argued using line arguments given 3 section 42 explain failure lscg method main observation startup lanczos method computing b obtain first lanczos vector since vector b appear lanczos part follows multishift cgls method based standard lanczos method best computes solution shows nearly consistent case 0 forward error best much less optimal details argument consult 3 section 42 focus alternative lanczos procedure cglslanczos assume multishift iterates computed defined 41 moreover moment rounding errors considered computation vector ie x assumed computed exactly multishift cgls method iterates computed independently lanczos part consequence generate additional sources errors present cgls method impact attainable accuracy point warn reader unconventional notation apply matrix k columns vector k assume vector expanded zeros necessary operations equalities case k matrix assumed applied first k elements vector remaining elements assumed unchanged operation future convenience define note using relation relations given section 41 true residual corresponding normal equations written plug expression perturbation term given lemma 41 arrive main relation expression plays similar role section proposition 22 plays analysis attainable accuracy cgls method shows vector z k eventually approaches z therefore first term becomes small true residual corresponding 12 stagnates level determined three wvectors 51 precise assume terminate iteration step k ax 52 constant although rigorous proof condition eventually always achieved according 3 overwhelming experimental evidence justify assumption see also numerical experiments 3 attained forward error given multiplying expression true residual 51 left gives w 1 5 get similar expression least squares residual multiplying left notice special structure perturbation lemma 41 played important role derivation expression next section bound size wvectors important case notice already simple case multishift cgls based standard lanczos method fails section 52 combine obtained bounds 53 compare attainable accuracy cgls method multishift cgls method based cglslanczos method furthermore discuss situation general 51 bounding size wvectors bound size vectors w 1 w 3 case equal zero since expression first wvector rewritten therefore estimates 4548 lead following bounds wvectors w 2 bound quantities turns convenient use relation exact conjugate gradient process applied 1matrix righthand side b generates matrix k therefore coecients cgls process define 54 elements diagonal scaling k chosen k k upper block k symmetric symmetric matrix defined taking upper left block equal 1element arbitrary assume matrix positive definite requires computed coecients positive vector b equals interesting notice matrix advanced completions could chosen case higher dimension example greenbaum 13 shows matrix k completed eigenvalues tiny clusters around eigenvalues gives important insight finite precision convergence behavior conjugate gradient method purposes precise completion importance work simple k 1dimensional matrix dicult see exact conjugate gradient method applied matrix righthand side b indeed yields computed matrix k vectors hypothetical conjugate gradient process denoted nonbold characters contrast bold characters denoting computed vectors cglslanczos method example appended k 1 j additional zeros upper j j block following lemma gives useful relations lemma 51 proof let denote variables varies using standard model floating point arithmetic 43 follows second inequality use recursive application estimate leads 12 plugging expression 55 expression find 56 continue original goal bound w 1 k last inequality used 23 second quantity appears w 1 proposition 22 shows furthermore combining lemma 51 49 dicult see x cgls together get following upper bound w 1 order estimate size vector w 3 problem reduced bounding purpose following lemma use lemma 52 let j k proof first observe r j e first inequality follows 16 theorem 53 know p j r j r value j essentially norm minimal residual approximation corresponding approximation x mr j components first j elements vector thus second inequality 510 follows used r j x mr j fact errors cg method 2norm monotonically decreasing 16 theorem 63 notice obvious estimates e could used proof lemma would given crude bound k 12 similar estimate 913 23 cg method finite precision computations since contains term 1 would sucient purposes proof used fact large value r j canceled smaller 1th element vector x k combining expressions j k finally find w 3 52 attainable accuracy multishift cgls method using bounds wvectors expression true residual 51 position give discussion ultimate attainable accuracy multishift cgls method based cglslanczos method recall neglect moment rounding errors made computation x condition number least squares problem eg 2 section 143 written defined aa denotes pseudoinverse matrix given means x computed using normwise backward stable method forward error essentially bounded 512 provides us idea expect case 0 first term 53 bound contribution w 1 w 3 forward error define although exact arithmetic expression exceed one finite precision value unknown following assume quantity modest stress however quantity x j x proposition 21 argued bounded finite precision computations using similar assumptions using 58 511 fact bzax finally arrive following result theorem 51 assume 52 holds let accuracy multishift cgls approximation least squares residual notice forward error appears smaller upper bound error normwise backward stable method given 512 however remarked 3 number iterations k reach state might also depend conditioning matrix direct application cgls method follows 49 x cgls k therefore dierence attainable accuracy multishift cgls method direct application cgls method determined vector w 3 analysis clearly shows term expected form essential dierence addition shows residual gap cgls method influenced third wvector preceding restricted attention zero shift case generalization 0 straightforward want provide preliminary insight using cglslanczos method lanczos part multishift cgls method yields notice perturbation righthand side b size b leads forward error size therefore error multishift cgls method small might expected figure 1 plotted upper bounds quantities 53 two illconditioned test problems 15 general values purpose ran cglslanczos method 100 iterations computed upper bounds perturbation terms lemma 41 using estimates given 4548 evaluated using computed quantities cglslanczos method furthermore reference included two upper bounds error smaller upper figure 1 upper bounds function quantities w 1 b dotted left picture heat100 right picture ursell100 bound predicted condition number least squares problem damped least squares problem 28 picture shows behavior observed test problems small error dominated contribution w 1 large values contribution w 2 becomes dominant impact vector w 3 always relatively small upper bound contribution w 2 increases increasing reaches maximum value appears decay speed proportional coincides bound ai b numerical experience quantity never becomes much larger upper bound contribution w 1 unfortunately precise expressions bound quantities general 6 solution shifted systems second main component multishift cgls method computation approximate solutions x k using equivalent formulation given 34 start section summarizing approach used several places literature multishift versions bicg method based coupled twoterm recurrences also requires computation 61 see 17 8 details consult references important observation residuals shifted systems colinear cg type methods exist constants j r writing threeterm recurrence residuals r k similar 41 comparing terms reveals recurrences iterates search directions initially p r 0 x 0 scaling j leads version stability properties j1 63 stable method applied computing inverse 61 leads approximate solution usually suciently accurate dealing ordinary linear systems however might case normal equations since dependence attainable precision square condition number may introduced therefore point concern approach given 6263 implicitly forms illconditioned tridiagonal matrix k cf 41 computation 62 example failure algorithm multishift cgls context given end section 62 61 alternative implementation goal give alternative algorithm prevents formation illconditioned case cglslanczos method used lanczos part clear 42 also l dl factorization k directly available quotientdierence algorithms introduced rutishauser 20 provide means construct l dl factorization shifted matrix k directly factors k algorithms construct factors l stepbystep fashion diagonal diagonal elements l upper bidiagonal diagonal elements one upper diagonal elements l k2 take dierential form stationary qd transformation dstqds presented 5 algorithm 42 following recurrence relations computing elements factors l conjugate gradient method construction vector x accomplished eciently introducing auxiliary vectors p defined relation p starting simple scaling p denoting leads slightly ecient equally stable variant j1 64 lanczos part inversion part algorithm 2 multishift cgls implementation solving families form 12 j1 65 discussed two components implementation multishift cgls method consists combining 64 65 cgls recurrences 26 resulting algorithm summarized alg 2 comparing 65 63 reveals search directions j scalars coincide exact arithmetic recursions 64 seen reformulation equivalent recursion given 62 hopefully stable consequence furthermore norm residual shifted system normal equation equal r j section 52 addressed influence rounding errors lanczos part attainable accuracy multishift cgls method based cgls recurrences discuss second main source errors multishift method dierence x computed using 64 65 exact expression r k 5 section 43 dhillon parlett present roundo error analysis dstqds algorithm shows outcome algorithm relatively close outcome exact transformation applied factors relatively close original input also expected hold scaled recursions 64 alternatively stability also understood close inspection recursions 64 elements added sign therefore computed value relatively close exact value since cancellation reason expect influence rounding errors recursion j small hand threeterm recurrence 62 requires computation may sensitive roundo errors due cancellation case two quantities relatively close iteration relative error 2iteration relative error figure 2 relative error function k alg 1 solid algorithm 6 10 dashed multishift cgls based cglslanczos 65 dashdot 63 dotted two dierent shifts another issue impact roundo errors vector updates 65 impact errors analyzed detail using techniques section 51 define x k iterate computed exact conjugate gradient method applied matrix starting vector b defined section 51 show used essentially technique used bounding vector w 3 case hence expect rounding errors computation vector x significant influence attainable accuracy multishift cgls method 62 numerical comparison numerical experiments suggest multishift cgls method based cglslanczos method combined 6263 inversion part often remarkably accurate situations accurate alternative given alg 2 nevertheless examples dierences clear show two simple systems matrix eigenvalues 1250 240 241 250 n 12 orthonormal eigenvector basis random righthand side equal components eigenvector directions results solving system 12 presented figure 2 1 picture also presented results alg 1 reference methods case coupled recurrences 64 clearly gives accurate results threeterm recurrence larger values small values dierences become small implementation multishift cgls method presented 10 alg 6 uses variant standard lanczos method lanczos part implementation based threeterm recurrence least squares residuals results tridiagonal matrix standard form even changes lanczos part improving attainable accuracy method accuracy expected limited inversion tridiagonal since illconditioned tridiagonal given factorized form dashed lines figure confirm 7 numerical experiments section compare attainable accuracy cgls method damped least squares problems alg 1 attainable accuracy version multishift cgls method alg 2 exact solution x computed using singular value decomposition matrix report relative error given computed approximation either method number iterations k chosen error particular method minimal results various test problems 15 given table 1 alg 1 4913 5115 6616 6516 alg 2 4813 5215 6116 7016 alg 1 6714 2915 2916 2616 alg 2 8714 3315 2516 2716 alg 1 2213 3015 3716 6716 alg 2 2713 3015 3716 7316 alg 1 9213 1814 1215 6716 alg table 1 attained relative errors various problems various choices results table confirm proposed implementation multishift cgls method achieves comparable accuracy applying cgls method directly regularized system however interesting dierences methods occur apparent table one property alg 1 large shifts method appears tendency diverge reaching maximal precision interesting observation multishift version cgls behavior illustrated left figure figure 3 computational costs per step much lower multishift version cgls matrixvector multiplication inner products less vector updates solving shifted problems direct application cgls however remarkable addition multishift version sometimes needs less iteration steps example given right picture figure 3 iteration relative error 1iteration relative error figure 3 relative error function k alg 1 solid alg 2 dashdot left problem foxgood100 8 summary outlook paper proposed new implementation multishift cgls method solving families damped least squares problems work motivated observation cases previous proposals attain precision depends square condition number first key ingredient implementation use coupled recurrences construction orthogonal basis krylov subspace showed leads perturbed lanczostype relation perturbation desirable structure size perturbation relatively large compared perturbation term standard lanczos process nevertheless using extensive rounding error analysis exploits special structure perturbation term showed alternative lanczos method desirable multishift cgls methods second advantage use cgls recurrences lanczos part fact tridiagonal matrix available factorized form important information second key ingredient construction iterates shifted systems showed exploiting factorized form tridiagonal using stationary qd transformation 5 algorithm 42 iterates accurately eciently constructed future work plan extend analysis lanczos part situation general also general theoretically confirm suitability cglslanczos method lanczos part another interesting extension paper consider implementation multishift cgls method based lanczos bidiagonalization eg 12 section 933 furthermore believe analysis provides key ingredients analyzing advantages coupled twoterm recurrence lanczos qmr method experimentally shown 7 qmr method also clear separation lanczos inversion part multishift cgls method could also help analyze advantages alternative lanczos methods applications eg 1 acknowledgment research j van den eshof financially supported dutch scientific organization nwo project 613002035 thankful two referees remarks helped us improve presentation paper r symmetric band lanczos process based coupled recurrences applications arnoldi methods large sylvesterlike observer matrix equa tions solution shifted linear systems quasiminimal residual iterations implementation qmr method based coupled twoterm recurrences bicgstabl families shifted linear systems restarted gmres shifted linear systems fast cgbased methods tikhonovphillips regularization many masses one stroke economic computation quark matrix computations behavior slightly perturbed lanczos conjugategradient recur rences matlab package analysis solution discrete illposed problems methods conjugate gradients solving linear systems krylov space solvers shifted linear systems numerical challenges lattice quantum chro modynamics berlin analysis lanczos algorithm tridiagonalizing symmetric matrix der quotientendierenzenalgorithmus restarted full orthogonalization method shifted linear systems numerical solution error estimation conjugate gradient method works finite precision computations tr implementation qmr method based coupled twoterm recurrences matrix computations 3rd ed estimating attainable accuracy recursively computed residual methods restarted gmres shifted linear systems stability conjugate gradient lanczos methods linear least squares problems fast cgbased methods tikhonovphillips regularization symmetric band lanczos process based coupled recurrences applications numerical solution lambda2 application structural dynamics