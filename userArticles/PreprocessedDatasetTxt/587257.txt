residual replacement strategies krylov subspace iterative methods convergence true residuals paper strategy proposed alternative computations residual vectors krylov subspace methods improves agreement computed residuals true residuals level ou x building earlier ideas residual replacement insights finite precision behavior krylov subspace methods computable error bounds derived iterations involve occasionally replacing computed residuals true residuals used monitor deviation two residuals hence select residual replacement steps recurrence relations computed residuals control convergence method perturbed within safe bounds numerical examples presented demonstrate effectiveness new residual replacement scheme b introduction krylov subspace iterative methods solving large linear system typically consist iterations recursively update approximate solutions x n corresponding residual vectors written general form follows algorithm 1 template krylov subspace method input initial approximation x convergence generate correction vector q n method vector x n occur statements end department mathematics utrecht university po box 80010 nl3508 utrecht netherlands email vorstmathuunl department mathematics university manitoba winnipeg manitoba canada r3t 2n2 email yegaussamathumanitobaca research supported grants university manitoba research development fund natural sciences engineering research council canada krylov subspace iterative methods including conjugate gradient method cg 12 biconjugate gradient method bicg 4 13 cgs 19 bicgstab 22 fit framework see 2 11 16 methods exact arithmetic recursively defined r n algorithm 1 exactly residual approximate solution x floating point arithmetic however roundoff patterns x n r n different important note error made computation x n reflected corresponding error r n words computational errors x n force method correct since x n influence iteration process leads well known situation b gamma ax n r n may differ significantly phenomenon extensively discussed literature see 10 11 18 references cited indeed denote computed results x respectively still use q n denote computed update vector algorithm f lz denotes computed result z finite arithmetic absolute value inequalities vectors componentwise u machine roundoff unit vectors n rounding error terms bounded straightforward error analysis see section 3 details particular relations 1 2 show n j n depend iteration vectors r n q n call b gamma ax n true residual approximation x n call r n obtained recurrence formula 2 computed residual updated residual difference two satisfies using finite precision recurrences 1 2 assume b gamma ax hence difference true updated residuals result accumulated rounding errors particular significant deviation r n may expected r large norm iteration uncommon situation bicg cgs hand even j small common cg takes relatively large number iterations convergence sheer accumulation j could also lead nontrivial deviation makes important finite precision implementation sequence r n satisfies almost machine precision u defining recurrence relation observed many krylov subspace methods driving force behind convergence r n 10 15 18 20 indeed residual bounds obtained 20 cg bicg show even significantly perturbed recurrence relation perturbations much larger machine precision usually still leads eventual convergence computed residuals theoretical insight motivation justification residual replacement scheme presented section 21 hand true residual b gamma ax n selfcorrecting mechanism convergence mainly perturbation made x n effect iteration parameters whereas errors immediately lead iteration parameters thus typical convergent iteration process r n converges level much smaller u eventually true residual b gamma ax n converge level dictated sigma n since usually r n still bigger accumulated error sigma n agrees well r n magnitude r n converged level smaller accumulated error accumulated error agreement r n summary straightforward implementation would reduce true residuals best bound obtained 10 called attainable accuracy note term could significant even one j large n large problems become serious methods cgs bicg intermediate x n r n large norm may result large n j n several popular methods bicgstab 22 bicgstab 17 qmr 7 tfqmr 5 composite step bicg 1 developed reduce norm r n see 6 details note controlling size kr n k solve deviation problem situations instance accumulation tiny errors long iteration may still result nontrivial deviation simple approach solving deviation problem replace computed residuals true residuals iteration step restore agreement deviation subsequent steps error accumulation iteration includes complete replacement strategy simply computes r n b gamma ax n every iteration periodic replacement strategy updates r n b gamma ax n intervals iteration count strategy maintains agreement two kinds residuals turns convergence r n may deteriorate see may result unacceptably large perturbations lanczos recurrence relation residual vectors steers convergence see section 23 recently sleijpen van der vorst 18 motivated suggestions made neumaier see 11 18 introduced sophisticated replacement scheme includes socalled flyingrestart procedure demonstrated new residual replacement strategy effective sense improve convergence true residuals several orders magnitude practical implementations strategy useful leads meaningful residuals important stopping iteration process right point course one could termination classical process simply test true residual risk true residual stagnated already long termination much work done vain present paper follow idea replacing computed residual true residual selected steps order maintain close agreement two residuals propose simpler strategy replacement done necessary phases iteration harmless convergence mechanism r n destroyed specifically shall present rigorous error analysis iterations residual replacement propose computable bounds deviation computed true residuals used select replacement phases iteration way lanczos recurrence among r n sufficiently well maintained resulting strategy shown provided computed residuals converge true residual converge level oukakkxk smallest level one expect approximation paper organized follows section 2 develop refined residual replacement strategy discuss strategies reported others give error analysis section 3 derive bounds deviation used replacement condition present complete implementation section 4 turns residual replacement strategy easily incorporated existing codes numerical examples reported section 5 finish remarks section 6 vector norm used paper one 1 2 1norm residual replacement strategy section develop replacement strategy maintains convergence true residuals formal analysis postponed next section specific iterative method fit general framework algorithm 1 throughout paper shall consider iteration processes computed residual r n converges sufficiently small level mentioned section 1 follow basic idea replace computed residual r true residual f selected steps refer iteration step one residual replacement occurs hence residual generated arbitrary step n could either usual updated residual r true residual depending whether replacement taken place step n order distinguish two possible formulations denote r n residual obtained step n process replacement strategy residual replacement step residual deviation immediately reduced shown see lemma 1 section 22 subsequent iterations n next replacement step clearly therefore accumulated deviation step effect deviation updating n however order strategy succeed two conditions must met namely ffl computed residual r n preserve convergence mechanism original process steered ffl last updating step termination step k accumulated error sigma k small relative ujr upperbound j j discuss next two subsections satisfy two objectives 21 maintaining convergence computed residuals order r n maintains convergence mechanism original updated residuals preserve property gives rise convergence original r n therefore need identify properties lead convergence iterative method finite precision arithmetic may different individual method observed several krylov subspace methods including cg 10 20 bicg 20 cgs bicgstab bicgstab 18 recurrence r similar one q n satisfied almost machine precision small local error one properties behind convergence computed residuals furthermore analysis 20 suggests convergence well maintained even recurrence equations perturbed perturbations significantly greater machine precision latter property basis residual replacement strategy therefore briefly discuss perturbation phenomenon bicg cg presented 20 consider bicg iteration contains r finite denote computed results r n p n respectively satisfy perturbed recurrence rounding error terms bounded terms u combining two equations obtain following perturbed matrix equation normalized form r n1 n invertible tridiagonal matrix 1 ff 0 ff note 4 equation satisfied exact bicg iteration perturbation f n particular detailed bounds n j n mild assumptions lead f n ou main result 20 states sequence r n satisfies 4 z n1 full rank n case f reduces known theoretical bound exact bicg residuals 1 therefore even r n exact counterpart completely different norms bounded similar quantities usually comparable course cases bounds depend quality constructed basis importantly closer examination bound reveals even perturbation f n magnitude much larger u quantities bound thus kr n1 k may significantly affected indeed 20 numerical experiments presented relatively large artificial random perturbations injected recurrence r n yet significantly affect convergence mechanism implication analysis regardless r n generated long satisfies 4 norm bounded 6 hence replace r n r assume breakdowns iteration process occurred large relative kr n k kr see 5 may still expect converge similar fashion indeed criterion explains residual replacement strategies like r work always see section 23 used determine safe replace r n r note discussion bicg phenomenon reveals seems valid many methods especially methods based bicg cgs bicgstab others consider case residual replacement carried step r follows definition ffi r updated residual r satisfies thus depending magnitude kj 0 k relative kr k kr mgamma1 k use r may result large perturbations recurrence relation therefore residual replacement strategy ensure replacement done kj 0 kg large typical iteration iteration proceeds kffi n k hence kj 0 increases kr n k decreases replacement reduce ffi n order maintain recurrence relation carried kj 0 becomes large relative kr n k reason propose set threshold ffl carry replacement kj 0 reaches threshold precise replace residual step n r note principle residual replacement carried steps reaches certain point however stability point view preferred generate residual recurrence much possible since kj 0 n k generally bigger recurrence rounding error kj n k order u 22 groupwise solution updating reduce error accumulations discussions section 21 learn residual replacement carried certain point subsection discuss maintain last replacement deviation order ujajjx n j case x n backward stable solution note x n ukakkx n k lowest value one expect residual simply even exact solution x last updating step menas final phase iteration process 3 deviation step n updating condition kr n k kj 0 chosen close u kr n k small discuss three different parts ffi n discussion motivate groupwise updating strategy rigorous analysis given next section sigma n ffl part j mukakkxk large accumulation errors steps significant note type error accumulation evaluating sum small numbers direct recursive additions fortunately corrected appropriately grouping arithmetic operations terms similar order magnitude group delta way rounding errors associated large number additions inside group magnitude us much smaller us technique adopted computing x n specifically recurrence x n carried following equivalent form groupwise solution update convergence end groupwise update scheme suggested neumaier worked sleijpen van der vorst see 18 references error local recurrence reduced indeed instead ujx j hence sigma n summary groupwise updating approximated solution three parts ffi n maintained level ujajjxj mention groupwise updating also used obtain better performance code modern architectures allows level3 blas operations suggested 21 page 52 note 5 23 residual replacement strategies briefly comment residual replacement strategies naive strategy replacing always residuals computed always bgammaax n periodic replacement update periodically every steps replacement carried throughout iteration even kr n k small know may result large perturbations recurrence equations relative kr n k since jj 0 j least j n j ujajjx n j see 7 case kr n k decreases recurrence relation may perturbed much hence convergence property deteriorates typical behaviour observed implementations note n made decrease kr n k replacement carried later stages iterations leads strategy flyingrestart sleijpen van der vorst 18 significantly reduces n hence j 0 n replacement step flyingrestart strategy b replaced f residual replacement steps say addition residual replacement r advantage flyingrestart step n i1 residual updated r n i1 noting b r n decreases r n decrease term determines perturbation recurrence kept small relative r n however deviation satisfies assuming x n i1 namely deviation flyingrestart step carries forward later steps therefore flyingrestart used carefully selected steps however easy identify condition monitor also necessary two different conditions residual replacement flyingrestart fortunately discussion last two subsections shows carrying replacement carefully selected steps combination groupwise update usually sufficient shall pursue flyingrestart idea paper analysis residual replacement scheme section formally analyze residual replacement strategy developed section 21 presented algorithm 2 particular develop computable bound kffi n k n k used implementation residual replacement condition first summarize residual replacement strategy following algorithm written form identifies relevant rounding errors later theoretical analysis algorithm 2 iterative method residual replacement given initial approximation floating point vector set convergence generate correction vector q n method residual replacement condition 8 holds else denote compute x end note x n ffi n theoretical quantities defined formulas computed vectors due finite precision arithmetic step n iterative method q n computed finite precision arithmetic algorithm however rounding errors involved computation q n irrelevant deviation two residuals solely depends different treatment q n recurrences r n x n throughout paper assume floating point matrix error analysis based following standard model roundoff errors basic matrix computations 8 p66 inequalities componentwise floating point vectors n constant associated matrixvector multiplication instance maximal number nonzero entries per row easy show using following lemma includes 1 2 obtained lemma 1 error terms computed recurrence algorithm 2 bounded follows step residual replacement carried proof 9 j n j ujx leads bound j n j residual replacement step updated z x n definition x therefore bounds j n n follow similarly number step residual replacement carried let later step still next replacement step proof first bound follows directly lemma 1 q noting similarly consider deviation two residuals number iteration step residual replacement carried let n denote later iteration step still next replacement step proof step definition xm algorithm 2 z z updated zvector therefore hence range n next residual replacement step lemma 2 obtain following computable bound ffi n lemma number iteration step residual replacement carried let n denote later iteration step still next replacement step proof bound kffi k follows see 14 lemma 2 lemma 3 follows leads bound ffi n terms norms note possible obtain sharper bound accumulating vectors bound jffi n j experiments show significant advantage approach next consider perturbation recurrence theorem 1 consider step n iteration let n last step n residual replacement carried replacement also done step n let x 0 computed approximate solution r 0 residual residual r 0 n satisfies following approximate recurrence proof first notation alg 2 x 0 used b gamma ax furthermore lemma 3 also kai combining three using r 0 ou bound kj 0 n k obtained lemma 4 note bound 16 computable iteration step therefore implement residual replacement criterion 8 bound instead kj 0 k note factor 2 bound comes bound q lemma 2 pessimistic since q x therefore use following n estimate kj 0 hence shall use following residual replacement criterion residual replacement done strategy replaced residual vector r n satisfies recurrence equation 15 k property consider situations r n converges discuss convergence true residual theorem 2 consider algorithm 2 residual replacement criterion 18 assume algorithm terminates step number last residual replacement iteration step termination proof 17 dk k furthermore termination step kr last updating step n n fflkr n k otherwise would another residual replacement implies kr upper bound kffi n k lemma 4 implies thus bound follows add two remarks respect theorem remark 1 main condition 19 satisfied deviation hence true residual remain level unkakkxk k termination approximate solution backward stable best one expect condition suggests ffl chosen small otherwise replacement strategy terminated early accumulation last replacement might become significant expected however theoretical condition restrictive practically necessary numerical experience suggests ffl much smaller 19 dictates without destroying conclusion theorem remark 2 hand section 21 seen ffl controls perturbations recurrence r n reason desirable choose small possible experience large range ffl around p u balances two needs reliable implementation iterative methods section summarize main results previous sections complete implemen tation also address implementation issues easy see definition n see 17 increases except residual replacement steps reset unkakkxm k residual replacement strategy reduce n whenever necessary determined replacement criterion keep level unkakkxk k termination use criterion 18 however situations residual replacement carried consecutive steps n remains virtually unchanged namely kr n k stays around n ffl unkakkx n kffl stability point view preferred replace residuals situations avoid unnecessary replacement cases impose additional condition residual replacement carried n nontrivial increase dm previous replacement step therefore propose n 11d condition addition 18 residual replacement following scheme sketches complete implementation algorithm 3 reliable implementation algorithm 1 input initial approximation residual replacement threshold ffl estimate nkak convergence generate correction vector q n iterative method end remark reliable implementation need estimates n maximal number nonzero entries per row kak experience sparse matrices simple choice still leads practical estimate n kffi n k case note precise estimates essential replacement threshold ffl adjusted also need choose ffl extensive numerical testing see section 5 suggests ffl p u practical criterion however examples choice leads stagnating residuals unacceptable level cases choosing smaller ffl regain convergence ou presented implementation requires one extra matrixvector multiplication replacement carried since steps replacement required extra cost marginal relative costs however savings made selecting slightly smaller ffl carrying residual replacement step next one residual replacement criterion satisfied cf 18 also requires one extra vector storage groupwise solution update z computation vector norm kx n k update n kr n k usually computed algorithm stopping criteria 5 numerical examples section present numerical examples show algorithm 3 works demonstrate effectiveness present testing results cg bicg cgs tests carried matlab sun sparc20 workstation examples unless otherwise specified replacement threshold ffl chosen 10 gamma8 kak1 explicitly computed n set 1 examples 1 2 also compare n deviation kffi n k example 1 matrix finitedifference discretization 64 theta 64 grid homogeneous dirichlet boundary condition ax apply cg reliable cg ie alg 3 solve linear system convergence results given figure 1 figure similarly figures 2 3 next example give convergence history normalized computed residual cg solid line normalized true residuals cg dashed line reliable cg dotted line b also give normalized deviations two residuals kffi dashdotted line reliable cg dotted line bound n reliable cg xmark example 2 matrix finitedifference discretization 64 theta 64 grid following convection diffusion equation homogeneous dirichlet boundary condition function f constant consider bi cg cgs solving linear systems results shown figure 2 bicg figure 3 cgs examples observed following typical convergence behaviour original implementations deviation increases finally stagnates level exactly true residual stagnates computed residual continues converge reliable implementations deviation increases certain level relative r n residual replacement carried reduces error level eventually deviation hence true residual arrive level ukakkxk also note bound n captures behaviour kffi n k closely although may overestimate ffi n orders magnitude three cases final residual norms reliable implementation smaller ones obtained matlab function anb example 3 case tested algorithm bicg cg symmetric definite cgs harwellboeing collection sparse matrices 3 compare original imple mentations reliable implementations implementations sleijpen van der vorst 18 based replacement criteria 16 18 table 1 give results matrices computed residuals converge level smaller ukakkxk deviation two residuals cases b given choose figure 1 example 1 cg solid computed residual cg dashed true residual cg dotted true residual reliable cg b dashdotted cg dotted nk reliable cg x dn reliable cg convergence history iteration number normalized residual norm b residual deviation bound iteration number deviation given random vector solution note matrices may take 10n iterations achieve practical however included results order show even excessive numbers iterations still arrive small true residuals eventually list normalized residuals res attained three implementations gaussian elimination partial pivoting matlab anb also list number residual replacements n r reliable implementations number flyingrestart n f number residual replacements n r implementations sleijpen van der vorst svdv two cases computed residuals converge oukbk choice 8 cases slightly smaller ffl recover stability results listed last row table see cases reliable implementation reduces normalized residual ou res2 smallest among three implementations even smaller matlab anb improvement true residual apparent cgs bicg cg except cases reliable implementation presented implementation sleijpen van der vorst work well comparable main advantage new approach simplicity occasional improvement accuracy figure 2 example 2 bicg solid computed residual bicg dashed true residual bi cg dotted true residual reliable bicg b dashed bicg dotted reliable bicg x dn reliable bicg convergence history iteration number normalized residual norm b residual deviation bound iteration number deviation 6 concluding remarks presented new residual replacement scheme improving convergence true residuals finite precision implementations krylog subspace iterative methods carefully monitoring deviation computed residual true residual incorporating earlier ideas residual replacement obtain reliable implementation preserves convergence mechanism computed residuals well sufficiently small deviations error analysis shows approach works certain conditions numerical tests demonstrate effectiveness comparison earlier approach shows new scheme simpler easier implement addon existing implementations iterative methods point basis present work understanding convergence behaviour computed residuals finite precision arithmetic preserved small perturbations recurrence relations supporting analysis available bicg cg still empirical observation krylov subspace methods would interesting derive theoretical analysis confirming phenomenon methods well acknowledgements would like thank ms lorrita mcknight assistance carrying tests harwellboeing matrices figure 3 example 2 cgs solid computed residual cgs dashed true residual cgs dotted true residual reliable cgs b dashed cgs dotted nk reliable cgs x dn reliable cgs convergence history iteration number normalized residual norm b residual deviation bound iteration number deviation r analysis composite step biconjugate gradient algorithm solving nonsymmetric systems templates solution linear systems building blocks iterative methods sparse matrix test problems conjugate gradient methods indefinite systems transposefree quasiminimal residual algorithm nonhermitian linear systems siam j iterative solutions linear systems acta numerica matrix computations behavior slightly perturbed lanczos conjugategradient recurrences estimating attainable accuracy recursively computed residual methods methods conjugate gradients solving linear systems solution systems linear equations minimized iterations convergence rate conjugate gradients presence rounding errors accuracy effectiveness lanczos algorithm symmetric eigenproblem iterative methods sparse linear systems pws publishing bicgstabl linear equations involving unsymmetric matrices complex spectrum electronic trans reliable updated residuals hybrid bicg methods computing volume56volumepages144163pages year1996year analysis finite precision biconjugate gradient algorithm nonsymmetric linear systems performance fortran implementations preconditioned conjugate gradients vector computers tr ctr stefan rllin martin h gutknecht variations zhangs lanczostype product method applied numerical mathematics v41 n1 p119133 april 2002