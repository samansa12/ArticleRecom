new multivariate product density estimators let x rdvalued random variable unknown density f let x1 xn iid random variables drawn f objective estimate fx study pointwise convergence two new density estimates hilbert product kernel estimate dn i1nj1d12log nxjxij hilbert knearest neighbor estimate kd12dnlogd1nkd1 j1dxjxkj xk kth nearest neighbor x points ordered increasing values product j1d xjxkj auxiliary results needed permit us formulate universal consistency results pointwise l1 product kernel estimates different window widths coordinate rectangular partitioning tree estimates particular show locally adapted smoothing factors product kernel estimates may make kernel estimate inconsistent even standard conditions bandwidths b introduction objective note study two new multivariate density estimates avoid messy problem smoothing factor selection one case least invariant ane transformations coordinates provide easy means jointly estimate 2 marginal densities density f ir byproduct able study universal consistency product kernel estimates rectangular partition estimates independent observations ir valued random vector x unknown density f classical kernel estimate f h 0 smoothing factor depending upon n k absolutely integrable function kernel k h 1956 observe kernel smoothing factor h canceled obtain one may wonder happens situation smoothing factor absent problem dealt devroye krzy zak 1998 showed following theorem 1 hilbert estimate fn x v n log n v volume unit ball ir weakly consistent almost x probability almost x use name hilbert estimate related hilbert integral similar ker nel hilbert estimate invariant ane transformations coordinates transparent notation fn x denotes density estimate x ir given data ir bay denotes sample size n ith coordinate observation transformed kernel density estimation invariance may obtained one uses product kernels however causes additional problems component kernel requires smoothing factor apply principle hilbert estimate obtain product hilbert estimate log nx x ji estimate smoothing factor invariance mentioned follows readily however weak pointwise consistency hold ir 1 densities counterexamples provided fact product kernel estimate positive smoothing parameters known h h h 0 nh fn f probability almost x k bounded compact support density devroye gyorfi 1985 r f almost surely k r however less known allow individual smoothing factors tend zero dierent rates allowed depend upon x universality lost natural conditions h would seem lim lim within conditions k uniform density 1 1 exist densities f almost everywhere probability turns sucient condition f almost everywhere pointwise convergence r f log d1 f proof counterexamples follow section 3 paper explores sucient conditions various types convergence estimates discusses context jessenmarcienkiewiczzygmund condition consistency proved multivariate hilbert product estimate product nearest neighbor estimate hasa nearest neighbor ranking invariant scaling axes desirable feature highdimensional data collection ordinary product kernel estimate finally treebased rectangular partitioning estimates 2 sums products inverse uniforms product iid uniform 0 1 random variables density given log d1 1z 1 let z 1 zn iid distributed z lemma s1n log n probability proof result follows theorem 2 rogozin 1971 theorem 881 bingham goldie teugels 1987 stability sums iid random variables function f snan 1 probability r x slowly varying function chosen la n n 1n take r x log xd take log xd nlog nd indeed nlog ndd n log 3 saks rarity theorem implications understand reasons defining conditions f helps understand reasons go back theory dierentiation de guzman 1981 good reference consider function f ir together collection b bounded measurable sets property every x ir exists sequence b diameters written diam decreasing zero x collection called basis collection sets b containing x denoted bx define upper lower derivatives f respectively de guzman 1981 p 105 say dierentiates f f almost everywhere x example known b collection balls hypercubes dierentiates integrable functions f form celebrated lebesgue density theorem basis pointwise convergence properties kernel estimates indeed density estimates let b 2 denote interval basis collection products finite intervals containing least two points collection bounded rectangles positive measure aligned axes require following result lemma a1 jessenmarcinkiewiczzygmund theorem 1935 b 2 dierentiates l1log functions f ir includes densities f indeed exceptions good account chapter 7 de guzman 1981 p 167 first according saks rarity theorem saks 1935 exists nonnegative function f ir 2 f almost everywhere x respect b 2 later marstrand 1977 found f property works orientations axes orientation axes dierent collection b 2 el helou 1978 found f latter property addition z f log 1 0 1 thus respect b 2 logarithmic condition f nearly necessary consider standard kernel estimate ir 2 product kernel 4 x1 1 x2 1 dierent smoothing factors coordinate form x1 x j1 h1 x2 x j2 h2 easy see result mentioned exists density f 0a1 l1 almost x exist h efn x note results imply h 1 h 2 allowed depend upon x variance fn oefn xnh 1 h 2 easy see nh 1 h 2 fn xefn x 1 probability almost x thus fn x probability almost x therefore one adapts smoothing factors x true longer kernel estimates pointwise consistent densities turn finally basis b 3 rectangles ir 2 rotated respect possible orientations situation extremely volatile de guzman 1981 p 224 b 3 even dierentiate characteristic functions bounded measurable sets counterexamples dierentiability fails include densities bounded measurable set area 1c specially selected subset nikodym set n 0 1 2 n measure one x n exists line lx x lx x take f implication exist inconsistent kernel estimates rotation kind almost every x exist smoothing factors standard conditions smoothing orthonormal rotation matrices x kernel estimate kan xx x j almost x 4 x1 1 x2 1 thus adaptation x allowing adaptive rotations makes kernel estimates potentially inconsistent even bounded densities compact support remainder paper rectangle set b 2 b 3 4 weak pointwise consistency multivariate hilbert product kernel estimate section prove main consistency theorem theorem 2 assume f density r f log d1 1f r g log s1 marginal densities g denotes dimension domain g multivariate hilbert product kernel estimate weakly pointwise consistent almost everywhere almost x probability proof let denote space diagonal matrices diagonal elements 1 1 clearly vectors ir fixed x ir define flipped density x means x observe particular f f bona fide density support positive quadrant origin x jessenmarcinkiewiczzygmund theorem lemma a1 b 2 denotes interval basis ir almost x lim implies almost x lim x z dz x x x denotes rectangle q see note following let b form x diamb 0 varying x mm z mb x dz little excursion allows us study behavior f x instead f interestingly see flipping applied estimator fn leaves fn unaltered thus show fn f almost x equivalent showing fn x f x x2 almost x remainder proof requires introduction marginal densities fs f xs thus fs marginal density f respect components whose index similarly f xs marginal density f x respect components whose index call x jmz point jessen marcinkiewicz zygmund lim xs sdimensional vector composed components x whose index b collection rectangles sdimensional space lemma a1 almost points jmz points fix x remainder proof 0 thus find 0 simultaneously ys xs r xs ys xs z dz xs xs also recall f xs lemma b1 let jmz point f fx 0 let let random vector density f let 1 nonempty set indices let event x conditional exist iid uniform 0 1 random variables u denotes stochastic domination proof assume without loss generality f x f instead f xs conditional x density f p note 0 furthermore f multivariate distribution function conditional x x jmz point therefore wellknown f x 1 seen applying probability integral transform conditional distribution function conditional decomposition f see return proof theorem remain defined earlier enlarge data considering infinite iid sequence 1 2 distributed x let collection indices ji ji x point let let collection first n indices j lemma b1 u 1 u lemma b1 lemma s1 righthandside probability asymptotic thus contribution j j asymptotically negligible assume first f taking longer aord artificially increase data size thus let j n j note binomial n p independence u lemma b1 easy see righthandside probability asymptotic np x x log similar weak lower bound obtained letting 0 obtain sought result contribution terms density estimate log n seen last chain inequalities well size less thus proof theorem 2 complete 5 lack strong convergence f true almost x fx 0 hilbert product kernel estimates cannot possibly converge f strong sense rather prove fullblown universal theorem restrict uniform density real line recall following result devroye krzy zak 1998 applicable hilbert product kernel estimate coincides standard hilbert kernel estimate theorem 3 let f uniform density 0 1 x 0 1 pfn x log log n strong convergence point support poor rate convergence estimate best seen considering points outside support f x least distance away support f fn x cs log n constant c depending upon k 6 product nearest neighbor estimate knearest neighbor density estimate fix hodges 1951 loftsgaarden que senberry 1965 x kx kth nearest neighbor x among properties wellunderstood moore yackel 1977 devroye wagner 1977 mack 1980 bhattacharya mack 1987 mack rosenblatt 1979 example almost x g kn x fx n k knearest neighbor density scaleinvariant relative order distances coordinates linearly scaled remedy introduce product knearest neighbor density estimate log d1 nkd 12 permutation x 1 x according increasing values permutation invariant linear transformations coordinate axes rotations interestingly product estimate considered except trivial case obtain standard univariate kth nearest neighbor estimate choice scale perpetual cause concern estimation product kth nearest neighbor estimate particularly useful prove weak consistency theorem 4 k k k log n 0 r f log d1 f 1 r g log d1 g lowerdimensional marginals f almost x jmz points f lowerdimensional marginals f g kn x fx probability proof theorem 4 sketch rough outline mimicking proof theorem 2 note first may wish consider flipped density x 2 fy x coordinates least equal x consider small square size coordinate bottom lower vertex x show kth nearest neighbor x probability tending one square indeed 1 density f x jmz point q approximately distributed u iid uniform 0 1 random variables f u density log d1 1zd 1 z 0 distribution function z log d1 1zd 1 z 0 see order statistics sample size n drawn q approximately distributed f inv 1nf x f inv 2nf x forth f inv inverse distribution function good approximation f inv u ud 1log d1 1ud 1 thus kth nearest neighbor value concentrated probability 1kn concentration follows k need show probability kth nearest neighbor square tends one end show nearest neighbor among points coordinates outside square coordinates square distance always measured q asymptotically much larger without loss generality fix first 1 coordinates x also jmz point marginal density last coordinates given first coordinates outside square remaining ones inside assuming small enough nearest neighbor distance asymptotically order 1n log dm1 n thus improbable kth nearest neighbor point coordinate outside small square concludes sketch proof 7 product kernel estimates section consider product kernel estimates defined univariate kernels r k 1 smoothing factors h ni deterministic sequences product kernel estimates interest oer scale invariance h ni proportional scale eg make h ni proportional weighted sum n may introduce big dierences h ni fact dierences may desirable situations like one let f product two univariate densities smooth one jagged one density one may want pick dierent smoothing factors even dierent orders kernel cases h n1 h n2 may tend zero dierent rates density locally product density resembles uniform density really important consider product kernels individually picked smoothing parameters interesting literature oers little help respect universal consistency properties estimates respect pointwise l 1 convergence natural conditions h ni would appear lim lim section prove two basic consistency results able find vast literature theorem 5 let fn product kernel estimate let component kernel k absolutely integrable natural conditions 1 2 lim f theorem 6 let fn product kernel estimate let kernels k bounded compact support riemann approximable l sense k closure space functions finite weighted sums indicators finite intervals natural conditions 1 2 lim almost x provided r f log d1 1 note conditions kernels satisfied kernels k continuous bounded compact support bit eort extend theorem 6 include kernels k k o1x x perhaps easiest proof theorem 5 transparent one uses embedding device devroye 1985 embedding used handle l 1 consistency variable kernel estimates may summarized following lemma lemma b2 let f g two densities ir let density estimate based iid samples size n drawn f assume sup constant c g n density estimate based upon iid sample size n drawn g proof consider uniform poisson point process ir 0 2 let u v typical point process keep points v fu v gu almost surely finite number points poisson 2t distribution may order points according increasing values obtaining u 1 first n values u j yn first n values u j v j gu j throw away poisson point process needed couple two samples interestingly x 1 iid drawn f 1 yn iid drawn g also every r maxf g dx r maxf g one triples u generates common point samples thus number common points stochastically greater binomial n p random variable number points one sample seen sample binomial n 1 p random variable expected value exceed n1 may assume fn gn based coupled x j j samples respectively r f n gn cnn n applying triangle inequality n n times proof theorem 5 first verify lemma b2 applies kernel estimate kernel k indeed n z z n lemma b2 applies kernels k nonnegative simply 2 lemma 2 suces prove theorem 5 continuous densities g compact support densities dense l 1 space densities indeed pick g continuous compact support r f g let fn g n denote product kernel estimate based samples drawn densities f g respectively applying lemma b2 arbitrary suces therefore prove theorem 5 g since k measurable absolutely integrable may approximate l 1 sense sum indicator functions intervals thus 0 find finite number intervals ij coecients k ij l even picked r l also r l r k r k 1 1 define constant fn g n two product kernel estimates data dierent product kernels k i3 i2 i3 arbitrary nature suces consider kernels products finite sums weighted indicator functions intervals let n bound number indicators component kernels easy see forming cartesian grid intervals estimate equivalent kernel estimate kernel shorthand notation rectangle ir vertices j b j j real number also r denote volume j b j introduce notation note j bona fide kernel integral one letting fn denote kernel estimate kernel l f continuous density compact support f nj kernel estimate kernel j upper bound tends zero mean individual term tends zero thus suces prove theorem kernels indicator functions rectangles theorem 6 ef nj f 0 bounded f almost x dominated convergence concludes proof theorem 5 proof theorem 6 let x jmz point f let kernel proportional indicator bounded rectangle necessarily containing origin vertices r varying coordinate turn see z points ir denote volume 0 z p let mn denote diagonal matrix elements h n1 h nd diagonal lemma a1 condition 1 thus r k 1 conclude efn fx rn q therefore r xmnr f rn x jmz point lemma a1 2 turn general kernels take work generalize results reasonably big class kernels easy verify last chain inequalities condition 2 bounded kernel varfn x 0 points x efn x fx thus theorem 6 valid bounded kernels 1 implies efn x fx almost x find 0 finite collection rectangles r constants sup x 0 large positive integer integration note efn last step used 1 first part proof kernels indicators rectangles since arbitrary proof complete 8 treebased rectangular partitioning density estimates let 1 2 sequence partitions ir rectangles open closed x let x denote rectangle x belongs partitioning estimate f given lebesgue measure denotes number data points falling set assume sequence partitions picked data collected present estimates contain standard histogram estimates indeed treebased density estimates purpose section discuss universal consistency pointwise l 1 l 1 consistency rather general theorem aboujaoude 1976a 1976c theorem 7 special case however include proof short uses new tools l convergence dealt aboujaoude 1976b irrelevant general consistency theorems partitioning estimates estimates partition space via order statistics hanna abou jaoude 1981 via multivariate rectangular partitions gessaman 1970 dicult problem universal convergence point view pointwise convergence give theorem theorem 7 let fn partitioning density estimate assume diaman x 0 almost x nan x almost x lim condition f theorem 8 let fn partitioning density estimate assume diaman x 0 almost x nan x almost x r f log d1 1 f almost x proof let x jmz point f r fx 0 thus lemma a1 theorem proved almost points fx 0 x jmz point lemma a1 proof theorem 7 simply use result theorem 8 bounded convergence indeed f almost x fn bona fide deterministic density r f 1974 see also devroye gyorfi 1985 shown may add phrases probability almost surely sides case fn datadependent sequence estimates note condition lemma b2 satisfied partition estimate partition depend upon data 2 indeed consider two determistic samples diering ith point let corresponding partitioning estimates called fn gn let x x denote cardinalities x samples aan z aan n n let fn gn denote partitioning estimate based samples drawn densities f g respectively g density picked later applying lemma b2 point pick picked large r f g theorem 8 almost x egn xgx 0 g bounded e r g bounded convergence thus arbitrary proof complete 9 acknowledgment authors thank attentive referee pointing shortcut proof 10 r conditions necessaires et susantes de convergence l 1 en probabilite de lhistogramme pour une densite approximation density function l 1 error histogram density estimation multidimensional case cambridge university press real variable methods fourier analysis equivalence weak strong complete convergence l1 kernel density esti mates note l1 consistency variable kernel estimates hilbert kernel regression estimate hilbert density estimate strong uniform consistency nearest neighbor density estimates recouvrement du tore q par des ouverts aleatoires discriminatory analysis consistent nonparametric multivariate density estimator based statistically equivalent blocks consistency conditions probability estimators integrals density estimators note dierentiability multiple integrals nonparametric estimate multivariate density function asymptotic normality multivariate knn density estimates multivariate knearest neighbor density estimates counterexample theory strong dierentiation consistency properties nearest neighbor density function esti mators estimation probability density function mode distribution first ladder moment height fluctuation random walk remarks nonparametric estimates density function strong derivatives functions interval useful convergence theorem probability distributions empirical processes applications statistics measure integral tr hilbert kernal regression estimate