cooperative algorithm stereo matching occlusion detection abstractthis paper presents stereo algorithm obtaining disparity maps occlusion explicitly detected produce smooth detailed disparity maps two assumptions originally proposed marr poggio adopted uniqueness continuity disparity maps unique value per pixel continuous almost everywhere assumptions enforced within threedimensional array match values disparity space match value corresponds pixel image disparity relative another image iterative algorithm updates match values diffusing support among neighboring values inhibiting others along similar lines sight applying uniqueness assumption occluded regions explicitly identified demonstrate effectiveness algorithm present processing results synthetic real image pairs including ones groundtruth values quantitative comparison methods b introduction stereo vision produce dense disparity map resultant disparity map smooth detailed continuous even surfaces produce region smooth disparity values boundary precisely delineated small surface elements detected separately distinguishable regions though obviously desirable easy stereo algorithm satisfy two requirements time algorithms produce smooth disparity map tend miss details produce detailed map tend noisy areabased stereo methods 13 18 29 7 2 12 match neighboring pixel values within window images selection appropriate window size critical achieving smooth detailed disparity map optimal choice window size depends local amount variation texture disparity 20 2 6 21 12 general smaller window desirable avoid unwanted smoothing areas low texture however larger window needed window contains intensity variation enough achieve reliable matching hand disparity varies within window ie corresponding surface frontoparallel intensity values within window may correspond due projective distortion addition unwanted smoothing resultant disparity map fact creates phenomena socalled fattening shrinkage surface surface high intensity variation extends neighboring lesstextured surfaces across occluding boundaries many attempts made remedy serious problems windowbased stereo methods one earlier method warp window according estimated orientation surface reduce effect projective distortion 23 recent sophisticated method adaptive window method 12 window size shape iteratively changed based local variation intensity current depth estimates methods showed improved results first method deal difficulty occluding boundary second method extremely computationally expensive typical method deal occlusion bidirectional matching example paper fua 6 two disparity maps created relative image one left right another right left matches consistent two disparity maps kept inconsistent matches create holes filled using interpolation fundamental problem stereo methods make decisions locally take account fact match one point restricts others due global constraints resulting stereo geometry scene consistency one constraint commonly used featurebased stereo methods edge consistency 22 14 matches along continuous edge must consistent constraining matches using edge consistency improves upon local featurebased methods 1 26 produce sparse depth maps work marr poggio 15 16 one first apply global constraints assumptions producing dense depth map two assumptions stereo stated explicitly uniqueness continuity disparity map disparity maps unique values continuous almost everywhere devised simple cooperative algorithm diffusing support among disparity estimates take advantage two assumptions demonstrated algorithm synthetic randomdot images application similar methods real stereo images left largely unexplored probably due memory processing constraints time recently scharstein szelski 27 proposed bayesian model stereo matching creating continuity within disparity map support among disparity estimates nonlinearly diffused derived method results similar adaptive window methods 12 several methods 3 8 11 attempted find occlusions disparity values simultaneously using ordering constraint along dynamic programming techniques paper present cooperative stereo algorithm using global constraints find dense depth map uniqueness continuity assumptions marr poggio adopted threedimensional array match values constructed disparity space element array corresponds pixel reference image disparity relative another image update function match values constructed use real images update function generates continuous unique values diffusing support among neighboring match values inhibiting values along similar lines sight initial match values possibly obtained pixelwise correlation used retain details iteration match values converged occluded areas explicitly identified demonstrate effectiveness algorithm provide experimental data several synthetic real scenes resulting disparity maps smooth detailed occlusions detected disparity maps using real stereo images groundtruth disparities university tsukubas multiview image database used quantitative comparison methods comparison multibaseline method multibaseline plus adaptive window method also made 2 cooperative stereo algorithm marr poggio 15 16 presented two basic assumptions stereo vision algorithm first assumption states single unique match exists pixel pixel corresponds single surface point using intensity values matching uniqueness assumption may violated surfaces opaque classic example pixel receiving contribution fish fish bowl second assumption states disparity values generally continuous ie smooth within local neighborhood scenes continuity assumption valid since surfaces relatively smooth discontinuities occur object boundaries propose cooperative approach using disparity space utilize two assumptions 3d disparity space dimensions row r column c disparity parameterization different 3d volumetric methods 5 17 27 28 use x z world coordinates dimensions assuming without loss generality images rectified element r c disparity space projects pixel r c left image pixel r cd right image illustrated figure 1 within element estimated value match pixels held obtain smooth detailed disparity map iterative update function used refine match values let l denote match value assigned element r c iteration n initial values may computed images using c r c r c r image similarity function squared differences normalized correlation image similarity function produce high values correct matches however opposite need true ie many incorrect matches might also high initial match values continuity assumption implies neighboring elements consistent match values propose iteratively averaging values increase consistency averaging neighboring match values need concept local support local support area element determines extent neighboring elements contribute averaging ideally local support area include neighboring elements correspond correct match current element corresponds correct match since correct match known beforehand assumption required deciding extent local support marr poggio example used elements equal disparity values averaging local support area spans 2d area dconst rcd space 2d local support area corresponds frontoparallel plane assumption however sloping general surfaces require using 3d area disparity space local support many 3d local support assumptions proposed 9 25 26 12 kanade okutomi 12 present detailed analysis relationship differences among simplicity use boxshaped 3d local support area fixed width height depth different local support area could used well current inhibition area yr c figure illustration inhibitory support regions elements 2d slice 3d disparity space row number held constant left camera right camera c let us define amount local support r c ie sum match values within 3d local support area f c r c c r r c r 2 uniqueness assumption implies exist one match within set elements project pixel image illustrated figure 1 dark squares let yr c denote set elements overlap element r c projected image element yr c projects pixel r c left image pixel r cd right image uniqueness assumption yr c represents inhibition area match r c denote amount inhibition receives elements yr c many possible inhibition functions conceivable chosen following computational simplicity c r c r c r c r c r r match value inhibited sum match values within yr c exponent controls amount inhibition per iteration guarantee single element within yr c converge 1 must greater 1 inhibition constant chosen allow elements within local support f affect match values several iterations also maintaining reasonable convergence rate summing match values within local support equation 2 result oversmoothing thus loss details propose restricting match values relative image similarity pixel r c left image pixel right image way allow elements project pixels similar intensities high match values though pixels similar intensity necessarily end high match values initial match values l 0 computed using measure intensity similarity used restricting current match values l n let denote value r restricted l c r r c r c r update function constructed combining equations 2 3 4 respective order c r c r c r c r c r c r method uses assumptions marr poggios update function differs substantially using current notation update function marr poggio proposed c r c r c r c r c r c r sigmoid function e inhibition constant marr poggio 15 16 used discrete match values 2d local support f possibly due memory processing constraints results using synthetic randomdot images step function disparities excellent since real stereo image pairs multiple intensity levels sloping disparities continuous match values 3d local support f needed marr poggio address steps needed apply equation 6 real stereo image pairs 24 equation 5 possesses two main advantages 6 addition supporting use real images first values restricted initial match values maintain details 6 initial values added current values bias results towards values initially high since 6 restrict values initially low oversmoothing loss details may still occur second inhibition function 5 simpler costly sigmoid function need computed experiments marr poggio actually used threshold function instead sigmoid function due processing constraints 3 explicit detection occluded areas occlusion critical difficult phenomena dealt stereo algorithms reasonably complex scene exists occluded pixels correct match unfortunately stereo algorithms consider important case explicitly therefore produce gross errors areas occlusion find disparity values similar foreground background several methods attempted explicitly detect occlusions including methods using intensity edges 10 multiple cameras camera masking 19 bidirectional lefttoright righttoleft matching 6 recently several stereo algorithms belhumeur mumford 3 geiger ladendorf yuille 8 intille bobick 11 proposed finding occlusions matches simultaneously help identifying disparity discontinuities imposing additional assumption called ordering constraint methods able successfully detect occlusions ordering constraint states object left object b left image object also appear left object b right image powerful ordering constraint assumption always true violated polelike objects foreground algorithm try identify occlusions examining magnitude converged match values conjunction uniqueness constraint since correct match exists areas occlusion match values corresponding occluded pixels small consider pixel p left image whose correct corresponding point visible right image referring figure 2 element v array along line sight p two cases occur projection q right image first case depicted figure 2a qs correct corresponding point visible left image exists element v corresponds correct match pixel p left image q since elements v v project pixel q match values inhibit due uniqueness assumption generally correct element v higher match value causing value element v decrease second case depicted figure 2b difficult case occurs qs true corresponding element occluded left image since neither p q correct match value match p q receive inhibition elements corresponding correct matches false matches could high values cases additional assumptions must made correctly find occluded areas ordering constraint could one assumption may label correctly occluded however tradeoff exists enforcing ordering constraint could turn lead pixels mislabeled occluded due tradeoff chosen enforce ordering constraint general provided mutually occluded areas within disparity range similar intensities match values corresponding occluded pixels small match values converged determine pixel occluded finding element greatest match value along line sight maximum match value threshold pixel labeled occluded v right image image q right image image occluded surface false match nonoccluded surface correct match figure 2a q occluded correct match p inhibit false match p b q occluded possible false match occur p 4 summary algorithm cooperative algorithm summarized follows 1 prepare 3d array r c r c pixel reference image range disparity 2 set initial match values l 0 using function image intensities normalized correlation squared differences 3 iteratively update match values l n using 5 match values converge 4 pixel r c find element r c maximum match value 5 maximum match value higher threshold output disparity otherwise classify occluded running time steps 1 5 order n 2 di n 2 size image range disparities number iterations amount memory needed order n 2 practice algorithm takes 8 seconds per iteration 256x256 images sgi indigo 2ex 5 experimental results demonstrate effectiveness algorithm applied several real synthetic images input images rectified initial match values set using squared difference image intensities pixel squared difference values linearly adjusted values distribute 0 1 threshold detecting occlusions set constant image pairs 0005 51 random dot stereogram figure 3a b present synthetic random dot image pair random noise sinusoidal repetitive pattern also inserted part image make difficult disparity map shown figure 3c stepfunction well curved disparities algorithm run three different sizes local support 3x3x3 5x5x3 7x7x3 table 1 shows performance summary 10 iterations approximately 99 disparity values found correctly size local support area pixels labeled occluded true disparity map used computing disparity errors disparity labeled correct within one pixel correct disparity worth noting beginning iteration one 35 maximum initial matches l 0 computed using local image intensity similarity measure correct observed figure 3d disparity errors mainly occur within repetitive texture disparity discontinuities found however enough iterations completed incorrect disparities due repetitive textures completely removed 30 detected occlusions 81 97 indeed occlusions 58 80 true occlusions found depending local support area size occlusions created three vertical bars violate ordering constraint found correctly inhibition constant controls convergence properties algorithm figure 4 illustrates convergence properties different values higher values inhibition constant lead slightly faster convergence minimal loss accuracy 52 u tsukuba data ground truth university tsukubas multiview image database provides real stereo image pairs ground truth data groundtruth data allows us quantitative comparison method others figure 5a b c shows stereo image pair university tsukuba data groundtruth disparity map stereo pair 59 maximum initial match values l 0 correct tested algorithm using three different sizes local support 3x3x3 5x5x3 7x7x3 inhibition constant set 2 15 iterations shown table 2 least 97 disparities found correctly range local support area sizes best result 198 disparity error 5x5x3 local support area errors occurred around lesstextured object boundaries approximately 60 occlusions detected correct 50 true occlusions found allowed match values completely converge using 80 iterations resulting disparity map shown figure 5d table 3 shows detailed analysis correct erroneous matches obtained disparity map 84003 pixels labeled nonoccluded ground truth data 82597 pixels correct disparity 1121 incorrect disparities 285 labeled occluded using algorithm 1902 pixels labeled occluded ground truth data algorithm labeled 860 correctly occluded 1042 incorrectly nonoccluded ignoring occlusion labeling 84003 pixels labeled nonoccluded ground truth data 144 incorrect disparity values greater one pixel using algorithm table 4 shows comparison various stereo algorithms u tsukuba data gpmmrf algorithm 4 approximately twice many errors results standard algorithms also provided 4 error rate 90 log filtered l 1 100 normalized correlation university tsukuba group obtained best results far using multiple images two camera masking 19 errors 03 25 images 09 9 images error results camera masking method evaluated fewer pixels since chance pixel occluded increases number camera angles used 53 cmu coal mine scene figure 6 presents stereo image pair coal mine scene processing results comparison multibaseline method 21 using sums squared differences adaptive window method 12 applied image set multibaseline result figure 6 f uses three input images clearly noisiest three result adaptive window approach figure 6 g also using three images smooth general errors remain especially small building attached tower center image well delineated slanted roof upper corner scene overly smoothed approach used normalized correlation within 3x3 window create initial match values instead squared differences since intensity values varied input images results figure smooth recovering several details time slanted roof lower building water tower rooftop clearly visible depth discontinuities around small building attached tower preserved 15 iterations used inhibition constant set 2 b c figure 3 synthetic scene 50 density reference left image b right image c true disparity black areas occluded disparity map found using 3x3x3 local support area black areas detected occlusions random dot stereogram area rxcxd correct correct found 3x3x3 9944 9711 7961 5x5x3 9929 9541 7105 7x7x3 9873 8110 5842 table 1 percentage disparities found correctly percentage detected occlusions correct percentage true occlusions found three different local support area sizes using random dot stereo pair figure 4 convergence rate inhibition constant 15 2 4 20 iterations using random dot stereogram b c figure 5 head scene provided university tsukuba reference left image b right image c ground truth disparity map black areas occluded provided courtesy u tsukuba disparity map found using algorithm 5x5x3 local support area black areas detected occlusions match values allowed completely converge disparity values narrow objects lamp stem found correctly 9400 9500 9600 9700 9800 9900 10000 iterations disparities correct 154 u tsukuba stereo image pair area rxcxd correct correct found 5x5x3 9802 6658 5184 7x7x3 9773 6323 4485 table 2 percentage disparities found correctly percentage detected occlusions correct percentage true occlusions found three different local support area sizes using u tsukuba stereo pair confusion matrix disparity map obtained u tsukuba data ground truth occluded ground truth nonoccluded total occluded 860 285 1145 nonoccluded 1042 correct incorrect total 1902 84003 85905 table 3 number occluded nonoccluded pixels found using algorithm compared ground truth data provided university tsukuba 5x5x3 area used local support disparity values allowed completely converge zitnick kanade gpmmrf 4 logfiltered normalized correlation 4 nakamura et al 19 25 images nakamura et al 19 table 4 comparison various algorithms using ground truth data supplied university tsukuba rates greater one pixel disparity pixels labeled nonoccluded ground truth data gpmmrf 4 approximately twice error rate algorithm logfiltered l 1 normalized correlation supplied comparison conventional algorithms university tsukuba group provides results using 3x3 5x5 camera array error results method use fewer pixels since chance pixel occluded increases number camera angles used b c e figure coal mine scene reference left image b right image c disparity map obtained using proposed method 3x3x3 local support area black areas detected occlusions real oblique view coal mine model e isometric plot disparity map figure 6c f isometric plot disparity map using multibaseline stereo three images presented 21 g isometric plot disparity map using multibaseline stereo adaptive window three images presented 12 6 conclusion one important contributions marr poggio 15 16 addition cooperative algorithm insisted explicitly stated assumptions directly reflected algorithm many stereo algorithms contrast state assumptions explicitly relationship assumptions algorithm unclear following marr poggios positive example attempted directly reflect continuity uniqueness assumptions algorithm find continuous surface support diffused among neighboring match values within 3d area disparity space unique match found inhibition match values along similar lines sight additionally values converged occlusions explicitly identified examining match value magnitudes demonstrated using several synthetic real image examples resulting disparity map smooth detailed occlusions detected quantitative results obtained using ground truth data supplied university tsukuba demonstrates improvement algorithm current algorithms 7 acknowledgements would like thank dr ohta dr nakamura supplying ground truth data university tsukuba r depth edge intensity based stereo stereo vision bayesian treatment stereo correspondence problem using halfoccluded regions markov random fields efficient approximations spacesweep approach true multiimage matching parallel stereo algorithm produces dense depth maps preserves image features photogrammetric standard methods digital image matching techniques high precision surface measurements occlusions binocular stereo computational experiments feature based stereo algorithm incorporating intensity edges recovery occlusion regions disparityspace images large occlusion stereo stereo matching algorithm adaptive window theory experiment computer determination depth maps parallel binocular stereo algorithm utilizing dynamic programming relaxation labelling cooperative computation stereo disparity computational theory human stereo vision robot spatial perception stereoscopic vision 3d evidence grids iterative prediction correction method automatic stereo comparison occlusion detectable stereo occlusion patterns camera matrix stereo vision robotics multiplebaseline stereo stereo intra interscanline search using dynamic programming flexible approach digital stereo mapping marr poggio algorithm real scenes defined implementation change however algorithm worked well randomdot stereograms several papers support pmf stereo correspondence algorithm using disparity gradient limit detection binocular disparities stereo matching nonlinear diffusion stereo matching transparency matting realities automatic correlation problem volumetric iterative approach stereo matching occlusion detection tr ctr zhengdong liu yingnan zhao jingyu yang fast stereo matching method using edge traction intelligent information processing ii springerverlag london 2004 someya k okamoto g tanaka 3d shape reconstruction synthetic images captured rotating periscope system single focal direction journal visualization v6 n2 p155164 april ayoub k alhamadi robert niese axel panning bernd michaelis toward robust face analysis method noncooperative persons stereo color image sequences machine graphics vision international journal v15 n3 p245254 january 2006 omnidirectional stereoscopic images one omnidirectional camera journal vlsi signal processing systems v42 n1 p91101 january 2006 philip kelly noel e oconnor alan f smeaton pedestrian detection uncontrolled environments using stereo biometric information proceedings 4th acm international workshop video surveillance sensor networks october 2727 2006 santa barbara california usa heiko hirschmller peter r innocent jon garibaldi realtime correlationbased stereo vision reduced border errors international journal computer vision v47 n13 p229246 apriljune 2002 qiuming luo jingli zhou shengsheng yu degui xiao stereo matching occlusion detection integrity illusion sensitivity pattern recognition letters v24 n910 p11431149 01 june steven seitz jiwon kim space stereo images international journal computer vision v48 n1 p2138 june 2002 minglun gong yeehong yang geneticbased stereo algorithm disparity map evaluation international journal computer vision v47 n13 p6377 apriljune 2002 lq xu b lei e hendriks computer vision 3d visualisation telepresence collaborative working environment bt technology journal v20 n1 p6474 january 2002 michael bleyer margrit gelautz graphcutbased stereo matching using image segmentation symmetrical treatment occlusions image communication v22 n2 p127143 february 2007 gustavo olague francisco fernndez cynthia b prez evelyne lutton infection algorithm artificial epidemic approach dense stereo correspondence artificial life v12 n4 p593615 october 2006 olga veksler dense features semidense stereo correspondence international journal computer vision v47 n13 p247260 apriljune 2002 tim burkert jan leupold georg passig photorealistic predictive display presence teleoperators virtual environments v13 n1 p2243 february 2004 gang li steven w zucker contextual inference contourbased stereo correspondence international journal computer vision v69 n1 p5975 august 2006 sang hwa lee yasuaki kanatsugu jongil park mapbased stochastic diffusion stereo matching line fields estimation international journal computer vision v47 n13 p195218 apriljune 2002 c lawrence zitnick sing bing kang stereo imagebased rendering using image oversegmentation international journal computer vision v75 n1 p4965 october 2007 changming sun fast stereo matching using rectangular subregioning 3d maximumsurface techniques international journal computer vision v47 n13 p99117 apriljune 2002 sing bing kang richard szeliski extracting viewdependent depth maps collection images international journal computer vision v58 n2 p139163 july 2004 myron z brown darius burschka gregory hager advances computational stereo ieee transactions pattern analysis machine intelligence v25 n8 p9931008 august daniel scharstein richard szeliski taxonomy evaluation dense twoframe stereo correspondence algorithms international journal computer vision v47 n13 p742 apriljune 2002