automatic sampling ratioofuniforms method applying ratioofuniforms method generating random variates results efficient fast easytoimplement algorithms however parameters every particular type density must precalculated analytically article show ratioofuniforms method also useful design blackbox algorithm suitable large class distributions including logconcave densities using polygonal envelopes squeezes results algorithm extremely fast opposition ratioofuniforms algorithm expected number uniform random numbers less two furthermore show method sense equivalent transformed density rejection b introduction exists large literature generation methods standard continuous distributions see example devroye 1986 algorithms often especially designed particular distribution tailored features density however many situations application standard distributions adequate montecarlo simulation besides sheer brute force inversion tabulate distribution function many points several universal methods large classes distributions developed avoid design special algorithms cases methods either slow eg devroye 1984 need slow setup step large tables eg ahrens kohrt 1981 marsaglia tsang 1984 devroye 1986 chap vii recently two efficient methods proposed transformed density rejection gilks wild 1992 hormann 1995 accep tancerejection technique uses concavity transformed density generate hat function automatically user needs provide probability density function perhaps approximate location mode table method ahrens 1995 also acceptancerejection method uses piecewise constant hat area piece region immediate acceptance makes algorithm fast large number constant pieces used tail region distribution treated separately ratioofuniforms method introduced kinderman monahan 1977 another flexible method adjusted large variety distributions become popular transformation method generate nonuniform random variates since results exact efficient fast easy implement algorithms typically algorithms lines code eg barabesi 1993 gives survey examples fortran codes several standard distributions based following theorem 1991 mathematics subject classification primary 65c10 random number generation sec ondary 65u05 numerical methods probability statistics 11k45 pseudorandom numbers monte carlo methods key words phrases nonuniform random variates ratioofuniforms universal method adaptive method patchwork rejection continuous distributions logconcave distributions concave distributions transformed density rejection theorem 1 kinderman monahan 1977 let x random variable density function r gxdx gx positive integrable function support necessarily finite v u uniformly distributed sampling random points uniformly distributed g rejection convenient enveloping region r g used basic form ratioofuniforms method given algorithm rou algorithm rou require density fx enveloping region r 1 repeat 2 generate random point v u uniformly distributed r 3 x vu 4 u 2 fx 5 return x usually input rou prepared designer algorithm particular distribution reduce number evaluations density function step 4 squeezes used obvious performance simple algorithm depends rejection constant ie ration jrjjaj jrj denotes area region r kinderman monahan 1977 others use rejection minimal bounding rectangle ie smallest possible rectangle g basic algorithm improved several fitting enclosing region decreases rejection constant possible choices parallelograms eg cheng feast 1979 quadratic bounding curves eg leva 1992 often convenient decompose countable set nonoverlapping subregions composite ratioofuniforms method robertson walls 1980 give simple example dagpunar 1988 p 65 considers possibility enclosing polygon paper develop new algorithm uses polygonal envelopes squeezes random variates inside squeeze generated mere inversion therefore opposite ratioofuniforms method less two uniform random numbers required large class distributions including logconcave distributions possible construct envelope squeeze automatically moreover show new algorithm sense equivalent transformed density rejection new method several advantages ffl envelopes squeezes constructed automatically probability density function necessary random numbers necessary 0 made arbitrarily small ffl small method close inversion thus resulting random variates used variance reduction techniques moreover structure resulting random variates similar underlying random uniform random number generator hence nonuniform random variates inherit quality properties 1 moreover method extended wakefield gelfand smith 1991 replaces function general strictly increasing differentiable function qu stadlober 1989 1990 gives modification discrete distributions jones lunn 1996 embeds method general random variate generation framework wakefield et al 1991 stefanescu vaduva 1987 apply method generation multivariate distributions ffl avoids possible defects quality resulting pseudorandom variates reported ratioofuniforms method see hormann 1994a hormann 1994b ffl first ratioofuniforms method first implementation transformed density rejection requires less two random numbers section 2 give outline new approach section 4 discuss problem getting proper envelope region r section 5 describes algorithm detail section 3 shows algorithm applicable concave densities x remarks quality random numbers generated new algorithm given section 6 2 method enveloping polygons given distribution probability density function r gxdx convex set g notice g must continuous bounded since otherwise g convex simplify development method first assume unbounded support g restriction dropped later distribution easy make enveloping polygon select couple points c boundary use tangents points edges enclosing polygon p e see figure 1 denote vertices p e simply intersection points tangents obviously choice construction points tangents result bounded polygon p e procedure even works tangents unique point v u ie gx differentiable furthermore simple construct squeezes take inside polygon p vertices c construction points tangent figure 1 polygonal envelope squeeze convex set g sampling enveloping polygon notice origin 0 0 always contained polygon p e moreover every straight line origin corresponds thus intersection always connected therefore use c first construction point vaxis tangent sample uniformly enclosing polygon triangulate p e making segments illustrates situation segment vertices c 0 c last segment segment divided triangle inside squeeze dark sn figure 2 triangulation enveloping polygon shaded triangle outside light shaded notice segments 0 sn three vertices triangles 0 n generate random point uniformly distributed p e first sample discrete distribution probability vector proportional js 0 j js 1 j select segment triangle done algorithm get segment require list segments 1 generate r u0 1 2 find smallest k ik 3 p 4 return triangle k 5 else return triangle k step 2 indexed search guide tables appropriate method chen asau 1974 see also devroye 1986 xiii24 uniformly distributed points triangle v generated following simple algorithm devroye 1986 p 570 algorithm triangle require triangle v 1 generate r 1 2 r 1 3 return 1 sampling algorithm much improved every point triangle immediately accepted without evaluating probability density function thus interested ratio components since vertex c arrive r r c ij jth component vertex c r 0 1 uniform random variate rationofuniforms theorem since 0 r 2 kinderman monahan 1977 notice save one uniform random number domain p method furthermore reuse random number r routine get segment r risk find ik ik sampling p seen inversion cumulated distribution function defined boundary squeeze polygon thus ratio jp jjp e j close 1 almost inversion generating random variates inversion method two advantages thus favored simulation community see bratley fox schrage 1983 1 structure generator simple easily investigated see section 6 2 random variates used variance reduction techniques expected number uniform random numbers let j need 1 generating one ratio vu since reject ratio v u 62 find expected number uniform random numbers per generated nonuniform notice proper choice construction points made arbitrarily small bounded domain g x situation nearly distinguish two cases exists limit point x use x construction point respective triangular segment 0 sn necessary 2 otherwise restrict triangular segment 0 sn ie use tangent line instead vaxis notice different tangent lines c 0 0 sn adding construction point add new point given ratio need c outer boundary tangent line point given positive root u total differential tangent 3 ratioofuniforms transformed density rejection transformed density rejection one efficient universal methods transformed density rejection introduced devroye 1986 different name gilks wild 1992 generalized hormann 1995 accep tancerejection technique uses concavity transformed density generate hat function squeezes automatically means tangents secants user needs provide density function perhaps approximate location mode utilized density f strictly increasing differentiable transformation exists fx concave see hormann 1995 details density called logconcave densities example logx figure 3 illustrates situation standard normal distribution transformation logx left hand side shows transformed density three tangents right hand side shows density function resulting hat squeezes drawn dashed lines evans swartz 1998 shown technique even suitable arbitrary densities provided inflection points transformed density known 6 josef leydold figure 3 construction hat function normal density utilizing transformed density rejection densities convex region stadlober 1989 dieter 1989 clarified relationship ratioofuniforms method ordinary accep tancerejection method also deeper connection transformed density rejection gives us useful characterization densities convex region g first provide proof theorem 1 proof theorem 1 consider transformation r theta 0 1 since jacobian transformation 2 joint density probability function x given wx otherwise thus x marginal density w 1 r gx consequently r gxdx w 1 probability density function fx transformation 5 maps g onetoone onto b ie set points graph gx xaxis moreover outer boundary g fv u mapped onto graph gx theorem 2 g convex gx concave transformation x proof since x strictly monotonically increasing transformation onetoone onto c ie region transformed density hence r theta 0 1 maps g onetoone onto c g notice g concave c g con vex thus remains show g convex c g convex consequently straight lines remain straight lines transformation 6 let xb straight line c g ie straight line g analogously find straight line line x remark 3 theorem 2 new universal ratioofuniforms method sense equivalent transformed density rejection different method generate points uniformly distributed region hat function opposite new method transformed density rejection always needs two uniform random numbers similar approach transform density jection ie decomposing hat function squeeze region immediate acceptance region squeeze hat work well sampling second part awkward prone numerical errors hormann 1999 since every logconcave density concave x hormann 1995 algorithm applied large class distributions examples given table 1 given conditions parameters imply concavity support densities however densities concave wider range parameters subset support eg density gamma distribution concave 0 x distribution density support concave normal e gammax 2 2 r lognormal 1x expgamma pexponential e gamma x 0 beta x weibull x perks 1e x gen inv gaussian x pearson vi x planck x e burr x snedecors f x table 1 concave densities normalization constants omitted 4 construction points performance new algorithm depends small ratio thus choice constructions points tangents enveloping polygon three possible solutions 1 simply choose equidistributed points 2 use adaptive method 3 use optimal points obvious setup time increasing marginal generation time decreasing 1 3 given number construction points equidistributed points simplest method choose points x equidistributed angles density function bounded domain 7 modified tan l tan r left right boundary domain see also section 2 numerical simulations several density functions shown acceptable good choice construction points several distributions ratio length width minimal bounding rectangle far one adaptive rejection sampling gilks wild 1992 introduces ingenious concept adaptive rejection sampling problem finding appropriate construction points tangents transformed density rejection method adopted situation works following way start least two points sides mode sample points enveloping polygon p e add new construction point stopping criterion fulfilled eg maximal number construction points aimed ratio jp jjp e j reached ensure starting polygon p e bounded construction point least close mode used third starting point sampling point domain p e n p much expensive sampling squeeze region firstly generation random point requires random numbers multiplications secondly evaluate density check acceptance condition thus minimize ratio done perfectly well adaptive rejection sample since method region automatically approximated envelope squeeze polygon probability adding new point segment depends ratio js ie probability fall hence adaptive algorithm tends insert new construction point necessary obviously ratio n random variable converges 0 almost surely number construction points n tends infinity simple consideration leydold hormann 1998 figure 4 shows result simulation standard normal distribution non optimal starting points samples n plotted number n construction points range n given light shaded area 90 50percentiles given dark shaded areas median solid line 10 figure 4 convergence ratio standard normal distribution starting points 50 000 samples run simulations distributions starting values made observation convergence even faster nonnormal dis tributions however analytical investigations interesting upper bounds expected value n open problem optimal construction points theorem 2 area hat squeeze transformed density rejection method mapped onetoone onto automatic sampling ratioofuniforms method 9 thus use methods computing optimal construction points transformed density rejection finding optimal envelopes new algorithm three construction points used see hormann 1995 points required derflinger hormann 1998 describe efficient method however modification necessary improvements adaptive rejection sampling rather small seen figure 4 lower boundary range gives good estimate optimal choice construction points 5 algorithm algorithm arou consists three main parts 1 construct starting enveloping polygon p e squeeze polygon p routine arou start take care possibly bounded domain two cases described section 2 starting points must provided eg using equidistributed points describes section 4 2 sample given distribution routine arou sample 3 add new construction point routine arou add whenever fall store envelope list segments object 1 using algorithm first initialize generator calling arou start sampling done calling arou sample object 1 segment parameter variable definition remark left construction point c right construction point c i1 pointer stored next segment tangent left point tangent right point i1 pointer stored next segment intersection point area insideoutside squeeze accumulated area cum fast inversion algorithm arou start require density fx derivative f 0 x domain 2 0 cosarctanx tangent line 3 k1 cosarctanx k tangent line k 4 5 fx 7 iv gammaf 0 8 add list segments cannot used construction point 9 segments 10 insert c i1 i1 already stored next segment list 12 compute cum 13 check polygon p e bounded 14 return list segments algorithm arou sample require density fx list segments 1 loop 2 generate r u0 1 3 find smallest cum use guide table 4 r cum 5 r return 7 9 generate r 2 u0 1 10 r 1 14 number segments maximum 15 call arou add x 17 return x algorithm arou add require density fx derivative f 0 x new construction point xn segment r 1 fxn cannot add point 2 return 3 c n2 4 nv gammaf 0 5 insert sn list segments take care c i1 remove old segment r list 7 compute mn 8 compute 9 segments 10 compute cum 11 return new list segments implement algorithm linked list segments necessary whenever cum recalculated guide table made using linear search might good method finding random variates sampled special care necessary computed arou start arou add three possible cases numerical problems solving corresponding linear equation 1 vertices c c i1 close consequently js j small simply reject c i1 new construction point close c small 3 boundary c c i1 almost straight line almost 0 case set possible way define small compare numbers smallest positive used programming language denotes magnitude maximum density function ansi c defined macro dbl epsilon important check whether outer side secant c c i1 condition violated arou start polygon p e unbounded may violated arou start arou add convex c implementation test version algorithm arou coded c available anonymous ftp leydold 1999 email request author 6 note quality random numbers new algorithm composition method similar acceptancecomplement method see devroye 1986 x ii5 x distribution defined squeeze region g theorem 1 algorithm exact ie generated random variates required distribution however defects underlying uniform random number generators may result poor quality nonuniform random variate moreover transformation nonuniform random variate may cause deficiencies although little literature topic ratioofuniforms method combination linear congruental generator lcg reported defects hormann 1994a hormann 1994b due lattice structure random pairs generated lcg always hole without point probability order 1 modulus lcg random variates generated inversion inherit structure underlying uniform random numbers consequently quality consider great advantage method since generators whose structural properties well understood precisely described may look less random complicated less understood necessarily better may hide strong correlations important defects avoid generators without convincing theoretical support statement lecuyer 1998 building uniform random number generator also valid nonuniform distribu tions methods may hidden inferences make prediction quality resulting nonuniform random numbers impossible leydold leeb hormann 1999 notice random variate density g x generated inversion thus ratio tends 0 random variates generated inversion new algorithm immediate consequence small new generator avoids defects basic ratioofuniforms method figure 5 shows scatter plots overlapping tuples using baby generator shows underlying generator bf show tuples phiu 0 different number construction points using equidistribution method phi denotes cumulated distribution function standard normal distribution made empirical investigation using mtupel tests good 1953 marsaglia 1985 setup leydold leeb hormann 1999 standard normal distribution various numbers construction points used linear congruential generator fish fishman moore 1986 explicit inversive congruential generator eichenauerherrmann 1993 twisted gfsr generator tt800 matsumoto kurita 1994 last infamous randu lcg example generator bad lattice structure see park miller 1988 tests demonstrated small ratio quality normal generators strongly correlated quality underlying uniform random number generator especially using randu results normal generator bad quality notice however correlation exist close 0 indeed using 2 4 construction points results normal generator might better eg fish tests worse eg randu underlying generator uniform b c r figure 5 scatter plots baby generator mod 1024 normal variates using algorithm arou 2 4 6 29 75 equidistributed construction points bf 7 possible variants nonconvex region algorithm modified work nonconvex region f adapting idea evans swartz 1998 partition f segments using inflection points transformed density transformation x segment f fx concave use secants boundary enveloping polygon p e tangents squeeze p notice squeeze region segment quadrangle triangulated multivariate distributions wakefield gelfand smith 1991 stefanescu vaduva 1987 generalized ratioofuniforms method multivariate distributions use rejection enclosing multidimensional rectangle however acceptance probability decreases fast higher dimension multivariate normal distribution four dimension 1 using polyhedral envelopes similar leydold hormann 1998 leydold 1998 possible increases acceptance probability however requires additional research acknowledgements author wishes thank hannes leeb helpful discussions quality random number generators r computer methods efficient sampling largely arbitrary statistical distributions random variate generation using ratioofuniforms method guide simulation generating random variates empirical distribution simple gamma variate generators principles random variate generation optimal selection hat functions rejection algorithms simple algorithm generating random variates logconcave density mathematical aspects various methods sampling classical distributions statistical independence new class inversive congruential pseudorandom numbers random variable generation using concavity properties transformed densities see erratum adaptive rejection sampling gibbs sampling applied statistics serial test sampling numbers tests randomness rejection technique sampling tconcave distri butions private communication transformations random variate gen eration generalised ratioofuniforms methods computer generation random variables using ratio uniform deviates random number generation fast normal random number generator rejection technique sampling logconcave multivariate distributions arou user manual sweepplane algorithm generating random tuples simple polytopes higher dimensional properties nonuniform pseudorandom variates current view random number generators twisted gfsr generators ii random number generators good ones hard find random number generation normal gamma distributions using ratio uniforms method ratio uniforms approach generating discrete random variates computer generation random vectors transformations uniformly distributed vectors efficient generation random variates via ratioofuniforms method university economics business administration tr exhaustive analysis multiplicative congruential random number generators modulus 2supscrpt311 guide simulation 2nd ed computer generation random vectors transformation uniformly distributed vectors random number generators good ones hard find mathematical aspects various methods sampling classical distributions ratio uniforms approach generating discrete random variates fast normal random number generator note quality random variates generated ratio uniforms method twisted gfsr generators ii rejection technique sampling italictitalicconcave distributions rejection technique sampling logconcave multivariate distributions sweepplane algorithm generating random tuples simple polytopes computer generation random variables using ratio uniform deviates ctr leydold gerhard derflinger gnter tirler wolfgang hrmann automatic code generator nonuniform random variate generation mathematics computers simulation v62 n36 p405412 3 march john kent patrick l constable fikret er simulation complex bingham distribution statistics computing v14 n1 p5357 january 2004 josef leydold short universal generators via generalized ratioofuniforms method mathematics computation v72 n243 p14531471 july josef leydold simple universal generator continuous discrete univariate tconcave distributions acm transactions mathematical software toms v27 n1 p6682 march 2001 wolfgang hrmann josef leydold continuous random variate generation fast numerical inversion acm transactions modeling computer simulation tomacs v13 n4 p347362 october w hrmann j leydold randomnumber randomvariate generation automatic random variate generation simulation input proceedings 32nd conference winter simulation december 1013 2000 orlando florida dongu lee wayne luk john villasenor peter k cheung gaussian noise generator hardwarebased simulations ieee transactions computers v53 n12 p15231534 december 2004